{"title":"宝塔插件-webhook配置，增加清除日志功能","slug":"webhook","date":"2020-12-22T05:00:00.000Z","updated":"2021-10-06T00:42:30.322Z","comments":true,"path":"api/articles/webhook.json","excerpt":null,"covers":["https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_1.jpeg","https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_0.jpeg","https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhook_2.jpeg","https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhoosk_3.jpeg","https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_4.jpeg"],"content":"<div class=\"tip ref font5 fas fa-sync faa-horizontal animated\"><p>在每次同步本地hexo静态文件时，webhooks都会生成一个日志，久而久之日志数量增加，查看日志时不方便，因此添加一个function清除日志功能</p></div>\n\n<h2 id=\"打开webhook文件\"><a href=\"#打开webhook文件\" class=\"headerlink\" title=\"打开webhook文件\"></a>打开webhook文件</h2><ol>\n<li>打开宝塔webhonk所在的文件位置找到<code>index.html</code></li>\n</ol>\n<ul>\n<li>文件路径<code>/www/server/panel/plugin/webhook/index.html</code><br><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_1.jpeg\"></li>\n</ul>\n<ol start=\"2\">\n<li>修改<code>index.html</code>代码</li>\n<li>修改后效果如下<br><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_0.jpeg\"></li>\n</ol>\n<h2 id=\"修改html\"><a href=\"#修改html\" class=\"headerlink\" title=\"修改html\"></a>修改html</h2><h4 id=\"修改21行左右的代码\"><a href=\"#修改21行左右的代码\" class=\"headerlink\" title=\"修改21行左右的代码\"></a>修改21行左右的代码</h4><ul>\n<li>代码如下-将之前的行限制删除</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">th</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;text-align: right;&quot;</span>&gt;</span>操作<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span> </span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhook_2.jpeg\"></p>\n<h4 id=\"替换79行里面的代码\"><a href=\"#替换79行里面的代码\" class=\"headerlink\" title=\"替换79行里面的代码\"></a>替换79行里面的代码</h4><ul>\n<li>代码如下-直接替换掉</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+mlist[i].title+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+getLocalTime(mlist[i].addtime)+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+getLocalTime(mlist[i].uptime)+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+mlist[i].count+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:showWebHookCode(\\&#x27;&#x27;+mlist[i].url+&#x27;\\&#x27;,\\&#x27;&#x27;+mlist[i].access_key+&#x27;\\&#x27;)&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>查看密钥<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;text-align: right;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:RunHook(\\&#x27;&#x27;+mlist[i].access_key+&#x27;\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>测试<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:OnlineEditFile(0,\\&#x27;/www/server/panel/plugin/webhook/script/&#x27;+mlist[i].access_key+&#x27;\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>编辑<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:DeleteHook(\\&#x27;&#x27;+mlist[i].access_key+&#x27;\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>删除<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>&#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;text-align: right;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:GetLogs(\\&#x27;/www/server/panel/plugin/webhook/script/&#x27;+mlist[i].access_key+&#x27;.log\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>日志<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:ClearLogs(\\&#x27;/www/server/panel/plugin/webhook/script/&#x27;+mlist[i].access_key+&#x27;.log\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>清除日志<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span>&#x27;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhoosk_3.jpeg\"></p>\n<h4 id=\"在大概138行左右添加function\"><a href=\"#在大概138行左右添加function\" class=\"headerlink\" title=\"在大概138行左右添加function\"></a>在大概138行左右添加function</h4><ul>\n<li>代码如下-这里是添加一个指令可清楚日志</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;清除日志</span><br><span class=\"line\">function ClearLogs(path)&#123;</span><br><span class=\"line\">loadT &#x3D; layer.msg(&#39;正在清除...&#39;,&#123;icon:16,time:0,shade: [0.3, &#39;#000&#39;]&#125;);</span><br><span class=\"line\">var data&#x3D;&#39;&amp;path&#x3D;&#39;+path</span><br><span class=\"line\">$.post(&#39;&#x2F;files?action&#x3D;DeleteFile&#39;,data,function(rdata)&#123;</span><br><span class=\"line\">layer.close(loadT);</span><br><span class=\"line\">if(!rdata.status) &#123;</span><br><span class=\"line\">layer.msg(rdata.msg,&#123;icon:2&#125;);</span><br><span class=\"line\">return;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">layer.msg(rdata.msg,&#123;icon:rdata.status?1:2&#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_4.jpeg\"></p>\n","more":"<div class=\"tip ref font5 fas fa-sync faa-horizontal animated\"><p>在每次同步本地hexo静态文件时，webhooks都会生成一个日志，久而久之日志数量增加，查看日志时不方便，因此添加一个function清除日志功能</p></div>\n\n<h2 id=\"打开webhook文件\"><a href=\"#打开webhook文件\" class=\"headerlink\" title=\"打开webhook文件\"></a>打开webhook文件</h2><ol>\n<li>打开宝塔webhonk所在的文件位置找到<code>index.html</code></li>\n</ol>\n<ul>\n<li>文件路径<code>/www/server/panel/plugin/webhook/index.html</code><br><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_1.jpeg\"></li>\n</ul>\n<ol start=\"2\">\n<li>修改<code>index.html</code>代码</li>\n<li>修改后效果如下<br><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_0.jpeg\"></li>\n</ol>\n<h2 id=\"修改html\"><a href=\"#修改html\" class=\"headerlink\" title=\"修改html\"></a>修改html</h2><h4 id=\"修改21行左右的代码\"><a href=\"#修改21行左右的代码\" class=\"headerlink\" title=\"修改21行左右的代码\"></a>修改21行左右的代码</h4><ul>\n<li>代码如下-将之前的行限制删除</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">th</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;text-align: right;&quot;</span>&gt;</span>操作<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span> </span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhook_2.jpeg\"></p>\n<h4 id=\"替换79行里面的代码\"><a href=\"#替换79行里面的代码\" class=\"headerlink\" title=\"替换79行里面的代码\"></a>替换79行里面的代码</h4><ul>\n<li>代码如下-直接替换掉</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+mlist[i].title+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+getLocalTime(mlist[i].addtime)+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+getLocalTime(mlist[i].uptime)+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#x27;+mlist[i].count+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:showWebHookCode(\\&#x27;&#x27;+mlist[i].url+&#x27;\\&#x27;,\\&#x27;&#x27;+mlist[i].access_key+&#x27;\\&#x27;)&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>查看密钥<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;text-align: right;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:RunHook(\\&#x27;&#x27;+mlist[i].access_key+&#x27;\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>测试<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:OnlineEditFile(0,\\&#x27;/www/server/panel/plugin/webhook/script/&#x27;+mlist[i].access_key+&#x27;\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>编辑<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:DeleteHook(\\&#x27;&#x27;+mlist[i].access_key+&#x27;\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>删除<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>&#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;text-align: right;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:GetLogs(\\&#x27;/www/server/panel/plugin/webhook/script/&#x27;+mlist[i].access_key+&#x27;.log\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>日志<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &#x27;</span><br><span class=\"line\">                            +&#x27;<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:ClearLogs(\\&#x27;/www/server/panel/plugin/webhook/script/&#x27;+mlist[i].access_key+&#x27;.log\\&#x27;);&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btlink&quot;</span>&gt;</span>清除日志<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span>&#x27;</span><br><span class=\"line\">\t\t\t\t\t\t+&#x27;<span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span>&#x27;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhoosk_3.jpeg\"></p>\n<h4 id=\"在大概138行左右添加function\"><a href=\"#在大概138行左右添加function\" class=\"headerlink\" title=\"在大概138行左右添加function\"></a>在大概138行左右添加function</h4><ul>\n<li>代码如下-这里是添加一个指令可清楚日志</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;清除日志</span><br><span class=\"line\">function ClearLogs(path)&#123;</span><br><span class=\"line\">loadT &#x3D; layer.msg(&#39;正在清除...&#39;,&#123;icon:16,time:0,shade: [0.3, &#39;#000&#39;]&#125;);</span><br><span class=\"line\">var data&#x3D;&#39;&amp;path&#x3D;&#39;+path</span><br><span class=\"line\">$.post(&#39;&#x2F;files?action&#x3D;DeleteFile&#39;,data,function(rdata)&#123;</span><br><span class=\"line\">layer.close(loadT);</span><br><span class=\"line\">if(!rdata.status) &#123;</span><br><span class=\"line\">layer.msg(rdata.msg,&#123;icon:2&#125;);</span><br><span class=\"line\">return;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">layer.msg(rdata.msg,&#123;icon:rdata.status?1:2&#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/3/webhooks_4.jpeg\"></p>\n","categories":[{"name":"技术·教程","path":"api/categories/技术·教程.json"}],"tags":[]}