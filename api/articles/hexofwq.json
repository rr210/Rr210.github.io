{"title":"hexo本地同时同步服务器和github page","slug":"hexofwq","date":"2020-12-21T14:00:00.000Z","updated":"2022-05-27T07:19:19.109Z","comments":true,"path":"api/articles/hexofwq.json","excerpt":null,"covers":["https://cloud.mr90.top/file/imagecloud/hexo/3/dadasdaw_webhook.png","https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_2.jpeg","https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_3.jpeg","https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_4.jpeg","https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_5.png","https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_6.jpeg","https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_7.jpeg"],"content":"<div class='tip ffa font5 fas fa-cogs faa-horizontal animated' ><p>由于本人比较懒，但又想实现本地一键同步GitHub和云服务器，所以设置了webhook的脚本指令来实现同步更新并上传</p></div>\n\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li>一台云服务器(使用宝塔配置就行)</li>\n<li>一个聪明头</li>\n</ol>\n<h2 id=\"注意事项（必看）\"><a href=\"#注意事项（必看）\" class=\"headerlink\" title=\"注意事项（必看）\"></a>注意事项（必看）</h2><blockquote>\n<p>在配置之前必须开放端口，否则会导致配置失败，放行云服务器<code>7777</code>端口，宝塔安全组也要开放<code>7777</code>端口</p>\n</blockquote>\n<ul>\n<li>放行端口可使云服务器连接GitHub仓库</li>\n</ul>\n<h2 id=\"思维导图\"><a href=\"#思维导图\" class=\"headerlink\" title=\"思维导图\"></a>思维导图</h2><blockquote>\n<p>本地<code>hexo d</code>只能是实现与GitHub的同步，所以要借助GitHub上的webhook实现与云服务器的同步</p>\n</blockquote>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/dadasdaw_webhook.png\"></p>\n<h2 id=\"宝塔配置\"><a href=\"#宝塔配置\" class=\"headerlink\" title=\"宝塔配置\"></a>宝塔配置</h2><blockquote>\n<p>使用宝塔想必大家也知道为啥，好用啊（菜鸟专用·me）</p>\n</blockquote>\n<ol>\n<li>使用宝塔的软件商城，下载安装<code>webhook</code></li>\n<li>点击设置将以下代码脚本填入即可</li>\n<li>修改脚本内容，已标<code>gitpath</code>和<code>gitHttp</code></li>\n</ol>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_2.jpeg\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">echo &quot;&quot;</span><br><span class=\"line\">#输出当前时间</span><br><span class=\"line\">date --date&#x3D;&#39;0 days ago&#39; &quot;+%Y-%m-%d %H:%M:%S&quot;</span><br><span class=\"line\">echo &quot;Start&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#git项目路径</span><br><span class=\"line\">gitPath&#x3D;&quot;&#x2F;www&#x2F;wwwroot&#x2F;u.mr90.top&quot;</span><br><span class=\"line\">#git要同步的仓库 网址</span><br><span class=\"line\">gitHttp&#x3D;&quot;https:&#x2F;&#x2F;github.com&#x2F;Rr210&#x2F;Rr210.github.io.git&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">echo &quot;Web站点路径：$gitPath&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">#判断项目路径是否存在</span><br><span class=\"line\">if [ -d &quot;$gitPath&quot; ]; then</span><br><span class=\"line\">        cd $gitPath</span><br><span class=\"line\">        #判断是否存在git目录</span><br><span class=\"line\">        if [ ! -d &quot;.git&quot; ]; then</span><br><span class=\"line\">                echo &quot;在该目录下克隆 git&quot;</span><br><span class=\"line\">               \tsudo git clone $gitHttp gittemp</span><br><span class=\"line\">                sudo mv gittemp&#x2F;.git .</span><br><span class=\"line\">                sudo rm -rf gittemp</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        #拉取最新的项目文件</span><br><span class=\"line\">        sudo git reset --hard origin&#x2F;master</span><br><span class=\"line\">        sudo git pull origin master</span><br><span class=\"line\">        #设置目录权限</span><br><span class=\"line\">        sudo chown -R www:www $gitPath</span><br><span class=\"line\">        echo &quot;End&quot;</span><br><span class=\"line\">        exit</span><br><span class=\"line\">else</span><br><span class=\"line\">        echo &quot;该项目路径不存在&quot;</span><br><span class=\"line\">        echo &quot;End&quot;</span><br><span class=\"line\">        exit</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"复制密钥和链接\"><a href=\"#复制密钥和链接\" class=\"headerlink\" title=\"复制密钥和链接\"></a>复制密钥和链接</h2><ol>\n<li>打开宝塔webhook然后点击查看密钥，复制<code>密钥</code>和<code>链接</code></li>\n</ol>\n<p><code>注</code>链接复制<code>&amp;</code>前面的哦<br><code>注</code>链接复制<code>&amp;</code>前面的哦<br><code>注</code>链接复制<code>&amp;</code>前面的哦</p>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_3.jpeg\"></p>\n<h2 id=\"配置GitHub\"><a href=\"#配置GitHub\" class=\"headerlink\" title=\"配置GitHub\"></a>配置GitHub</h2><ol>\n<li>打开要仓库点击<code>settings</code>设置找到<code>webhook</code><br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_4.jpeg\"></li>\n<li>把刚刚复制的密钥和链接填入即可<br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_5.png\"></li>\n<li>点击update webhook即可</li>\n<li>显示下图状态及配置成功<br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_6.jpeg\"></li>\n</ol>\n<h2 id=\"测试配置\"><a href=\"#测试配置\" class=\"headerlink\" title=\"测试配置\"></a>测试配置</h2><h4 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一:\"></a>方法一:</h4><ol>\n<li>在本地使用<code>hexo clean</code>和<code>hexo g</code>和<code>hexo d</code></li>\n<li>三连，如果想压缩后上传要使用方法二</li>\n<li>如图所示，则配置成功,查看<code>宝塔webhook</code>日志</li>\n</ol>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_7.jpeg\"></p>\n<h4 id=\"方法二：\"><a href=\"#方法二：\" class=\"headerlink\" title=\"方法二：\"></a>方法二：</h4><ol>\n<li>修改文章测试</li>\n<li>使用<code>gulp</code>压缩指令</li>\n<li>配置好gulp可使用，看[gulp文章配置]<br>(<a href=\"https://www.antmoe.com/posts/b411a3f8/index.html\">https://www.antmoe.com/posts/b411a3f8/index.html</a>)</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo g</span><br><span class=\"line\">gulp build &#x2F;&#x2F;相当于压缩后直接hexo d</span><br></pre></td></tr></table></figure>\n\n","more":"<div class='tip ffa font5 fas fa-cogs faa-horizontal animated' ><p>由于本人比较懒，但又想实现本地一键同步GitHub和云服务器，所以设置了webhook的脚本指令来实现同步更新并上传</p></div>\n\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li>一台云服务器(使用宝塔配置就行)</li>\n<li>一个聪明头</li>\n</ol>\n<h2 id=\"注意事项（必看）\"><a href=\"#注意事项（必看）\" class=\"headerlink\" title=\"注意事项（必看）\"></a>注意事项（必看）</h2><blockquote>\n<p>在配置之前必须开放端口，否则会导致配置失败，放行云服务器<code>7777</code>端口，宝塔安全组也要开放<code>7777</code>端口</p>\n</blockquote>\n<ul>\n<li>放行端口可使云服务器连接GitHub仓库</li>\n</ul>\n<h2 id=\"思维导图\"><a href=\"#思维导图\" class=\"headerlink\" title=\"思维导图\"></a>思维导图</h2><blockquote>\n<p>本地<code>hexo d</code>只能是实现与GitHub的同步，所以要借助GitHub上的webhook实现与云服务器的同步</p>\n</blockquote>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/dadasdaw_webhook.png\"></p>\n<h2 id=\"宝塔配置\"><a href=\"#宝塔配置\" class=\"headerlink\" title=\"宝塔配置\"></a>宝塔配置</h2><blockquote>\n<p>使用宝塔想必大家也知道为啥，好用啊（菜鸟专用·me）</p>\n</blockquote>\n<ol>\n<li>使用宝塔的软件商城，下载安装<code>webhook</code></li>\n<li>点击设置将以下代码脚本填入即可</li>\n<li>修改脚本内容，已标<code>gitpath</code>和<code>gitHttp</code></li>\n</ol>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_2.jpeg\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">echo &quot;&quot;</span><br><span class=\"line\">#输出当前时间</span><br><span class=\"line\">date --date&#x3D;&#39;0 days ago&#39; &quot;+%Y-%m-%d %H:%M:%S&quot;</span><br><span class=\"line\">echo &quot;Start&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#git项目路径</span><br><span class=\"line\">gitPath&#x3D;&quot;&#x2F;www&#x2F;wwwroot&#x2F;u.mr90.top&quot;</span><br><span class=\"line\">#git要同步的仓库 网址</span><br><span class=\"line\">gitHttp&#x3D;&quot;https:&#x2F;&#x2F;github.com&#x2F;Rr210&#x2F;Rr210.github.io.git&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">echo &quot;Web站点路径：$gitPath&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">#判断项目路径是否存在</span><br><span class=\"line\">if [ -d &quot;$gitPath&quot; ]; then</span><br><span class=\"line\">        cd $gitPath</span><br><span class=\"line\">        #判断是否存在git目录</span><br><span class=\"line\">        if [ ! -d &quot;.git&quot; ]; then</span><br><span class=\"line\">                echo &quot;在该目录下克隆 git&quot;</span><br><span class=\"line\">               \tsudo git clone $gitHttp gittemp</span><br><span class=\"line\">                sudo mv gittemp&#x2F;.git .</span><br><span class=\"line\">                sudo rm -rf gittemp</span><br><span class=\"line\">        fi</span><br><span class=\"line\">        #拉取最新的项目文件</span><br><span class=\"line\">        sudo git reset --hard origin&#x2F;master</span><br><span class=\"line\">        sudo git pull origin master</span><br><span class=\"line\">        #设置目录权限</span><br><span class=\"line\">        sudo chown -R www:www $gitPath</span><br><span class=\"line\">        echo &quot;End&quot;</span><br><span class=\"line\">        exit</span><br><span class=\"line\">else</span><br><span class=\"line\">        echo &quot;该项目路径不存在&quot;</span><br><span class=\"line\">        echo &quot;End&quot;</span><br><span class=\"line\">        exit</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"复制密钥和链接\"><a href=\"#复制密钥和链接\" class=\"headerlink\" title=\"复制密钥和链接\"></a>复制密钥和链接</h2><ol>\n<li>打开宝塔webhook然后点击查看密钥，复制<code>密钥</code>和<code>链接</code></li>\n</ol>\n<p><code>注</code>链接复制<code>&amp;</code>前面的哦<br><code>注</code>链接复制<code>&amp;</code>前面的哦<br><code>注</code>链接复制<code>&amp;</code>前面的哦</p>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_3.jpeg\"></p>\n<h2 id=\"配置GitHub\"><a href=\"#配置GitHub\" class=\"headerlink\" title=\"配置GitHub\"></a>配置GitHub</h2><ol>\n<li>打开要仓库点击<code>settings</code>设置找到<code>webhook</code><br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_4.jpeg\"></li>\n<li>把刚刚复制的密钥和链接填入即可<br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_5.png\"></li>\n<li>点击update webhook即可</li>\n<li>显示下图状态及配置成功<br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_6.jpeg\"></li>\n</ol>\n<h2 id=\"测试配置\"><a href=\"#测试配置\" class=\"headerlink\" title=\"测试配置\"></a>测试配置</h2><h4 id=\"方法一\"><a href=\"#方法一\" class=\"headerlink\" title=\"方法一:\"></a>方法一:</h4><ol>\n<li>在本地使用<code>hexo clean</code>和<code>hexo g</code>和<code>hexo d</code></li>\n<li>三连，如果想压缩后上传要使用方法二</li>\n<li>如图所示，则配置成功,查看<code>宝塔webhook</code>日志</li>\n</ol>\n<p><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/wehookw_7.jpeg\"></p>\n<h4 id=\"方法二：\"><a href=\"#方法二：\" class=\"headerlink\" title=\"方法二：\"></a>方法二：</h4><ol>\n<li>修改文章测试</li>\n<li>使用<code>gulp</code>压缩指令</li>\n<li>配置好gulp可使用，看[gulp文章配置]<br>(<a href=\"https://www.antmoe.com/posts/b411a3f8/index.html\">https://www.antmoe.com/posts/b411a3f8/index.html</a>)</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo g</span><br><span class=\"line\">gulp build &#x2F;&#x2F;相当于压缩后直接hexo d</span><br></pre></td></tr></table></figure>\n\n","categories":[{"name":"技术·教程","path":"api/categories/技术·教程.json"}],"tags":[]}