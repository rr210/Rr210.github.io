{"title":"Sakurairo主题的美化篇,底部美化","slug":"sa2","date":"2020-11-21T13:21:00.000Z","updated":"2022-06-24T03:19:00.238Z","comments":true,"path":"api/articles/sa2.json","excerpt":null,"covers":["https://cloud.mr90.top/file/imagecloud/hexo/3/35c0cd30e00f93d335cfbd36776dd2d8.jpeg"],"content":"<h2 id=\"1-底部美化\"><a href=\"#1-底部美化\" class=\"headerlink\" title=\"1.底部美化\"></a>1.底部美化</h2><blockquote>\n<p>底部加上<code ><a href=\"https://t.mr90.top/sitemap/\">站点地图</a>)</code>(教程在下篇文章中【<a href=\"https://t.mr90.top/build/sitemap_1.html\">站点地图教程</a>】关于免责声明，模仿站点地图自建代码，或者自写文章加入即可),响应时间，围观次数，评论次数，文章总数，访问者的ip地址等等，感谢作者<code>KiLLUA</code></p>\n</blockquote>\n<ul>\n<li>底部Github徽章，看文章【<a href=\"https://t.mr90.top/build/git_template.html\">Github徽章效果</a>】<br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/35c0cd30e00f93d335cfbd36776dd2d8.jpeg\" alt=\"效果\"></li>\n</ul>\n<h2 id=\"2-添加代码\"><a href=\"#2-添加代码\" class=\"headerlink\" title=\"2.添加代码\"></a>2.添加代码</h2><blockquote>\n<p>打开主题theme目录，找到funtion.php文件，将以下代码写入，记得备注，不让到时整理代码，是很难受的 ~ _ ~</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;WordPress获取站点总浏览量</span><br><span class=\"line\">function all_view() &#x2F;*注意这个函数名，调用的就是用它了*&#x2F;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">global wpdb;count&#x3D;0;</span><br><span class=\"line\">views&#x3D;wpdb-&gt;get_results(&quot;SELECT * FROM wpdb-&gt;postmeta WHERE meta_key&#x3D;&#39;views&#39;&quot;);</span><br><span class=\"line\">foreach(views as key&#x3D;&gt;value)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">meta_value&#x3D;value-&gt;meta_value;</span><br><span class=\"line\">if(meta_value!&#x3D;&#39; &#39;)</span><br><span class=\"line\">&#123;count+&#x3D;(int)meta_value;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">returncount;&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;*总评论数*&#x2F;</span><br><span class=\"line\">function pl_all()&#123;</span><br><span class=\"line\">    global wpdb;count&#x3D;0;</span><br><span class=\"line\">    count&#x3D;wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM wpdb-&gt;comments&quot;);</span><br><span class=\"line\">    returncount;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>不需要做修改</li>\n</ul>\n<h2 id=\"3-找到footer-php\"><a href=\"#3-找到footer-php\" class=\"headerlink\" title=\"3.找到footer.php\"></a>3.找到footer.php</h2><p>1.将代码加入到合适的位置，Ctrl+f找到<code>footer-device</code>标签，将以下代码复制进去即可，文字可修改。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;footer-device&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;font-family: &#x27;zhanku&#x27;, sans-serif;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #b9b9b9;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://t.mr90.top/sitemap/&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;_blank&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);&quot;</span>&gt;</span>站点地图<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;#&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;_blank&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);&quot;</span>&gt;</span>免责声明<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &lt;?php timer_stop(1); ?&gt;秒\t\t</span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span>\t\t\t</span><br><span class=\"line\">被围观了：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php echo all_view(); ?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span>次</span><br><span class=\"line\">| 总评论：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php echo pl_all()?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span>篇</span><br><span class=\"line\">| 文章总数：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php echo wp_count_posts()-&gt;publish;?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span> 篇</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#00a8ff; font-weight:bold;&quot;</span>&gt;</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">/*打开文件用于记录访问量，如果文件不存在自动创建*/</span><br><span class=\"line\">$counterFile = &quot;counter.txt&quot;;</span><br><span class=\"line\">$fp = fopen($counterFile,&quot;a+&quot;);</span><br><span class=\"line\">/*获取IP*/</span><br><span class=\"line\">$adress=$_SERVER[&quot;REMOTE_ADDR&quot;]; \t\t\t\t\t</span><br><span class=\"line\">/*统计访问量*/</span><br><span class=\"line\">$num = fgets($fp,5);</span><br><span class=\"line\">$num += 1;</span><br><span class=\"line\">print  &quot;您是第&quot;.&quot;$num&quot;.&quot; 位访客，&quot;.&quot; 您的IP是:[&quot;.&quot;$adress&quot;.&quot;]&quot;;</span><br><span class=\"line\">/*关闭文件，重新以只写的方式打开*/</span><br><span class=\"line\">fclose($fp);</span><br><span class=\"line\">$fpp=fopen($counterFile,&quot;w&quot;);</span><br><span class=\"line\">/*更新变量$fpp的值*/</span><br><span class=\"line\">fwrite($fpp, $num);</span><br><span class=\"line\">fclose($fpp);\t\t\t\t\t\t\t</span><br><span class=\"line\">?&gt;\t<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">在线人数：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">//首先你要有读写文件的权限，首次访问肯不显示，正常情况刷新即可</span><br><span class=\"line\">$online_log = &quot;maplers.dat&quot;; //保存人数的文件到根目录,</span><br><span class=\"line\">$timeout = 30;//30秒内没动作者,认为掉线</span><br><span class=\"line\">$entries = file($online_log);</span><br><span class=\"line\">$temp = array();</span><br><span class=\"line\">for ($i=0;$i&lt;count($entries);$i++)&#123;</span><br><span class=\"line\">$entry = explode(&quot;,&quot;,trim($entries[$i]));</span><br><span class=\"line\">if(($entry[0] != getenv(&#x27;REMOTE_ADDR&#x27;)) &amp;&amp; ($entry[1] &gt; time())) &#123;</span><br><span class=\"line\">array_push($temp,$entry[0].&quot;,&quot;.$entry[1].&quot;\\n&quot;); //取出其他浏览者的信息,并去掉超时者,保存进$temp</span><br><span class=\"line\">&#125;&#125;</span><br><span class=\"line\">array_push($temp,getenv(&#x27;REMOTE_ADDR&#x27;).&quot;,&quot;.(time() + ($timeout)).&quot;\\n&quot;); //更新浏览者的时间</span><br><span class=\"line\">$maplers = count($temp); //计算在线人数</span><br><span class=\"line\">$entries = implode(&quot;&quot;,$temp);</span><br><span class=\"line\">//写入文件</span><br><span class=\"line\">$fp = fopen($online_log,&quot;w&quot;);</span><br><span class=\"line\">flock($fp,LOCK_EX); //flock() 不能在NFS以及其他的一些网络文件系统中正常工作</span><br><span class=\"line\">fputs($fp,$entries);</span><br><span class=\"line\">flock($fp,LOCK_UN);</span><br><span class=\"line\">fclose($fp);</span><br><span class=\"line\">echo &quot;&quot;.$maplers.&quot;&quot;;</span><br><span class=\"line\">?&gt; <span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span>人</span><br><span class=\"line\">最后更新：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php $last = $wpdb-&gt;get_results(&quot;SELECT MAX(post_modified) AS MAX_m FROM $wpdb-&gt;posts WHERE (post_type = &#x27;post&#x27; OR post_type = &#x27;page&#x27;) AND (post_status = &#x27;publish&#x27; OR post_status = &#x27;private&#x27;)&quot;);$last = date(&#x27;Y年n月j日&#x27;, strtotime($last[0]-&gt;MAX_m));echo $last; ?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>代码文字可自行删减，建议保留主题原作者</li>\n</ul>\n","more":"<h2 id=\"1-底部美化\"><a href=\"#1-底部美化\" class=\"headerlink\" title=\"1.底部美化\"></a>1.底部美化</h2><blockquote>\n<p>底部加上<code ><a href=\"https://t.mr90.top/sitemap/\">站点地图</a>)</code>(教程在下篇文章中【<a href=\"https://t.mr90.top/build/sitemap_1.html\">站点地图教程</a>】关于免责声明，模仿站点地图自建代码，或者自写文章加入即可),响应时间，围观次数，评论次数，文章总数，访问者的ip地址等等，感谢作者<code>KiLLUA</code></p>\n</blockquote>\n<ul>\n<li>底部Github徽章，看文章【<a href=\"https://t.mr90.top/build/git_template.html\">Github徽章效果</a>】<br><img src=\"https://cloud.mr90.top/file/imagecloud/hexo/3/35c0cd30e00f93d335cfbd36776dd2d8.jpeg\" alt=\"效果\"></li>\n</ul>\n<h2 id=\"2-添加代码\"><a href=\"#2-添加代码\" class=\"headerlink\" title=\"2.添加代码\"></a>2.添加代码</h2><blockquote>\n<p>打开主题theme目录，找到funtion.php文件，将以下代码写入，记得备注，不让到时整理代码，是很难受的 ~ _ ~</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;WordPress获取站点总浏览量</span><br><span class=\"line\">function all_view() &#x2F;*注意这个函数名，调用的就是用它了*&#x2F;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">global wpdb;count&#x3D;0;</span><br><span class=\"line\">views&#x3D;wpdb-&gt;get_results(&quot;SELECT * FROM wpdb-&gt;postmeta WHERE meta_key&#x3D;&#39;views&#39;&quot;);</span><br><span class=\"line\">foreach(views as key&#x3D;&gt;value)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">meta_value&#x3D;value-&gt;meta_value;</span><br><span class=\"line\">if(meta_value!&#x3D;&#39; &#39;)</span><br><span class=\"line\">&#123;count+&#x3D;(int)meta_value;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">returncount;&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;*总评论数*&#x2F;</span><br><span class=\"line\">function pl_all()&#123;</span><br><span class=\"line\">    global wpdb;count&#x3D;0;</span><br><span class=\"line\">    count&#x3D;wpdb-&gt;get_var(&quot;SELECT COUNT(*) FROM wpdb-&gt;comments&quot;);</span><br><span class=\"line\">    returncount;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>不需要做修改</li>\n</ul>\n<h2 id=\"3-找到footer-php\"><a href=\"#3-找到footer-php\" class=\"headerlink\" title=\"3.找到footer.php\"></a>3.找到footer.php</h2><p>1.将代码加入到合适的位置，Ctrl+f找到<code>footer-device</code>标签，将以下代码复制进去即可，文字可修改。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;footer-device&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;font-family: &#x27;zhanku&#x27;, sans-serif;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #b9b9b9;&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;https://t.mr90.top/sitemap/&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;_blank&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);&quot;</span>&gt;</span>站点地图<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;#&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;_blank&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);&quot;</span>&gt;</span>免责声明<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> | &lt;?php timer_stop(1); ?&gt;秒\t\t</span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span>\t\t\t</span><br><span class=\"line\">被围观了：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php echo all_view(); ?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span>次</span><br><span class=\"line\">| 总评论：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php echo pl_all()?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span>篇</span><br><span class=\"line\">| 文章总数：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php echo wp_count_posts()-&gt;publish;?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span> 篇</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#00a8ff; font-weight:bold;&quot;</span>&gt;</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">/*打开文件用于记录访问量，如果文件不存在自动创建*/</span><br><span class=\"line\">$counterFile = &quot;counter.txt&quot;;</span><br><span class=\"line\">$fp = fopen($counterFile,&quot;a+&quot;);</span><br><span class=\"line\">/*获取IP*/</span><br><span class=\"line\">$adress=$_SERVER[&quot;REMOTE_ADDR&quot;]; \t\t\t\t\t</span><br><span class=\"line\">/*统计访问量*/</span><br><span class=\"line\">$num = fgets($fp,5);</span><br><span class=\"line\">$num += 1;</span><br><span class=\"line\">print  &quot;您是第&quot;.&quot;$num&quot;.&quot; 位访客，&quot;.&quot; 您的IP是:[&quot;.&quot;$adress&quot;.&quot;]&quot;;</span><br><span class=\"line\">/*关闭文件，重新以只写的方式打开*/</span><br><span class=\"line\">fclose($fp);</span><br><span class=\"line\">$fpp=fopen($counterFile,&quot;w&quot;);</span><br><span class=\"line\">/*更新变量$fpp的值*/</span><br><span class=\"line\">fwrite($fpp, $num);</span><br><span class=\"line\">fclose($fpp);\t\t\t\t\t\t\t</span><br><span class=\"line\">?&gt;\t<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">在线人数：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">//首先你要有读写文件的权限，首次访问肯不显示，正常情况刷新即可</span><br><span class=\"line\">$online_log = &quot;maplers.dat&quot;; //保存人数的文件到根目录,</span><br><span class=\"line\">$timeout = 30;//30秒内没动作者,认为掉线</span><br><span class=\"line\">$entries = file($online_log);</span><br><span class=\"line\">$temp = array();</span><br><span class=\"line\">for ($i=0;$i&lt;count($entries);$i++)&#123;</span><br><span class=\"line\">$entry = explode(&quot;,&quot;,trim($entries[$i]));</span><br><span class=\"line\">if(($entry[0] != getenv(&#x27;REMOTE_ADDR&#x27;)) &amp;&amp; ($entry[1] &gt; time())) &#123;</span><br><span class=\"line\">array_push($temp,$entry[0].&quot;,&quot;.$entry[1].&quot;\\n&quot;); //取出其他浏览者的信息,并去掉超时者,保存进$temp</span><br><span class=\"line\">&#125;&#125;</span><br><span class=\"line\">array_push($temp,getenv(&#x27;REMOTE_ADDR&#x27;).&quot;,&quot;.(time() + ($timeout)).&quot;\\n&quot;); //更新浏览者的时间</span><br><span class=\"line\">$maplers = count($temp); //计算在线人数</span><br><span class=\"line\">$entries = implode(&quot;&quot;,$temp);</span><br><span class=\"line\">//写入文件</span><br><span class=\"line\">$fp = fopen($online_log,&quot;w&quot;);</span><br><span class=\"line\">flock($fp,LOCK_EX); //flock() 不能在NFS以及其他的一些网络文件系统中正常工作</span><br><span class=\"line\">fputs($fp,$entries);</span><br><span class=\"line\">flock($fp,LOCK_UN);</span><br><span class=\"line\">fclose($fp);</span><br><span class=\"line\">echo &quot;&quot;.$maplers.&quot;&quot;;</span><br><span class=\"line\">?&gt; <span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span>人</span><br><span class=\"line\">最后更新：<span class=\"tag\">&lt;<span class=\"name\">font</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;color:#F00; font-weight:bold;&quot;</span>&gt;</span>&lt;?php $last = $wpdb-&gt;get_results(&quot;SELECT MAX(post_modified) AS MAX_m FROM $wpdb-&gt;posts WHERE (post_type = &#x27;post&#x27; OR post_type = &#x27;page&#x27;) AND (post_status = &#x27;publish&#x27; OR post_status = &#x27;private&#x27;)&quot;);$last = date(&#x27;Y年n月j日&#x27;, strtotime($last[0]-&gt;MAX_m));echo $last; ?&gt;<span class=\"tag\">&lt;/<span class=\"name\">font</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>代码文字可自行删减，建议保留主题原作者</li>\n</ul>\n","categories":[{"name":"技术·教程","path":"api/categories/技术·教程.json"}],"tags":[]}