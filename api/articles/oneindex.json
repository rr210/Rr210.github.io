{"title":"自建网盘利用OneDrive，oneindex网盘","slug":"oneindex","date":"2020-12-16T09:17:36.000Z","updated":"2021-10-06T02:02:46.736Z","comments":true,"path":"api/articles/oneindex.json","excerpt":null,"covers":["https://img-blog.csdnimg.cn/img_convert/593ee510a026a5c4dfe8e0204d8c4889.png","https://img-blog.csdnimg.cn/img_convert/85bd178412ea2ef928ea472e0134b76a.png","https://img-blog.csdnimg.cn/img_convert/e25f8a1d7a76e633a22d68a6258096a9.png","https://img-blog.csdnimg.cn/img_convert/79fffd963f3e055f481e1b13cd251844.png","https://img-blog.csdnimg.cn/img_convert/7913ab22a831027e3e8a152e0308efe6.png","https://img-blog.csdnimg.cn/img_convert/a8b308976dc815a4b20d6ee06095723d.png"],"content":"<blockquote>\n<p>Oneindex不占用服务器空间，不走服务器流量，直接列出 OneDrive 目录，文件直链下载有微软账号即可</p>\n</blockquote>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li><p>微软账号(刚注册的内存空间只有5G大小，需要扩宽内存可自行百度)</p>\n</li>\n<li><p>下载oneindex的源码上传到自己的服务器即可</p>\n</li>\n<li><p>准备一个域名，或者放到自己域名的非根目录下</p>\n</li>\n<li><p>服务器要求PHP空间，PHP 5.6+ 需打开curl支持</p>\n<h2 id=\"下载源码并上传\"><a href=\"#下载源码并上传\" class=\"headerlink\" title=\"下载源码并上传\"></a>下载源码并上传</h2></li>\n</ol>\n<ul>\n<li><a href=\"\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n<li>下载后上传到服务器，根目录或者其他目录，按需安装</li>\n</ul>\n<h2 id=\"配置教程\"><a href=\"#配置教程\" class=\"headerlink\" title=\"配置教程\"></a>配置教程</h2><p>登录设定的域名，开始部署配置</p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/593ee510a026a5c4dfe8e0204d8c4889.png\"><br><img src=\"https://img-blog.csdnimg.cn/img_convert/c7faab6d7764039c79cb0a49182288b5.png\"><br><code>注:第三空将域名填入即可</code></p>\n<blockquote>\n<p>点击蓝色按钮获取<code>client_id</code>和<code>client_secret</code></p>\n</blockquote>\n<ul>\n<li><p><input disabled=\"\" type=\"checkbox\">  client_secret</p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/85bd178412ea2ef928ea472e0134b76a.png\"></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\">  client_id</p>\n<blockquote>\n<p>点击上方图片所示的知道了返回快速启动，下滑找到<code>client_id</code></p>\n</blockquote>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/e25f8a1d7a76e633a22d68a6258096a9.png\"></p>\n</li>\n<li><p>确认信息后点击下一步</p>\n</li>\n<li><p><a href=\"\" target=\"_blank\" rel=\"noopener\">演示地址</a> 效果主题为以下主题，按照指示修改即可 </p>\n<h2 id=\"主题使用方法\"><a href=\"#主题使用方法\" class=\"headerlink\" title=\"主题使用方法\"></a>主题使用方法</h2></li>\n</ul>\n<blockquote>\n<p>主题包中的信息需要修改 主题包<a href=\"\" target=\"_blank\" rel=\"noopener\">下载地址</a></p>\n</blockquote>\n<ol>\n<li><p>找到 <code>nexmoe</code> 下 <code>layout.php</code> 使用打开</p>\n<p>修改 第7行 、第9行 第18行 pan.mr90.top为自己域名（或者自己引用的目录）</p>\n<p>修改 第15行 链接里的QQ 为自己QQ（或者自己引用的图片）</p>\n</li>\n<li><p>打开 <code>theme</code> 下 <code>style.css</code> 文件</p>\n<p>修改 第97行、第103行 <code>pan.mr90.top</code> 为自己域名（或者自己引用的目录）</p>\n<p>请删除原有 <code>nexmoe</code> 主题文件夹，将压缩包内 <code>nexmoe</code> 复制到该位置。</p>\n</li>\n<li><p>将 <code>theme</code> 文件夹放在网站根目录.（或者别的地方，可以引用就好）</p>\n</li>\n</ol>\n<h2 id=\"Oneindex文件描述\"><a href=\"#Oneindex文件描述\" class=\"headerlink\" title=\"Oneindex文件描述\"></a>Oneindex文件描述</h2><blockquote>\n<p>文件描述仿照<code>Github</code>的README.md文件</p>\n</blockquote>\n<ol>\n<li><p>在文件夹底部添加说明</p>\n<pre><code>在 OneDrive 的文件夹中添加`README.md`文件，使用 Markdown 语法。\n</code></pre>\n</li>\n<li><p>在文件夹头部添加说明:</p>\n<pre><code>在 OneDrive 的文件夹中添加`HEAD.md` 文件，使用 Markdown 语法。\n</code></pre>\n</li>\n<li><p>直接输出网页</p>\n<pre><code>在 OneDrive 的文件夹中添加`index.html` 文件，程序会直接输出网页而不列目录。\n</code></pre>\n<p>配合 文件展示设置-直接输出 效果更佳。</p>\n</li>\n</ol>\n<p><code>如图所示</code></p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/79fffd963f3e055f481e1b13cd251844.png\"></p>\n<h3 id=\"给文件夹加密码\"><a href=\"#给文件夹加密码\" class=\"headerlink\" title=\"给文件夹加密码\"></a>给文件夹加密码</h3><ul>\n<li>新建一个名为<code>.password</code>的无后缀格式文件，在其中输入密码</li>\n</ul>\n<p><code>如图所示</code><br><img src=\"https://img-blog.csdnimg.cn/img_convert/7913ab22a831027e3e8a152e0308efe6.png\"><br><code>注</code>密码写入文件夹即可，可以直接在需要加密的文件夹中创建，注意修改文件时看是否有文件后缀(不要犯这个低级错误)</p>\n<h2 id=\"可能出现的问题\"><a href=\"#可能出现的问题\" class=\"headerlink\" title=\"可能出现的问题\"></a>可能出现的问题</h2><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 安装配置后，域名链接出现了/?/ 如何去掉？</li>\n<li><input disabled=\"\" type=\"checkbox\"> 配置网站的伪静态，代码如下</li>\n<li><input disabled=\"\" type=\"checkbox\"> Nginx 伪静态设置</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!-f $request_filename)&#123;</span><br><span class=\"line\">set $rule_0 1$rule_0;&#125;</span><br><span class=\"line\">if (!-d $request_filename)&#123;</span><br><span class=\"line\">set $rule_0 2$rule_0;&#125;</span><br><span class=\"line\">if ($rule_0 &#x3D; &quot;21&quot;)&#123;</span><br><span class=\"line\">rewrite ^&#x2F;(.*)$ &#x2F;index.php?&#x2F;$1 last;&#125;</span><br></pre></td></tr></table></figure>\n<p><code>后台</code>打开去掉<code>/?/ </code>(需配合伪静态使用!!)，保存设置</p>\n<h2 id=\"命令指示\"><a href=\"#命令指示\" class=\"headerlink\" title=\"命令指示\"></a>命令指示</h2><blockquote>\n<p>终端命令</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;仅能在PHP CLI模式下运行</span><br><span class=\"line\">&#x2F;&#x2F;清除缓存：</span><br><span class=\"line\">php one.php cache:clear</span><br><span class=\"line\">&#x2F;&#x2F;刷新缓存：</span><br><span class=\"line\">php one.php cache:refresh</span><br><span class=\"line\">&#x2F;&#x2F;刷新令牌：</span><br><span class=\"line\">php one.php token:refresh</span><br><span class=\"line\">&#x2F;&#x2F;上传文件：</span><br><span class=\"line\">php one.php upload:file 本地文件 [OneDrive文件]</span><br><span class=\"line\">&#x2F;&#x2F;上传文件夹：</span><br><span class=\"line\">php one.php upload:folder 本地文件夹 [OneDrive文件夹]</span><br></pre></td></tr></table></figure>\n<p><code>例如：</code></p>\n<ul>\n<li>//上传<code>temp.zip</code> 到OneDrive <code>根目录</code><br>php one.php upload:file temp.zip</li>\n<li>//上传<code>temp.zip</code> 到OneDrive <code>/test/</code>目录<br>php one.php upload:file temp.zip /test/</li>\n<li>//上传<code>temp.zip</code> 到OneDrive <code>/test/</code>目录并将其命名为 <code>ad.zip</code><br>php one.php upload:file temp.zip /test/ad.zip</li>\n<li>//上传 <code>temp/</code>到OneDrive <code>/test/</code>目录(<code>temp/</code>为文件夹)<br>php one.php upload:file temp/ /test/</li>\n</ul>\n<h2 id=\"定时清除缓存\"><a href=\"#定时清除缓存\" class=\"headerlink\" title=\"定时清除缓存\"></a>定时清除缓存</h2><ul>\n<li>设置一个定时清除缓存任务</li>\n<li>利用宝塔的计划任务</li>\n<li>代码如下</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*&#x2F;10 * * * * php &#x2F;www&#x2F;wwwroot&#x2F;pan.mr90.top&#x2F;one.php cache:refresh</span><br></pre></td></tr></table></figure>\n<p><code>如图所示</code></p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/a8b308976dc815a4b20d6ee06095723d.png\"></p>\n","more":"<blockquote>\n<p>Oneindex不占用服务器空间，不走服务器流量，直接列出 OneDrive 目录，文件直链下载有微软账号即可</p>\n</blockquote>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li><p>微软账号(刚注册的内存空间只有5G大小，需要扩宽内存可自行百度)</p>\n</li>\n<li><p>下载oneindex的源码上传到自己的服务器即可</p>\n</li>\n<li><p>准备一个域名，或者放到自己域名的非根目录下</p>\n</li>\n<li><p>服务器要求PHP空间，PHP 5.6+ 需打开curl支持</p>\n<h2 id=\"下载源码并上传\"><a href=\"#下载源码并上传\" class=\"headerlink\" title=\"下载源码并上传\"></a>下载源码并上传</h2></li>\n</ol>\n<ul>\n<li><a href=\"\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n<li>下载后上传到服务器，根目录或者其他目录，按需安装</li>\n</ul>\n<h2 id=\"配置教程\"><a href=\"#配置教程\" class=\"headerlink\" title=\"配置教程\"></a>配置教程</h2><p>登录设定的域名，开始部署配置</p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/593ee510a026a5c4dfe8e0204d8c4889.png\"><br><img src=\"https://img-blog.csdnimg.cn/img_convert/c7faab6d7764039c79cb0a49182288b5.png\"><br><code>注:第三空将域名填入即可</code></p>\n<blockquote>\n<p>点击蓝色按钮获取<code>client_id</code>和<code>client_secret</code></p>\n</blockquote>\n<ul>\n<li><p><input disabled=\"\" type=\"checkbox\">  client_secret</p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/85bd178412ea2ef928ea472e0134b76a.png\"></p>\n</li>\n<li><p><input disabled=\"\" type=\"checkbox\">  client_id</p>\n<blockquote>\n<p>点击上方图片所示的知道了返回快速启动，下滑找到<code>client_id</code></p>\n</blockquote>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/e25f8a1d7a76e633a22d68a6258096a9.png\"></p>\n</li>\n<li><p>确认信息后点击下一步</p>\n</li>\n<li><p><a href=\"\" target=\"_blank\" rel=\"noopener\">演示地址</a> 效果主题为以下主题，按照指示修改即可 </p>\n<h2 id=\"主题使用方法\"><a href=\"#主题使用方法\" class=\"headerlink\" title=\"主题使用方法\"></a>主题使用方法</h2></li>\n</ul>\n<blockquote>\n<p>主题包中的信息需要修改 主题包<a href=\"\" target=\"_blank\" rel=\"noopener\">下载地址</a></p>\n</blockquote>\n<ol>\n<li><p>找到 <code>nexmoe</code> 下 <code>layout.php</code> 使用打开</p>\n<p>修改 第7行 、第9行 第18行 pan.mr90.top为自己域名（或者自己引用的目录）</p>\n<p>修改 第15行 链接里的QQ 为自己QQ（或者自己引用的图片）</p>\n</li>\n<li><p>打开 <code>theme</code> 下 <code>style.css</code> 文件</p>\n<p>修改 第97行、第103行 <code>pan.mr90.top</code> 为自己域名（或者自己引用的目录）</p>\n<p>请删除原有 <code>nexmoe</code> 主题文件夹，将压缩包内 <code>nexmoe</code> 复制到该位置。</p>\n</li>\n<li><p>将 <code>theme</code> 文件夹放在网站根目录.（或者别的地方，可以引用就好）</p>\n</li>\n</ol>\n<h2 id=\"Oneindex文件描述\"><a href=\"#Oneindex文件描述\" class=\"headerlink\" title=\"Oneindex文件描述\"></a>Oneindex文件描述</h2><blockquote>\n<p>文件描述仿照<code>Github</code>的README.md文件</p>\n</blockquote>\n<ol>\n<li><p>在文件夹底部添加说明</p>\n<pre><code>在 OneDrive 的文件夹中添加`README.md`文件，使用 Markdown 语法。\n</code></pre>\n</li>\n<li><p>在文件夹头部添加说明:</p>\n<pre><code>在 OneDrive 的文件夹中添加`HEAD.md` 文件，使用 Markdown 语法。\n</code></pre>\n</li>\n<li><p>直接输出网页</p>\n<pre><code>在 OneDrive 的文件夹中添加`index.html` 文件，程序会直接输出网页而不列目录。\n</code></pre>\n<p>配合 文件展示设置-直接输出 效果更佳。</p>\n</li>\n</ol>\n<p><code>如图所示</code></p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/79fffd963f3e055f481e1b13cd251844.png\"></p>\n<h3 id=\"给文件夹加密码\"><a href=\"#给文件夹加密码\" class=\"headerlink\" title=\"给文件夹加密码\"></a>给文件夹加密码</h3><ul>\n<li>新建一个名为<code>.password</code>的无后缀格式文件，在其中输入密码</li>\n</ul>\n<p><code>如图所示</code><br><img src=\"https://img-blog.csdnimg.cn/img_convert/7913ab22a831027e3e8a152e0308efe6.png\"><br><code>注</code>密码写入文件夹即可，可以直接在需要加密的文件夹中创建，注意修改文件时看是否有文件后缀(不要犯这个低级错误)</p>\n<h2 id=\"可能出现的问题\"><a href=\"#可能出现的问题\" class=\"headerlink\" title=\"可能出现的问题\"></a>可能出现的问题</h2><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 安装配置后，域名链接出现了/?/ 如何去掉？</li>\n<li><input disabled=\"\" type=\"checkbox\"> 配置网站的伪静态，代码如下</li>\n<li><input disabled=\"\" type=\"checkbox\"> Nginx 伪静态设置</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!-f $request_filename)&#123;</span><br><span class=\"line\">set $rule_0 1$rule_0;&#125;</span><br><span class=\"line\">if (!-d $request_filename)&#123;</span><br><span class=\"line\">set $rule_0 2$rule_0;&#125;</span><br><span class=\"line\">if ($rule_0 &#x3D; &quot;21&quot;)&#123;</span><br><span class=\"line\">rewrite ^&#x2F;(.*)$ &#x2F;index.php?&#x2F;$1 last;&#125;</span><br></pre></td></tr></table></figure>\n<p><code>后台</code>打开去掉<code>/?/ </code>(需配合伪静态使用!!)，保存设置</p>\n<h2 id=\"命令指示\"><a href=\"#命令指示\" class=\"headerlink\" title=\"命令指示\"></a>命令指示</h2><blockquote>\n<p>终端命令</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;仅能在PHP CLI模式下运行</span><br><span class=\"line\">&#x2F;&#x2F;清除缓存：</span><br><span class=\"line\">php one.php cache:clear</span><br><span class=\"line\">&#x2F;&#x2F;刷新缓存：</span><br><span class=\"line\">php one.php cache:refresh</span><br><span class=\"line\">&#x2F;&#x2F;刷新令牌：</span><br><span class=\"line\">php one.php token:refresh</span><br><span class=\"line\">&#x2F;&#x2F;上传文件：</span><br><span class=\"line\">php one.php upload:file 本地文件 [OneDrive文件]</span><br><span class=\"line\">&#x2F;&#x2F;上传文件夹：</span><br><span class=\"line\">php one.php upload:folder 本地文件夹 [OneDrive文件夹]</span><br></pre></td></tr></table></figure>\n<p><code>例如：</code></p>\n<ul>\n<li>//上传<code>temp.zip</code> 到OneDrive <code>根目录</code><br>php one.php upload:file temp.zip</li>\n<li>//上传<code>temp.zip</code> 到OneDrive <code>/test/</code>目录<br>php one.php upload:file temp.zip /test/</li>\n<li>//上传<code>temp.zip</code> 到OneDrive <code>/test/</code>目录并将其命名为 <code>ad.zip</code><br>php one.php upload:file temp.zip /test/ad.zip</li>\n<li>//上传 <code>temp/</code>到OneDrive <code>/test/</code>目录(<code>temp/</code>为文件夹)<br>php one.php upload:file temp/ /test/</li>\n</ul>\n<h2 id=\"定时清除缓存\"><a href=\"#定时清除缓存\" class=\"headerlink\" title=\"定时清除缓存\"></a>定时清除缓存</h2><ul>\n<li>设置一个定时清除缓存任务</li>\n<li>利用宝塔的计划任务</li>\n<li>代码如下</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*&#x2F;10 * * * * php &#x2F;www&#x2F;wwwroot&#x2F;pan.mr90.top&#x2F;one.php cache:refresh</span><br></pre></td></tr></table></figure>\n<p><code>如图所示</code></p>\n<p><img src=\"https://img-blog.csdnimg.cn/img_convert/a8b308976dc815a4b20d6ee06095723d.png\"></p>\n","categories":[{"name":"技术·教程","path":"api/categories/技术·教程.json"}],"tags":[]}