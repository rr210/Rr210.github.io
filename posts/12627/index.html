<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ES6-基础知识 | Harry の 心 阁</title><meta name="author" content="Harry"><meta name="copyright" content="Harry"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="let 和 const命令 ✔ 在ES6中, 我们通常使用 let 表示变量, const 表示常量, 并且 let 和 const 都是块级作用域, 且在当前作用域有效不能重复声明.  let 命令 let 命令的用法和 var 相似, 但是 let 只在所在代码块内有效.     基础用法:  1234&amp;#123;  let a &#x3D; 1;  let b &#x3D; 2;&amp;#125;  并且 let 有"><meta property="og:type" content="article"><meta property="og:title" content="ES6-基础知识"><meta property="og:url" content="https://u.mr90.top/posts/12627/index.html"><meta property="og:site_name" content="Harry の 心 阁"><meta property="og:description" content="let 和 const命令 ✔ 在ES6中, 我们通常使用 let 表示变量, const 表示常量, 并且 let 和 const 都是块级作用域, 且在当前作用域有效不能重复声明.  let 命令 let 命令的用法和 var 相似, 但是 let 只在所在代码块内有效.     基础用法:  1234&amp;#123;  let a &#x3D; 1;  let b &#x3D; 2;&amp;#125;  并且 let 有"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/api/dawddsa1231123w.png"><meta property="article:published_time" content="2021-07-22T02:18:18.000Z"><meta property="article:modified_time" content="2021-08-28T09:44:48.871Z"><meta property="article:author" content="Harry"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/api/dawddsa1231123w.png"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Rr210/image@master/admin/faa.ico"><link rel="canonical" href="https://u.mr90.top/posts/12627/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"other/search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"ES6-基础知识",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-08-28 17:44:48"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/api/d2f38e94.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome-animation@0.2.1/dist/font-awesome-animation.min.css"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/other/atom.xml" title="Harry の 心 阁" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/Rr210/image@master/admin/qqavatar.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">85</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i> <span>找文章</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/article/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/article/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/other/frame/"><i class="fa-fw fas fa-cube"></i> <span>框架</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/other/message/"><i class="fa-fw fas fa-feather-alt"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://status.mr99.top/"><i class="fa-fw fas fa-spider"></i> <span>网站健康</span></a></div><div class="menus_item"><a class="site-page" href="/other/link/"><i class="fa-fw fas fa-link"></i> <span>友友屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-user-check"></i> <span>进站须知</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/other/about/"><i class="fa-fw fas fa-info"></i> <span>关于我</span></a></li><li><a class="site-page child" href="/other/terms/"><i class="fa-fw fas fa-book-reader"></i> <span>免责声明</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Harry の 心 阁</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i> <span>找文章</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/article/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/article/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/other/frame/"><i class="fa-fw fas fa-cube"></i> <span>框架</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/other/message/"><i class="fa-fw fas fa-feather-alt"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://status.mr99.top/"><i class="fa-fw fas fa-spider"></i> <span>网站健康</span></a></div><div class="menus_item"><a class="site-page" href="/other/link/"><i class="fa-fw fas fa-link"></i> <span>友友屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-user-check"></i> <span>进站须知</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/other/about/"><i class="fa-fw fas fa-info"></i> <span>关于我</span></a></li><li><a class="site-page child" href="/other/terms/"><i class="fa-fw fas fa-book-reader"></i> <span>免责声明</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">ES6-基础知识<span class="topheader-line"></span></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-07-22T02:18:18.000Z" title="发表于 2021-07-22 10:18:18">2021-07-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-08-28T09:44:48.871Z" title="更新于 2021-08-28 17:44:48">2021-08-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/web/">web</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/web/Javascript/">Javascript</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">23.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>102分钟</span></span></div></div></div><article class="post-content" id="article-container"><h2 id="let-和-const命令-✔"><a href="#let-和-const命令-✔" class="headerlink" title="let 和 const命令 ✔"></a>let 和 const命令 ✔</h2><blockquote><p>在ES6中, 我们通常使用 <code>let</code> 表示<strong>变量</strong>, <code>const</code> 表示<strong>常量</strong>, 并且 <code>let</code> 和 <code>const</code> 都是<strong>块级作用域</strong>, 且在<strong>当前作用域有效</strong>不能重复声明.</p></blockquote><h3 id="let-命令"><a href="#let-命令" class="headerlink" title="let 命令"></a>let 命令</h3><ol><li><code>let</code> 命令的用法和 <code>var</code> 相似, 但是 <code>let</code> 只在所在代码块内有效.</li></ol><ul><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>并且 <code>let</code> 有以下特点:</li></ol><ul><li>不存在变量提升:<br>在ES6之前, 我们 <code>var</code> 声明一个<strong>变量</strong>一个<strong>函数</strong>, 都会伴随着变量提升的问题, 导致实际开发过程经常出现一些逻辑上的疑惑, 按照一般思维习惯, 变量都是需要先声明后使用.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var </span></span><br><span class="line"><span class="built_in">console</span>.log(v1); <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> v1 = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 由于变量提升 代码实际如下</span></span><br><span class="line"><span class="keyword">var</span> v1;</span><br><span class="line"><span class="built_in">console</span>.log(v1)</span><br><span class="line">v1 = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// let </span></span><br><span class="line"><span class="built_in">console</span>.log(v2); <span class="comment">// ReferenceError</span></span><br><span class="line"><span class="keyword">let</span> v2 = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><ul><li>不允许重复声明:<br><code>let</code> 和 <code>const</code> 在<strong>相同作用域下</strong>, 都<strong>不能重复声明同一变量</strong>, 并且<strong>不能在函数内重新声明参数</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 不能重复声明同一变量</span></span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 不能在函数内重新声明参数</span></span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params">a1</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f4</span>(<span class="params">a2</span>) </span>&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> a2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="const-命令"><a href="#const-命令" class="headerlink" title="const 命令"></a>const 命令</h3><p><code>const</code> 声明一个<strong>只读</strong>的<strong>常量</strong>.</p><ul><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PI = <span class="number">3.1415926</span>;</span><br><span class="line"><span class="built_in">console</span>.log(PI); <span class="comment">// 3.1415926</span></span><br></pre></td></tr></table></figure><p><code>注意点</code> :</p><ul><li><code>const</code> 声明后, 无法修改值;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PI = <span class="number">3.1415926</span>;</span><br><span class="line">PI = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// TypeError: Assignment to constant variable.</span></span><br></pre></td></tr></table></figure><ul><li><code>const</code> 声明时, 必须赋值;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a;</span><br><span class="line"><span class="comment">// SyntaxError: Missing initializer in const declaration.</span></span><br></pre></td></tr></table></figure><ul><li><code>const</code> 声明的常量, <code>let</code> 不能重复声明;</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PI = <span class="number">3.1415926</span>;</span><br><span class="line"><span class="keyword">let</span> PI = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// Uncaught SyntaxError: Identifier &#x27;PI&#x27; has already been declared</span></span><br></pre></td></tr></table></figure><h2 id="变量的解构赋值-✔"><a href="#变量的解构赋值-✔" class="headerlink" title="变量的解构赋值 ✔"></a>变量的解构赋值 ✔</h2><ul><li>解构赋值概念: 在ES6中, 直接从数组和对象中取值, 按照对应位置, 赋值给变量的操作.</li></ul><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><ul><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6 之前</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 之后</span></span><br><span class="line"><span class="keyword">let</span> [a, b] = [<span class="number">1</span>, <span class="number">2</span>];</span><br></pre></td></tr></table></figure><ul><li>本质上, 只要等号两边模式一致, 左边变量即可获取右边对应位置的值, 更多用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, [</span><br><span class="line">  [b], c</span><br><span class="line">]] = [<span class="number">1</span>, [</span><br><span class="line">  [<span class="number">2</span>], <span class="number">3</span></span><br><span class="line">]];</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c); <span class="comment">// 1, 2, 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [, , c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, , c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a, c); <span class="comment">// 1, 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, ...b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">// 1, [2,3]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, b, ..c.] = [<span class="number">1</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c); <span class="comment">// 1, undefined, []</span></span><br></pre></td></tr></table></figure><p><code>注意点</code> :</p><ul><li>如果解构不成功, 变量的值就等于<code>undefined</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a] = []; <span class="comment">// a =&gt; undefined</span></span><br><span class="line"><span class="keyword">let</span> [a1, b1] = [<span class="number">1</span>]; <span class="comment">// a1 =&gt; 1 , b1 =&gt; undefined</span></span><br></pre></td></tr></table></figure><ul><li>当右边模式多于左边, 也可以解构成功.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(a, b); <span class="comment">// 1, 2</span></span><br></pre></td></tr></table></figure><ul><li>两边模式不同, 报错.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> [a] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">let</span> [a] = <span class="literal">NaN</span>;</span><br><span class="line"><span class="keyword">let</span> [a] = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> [a] = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> [a] = &#123;&#125;;</span><br></pre></td></tr></table></figure><ul><li>指定解构的默认值:</li><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a = <span class="number">1</span>] = []; <span class="comment">// a =&gt; 1</span></span><br><span class="line"><span class="keyword">let</span> [a, b = <span class="number">2</span>] = [a]; <span class="comment">// a =&gt; 1 , b =&gt; 2</span></span><br></pre></td></tr></table></figure><ul><li>特殊情况:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a = <span class="number">1</span>] = [<span class="literal">undefined</span>]; <span class="comment">// a =&gt; 1</span></span><br><span class="line"><span class="keyword">let</span> [a = <span class="number">1</span>] = [<span class="literal">null</span>]; <span class="comment">// a =&gt; null</span></span><br></pre></td></tr></table></figure><ul><li>右边模式对应的值, 必须严格等于<code>undefined</code>, 默认值才能生效, 而<code>null</code>不严格等于<code>undefined</code>.</li></ul><h3 id="对象的解构赋值"><a href="#对象的解构赋值" class="headerlink" title="对象的解构赋值"></a>对象的解构赋值</h3><blockquote><p>与数组解构不同的是, 对象解构<strong>不需要严格按照顺序取值</strong>, 而只要按照<strong>变量名</strong>去取对应<strong>属性名</strong>的值, 若取不到对应<strong>属性名</strong>的值, 则为 <code>undefined</code></p></blockquote><ul><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span></span><br><span class="line">&#125;; <span class="comment">// a =&gt; 1 , b =&gt; 2</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="number">2</span>,</span><br><span class="line">  b: <span class="number">1</span></span><br><span class="line">&#125;; <span class="comment">// a =&gt; 2 , b =&gt; 1</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="number">3</span>,</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">  c: <span class="number">1</span></span><br><span class="line">&#125;; <span class="comment">// a =&gt; 3</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">  c: <span class="number">1</span></span><br><span class="line">&#125;; <span class="comment">// a =&gt; undefined</span></span><br></pre></td></tr></table></figure><p><code>注意点</code> :</p><ul><li>若<strong>变量名</strong>和<strong>属性名</strong>不一致, 则需要修改名称.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a: b</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  c: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// error: a is not defined</span></span><br><span class="line"><span class="comment">// b =&gt; 1</span></span><br></pre></td></tr></table></figure><p>对象的解构赋值的内部机制, 是先找到同名属性, 然后再赋给对应的变量. 真正被赋值的是后者, 而不是前者.<br>上面代码中, <code>a</code> 是匹配的模式, <code>b</code> 才是变量. 真正被赋值的是变量 <code>b</code> , 而不是模式 <code>a</code> .</p><ul><li>对象解构也支持<strong>嵌套解构</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  a: [<span class="number">1</span>, &#123;</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  a: [c, &#123;</span><br><span class="line">    b</span><br><span class="line">  &#125;]</span><br><span class="line">&#125; = obj;</span><br><span class="line"><span class="comment">// a=&gt;[1, &#123;b: 2&#125;], b =&gt; 2, c =&gt; 1</span></span><br></pre></td></tr></table></figure><p><strong>指定解构的默认值</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a = <span class="number">1</span></span><br><span class="line">&#125; = &#123;&#125;; <span class="comment">// a =&gt; 1</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b = <span class="number">1</span></span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="number">2</span></span><br><span class="line">&#125;; <span class="comment">// a =&gt; 2, b =&gt; 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a: b = <span class="number">3</span></span><br><span class="line">&#125; = &#123;&#125;; <span class="comment">// b =&gt; 3</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a: b = <span class="number">3</span></span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="number">4</span></span><br><span class="line">&#125;; <span class="comment">// b = &gt;4</span></span><br><span class="line"><span class="comment">// a是模式，b是变量 牢记</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a = <span class="number">1</span></span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="literal">undefined</span></span><br><span class="line">&#125;; <span class="comment">// a =&gt; 1</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a = <span class="number">1</span></span><br><span class="line">&#125; = &#123;</span><br><span class="line">  a: <span class="literal">null</span></span><br><span class="line">&#125;; <span class="comment">// a =&gt; null</span></span><br><span class="line"><span class="comment">// 因为null与undefined不严格相等，所以赋值有效</span></span><br><span class="line"><span class="comment">// 导致默认值1不会生效。</span></span><br></pre></td></tr></table></figure><h3 id="字符串的解构赋值"><a href="#字符串的解构赋值" class="headerlink" title="字符串的解构赋值"></a>字符串的解构赋值</h3><p>字符串的解构赋值中, 字符串被转换成了一个<strong>类似数组的对象</strong>.</p><ul><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [a, b, c, d, e] = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">a <span class="comment">// &quot;h&quot;</span></span><br><span class="line">b <span class="comment">// &quot;e&quot;</span></span><br><span class="line">c <span class="comment">// &quot;l&quot;</span></span><br><span class="line">d <span class="comment">// &quot;l&quot;</span></span><br><span class="line">e <span class="comment">// &quot;o&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  length: len</span><br><span class="line">&#125; = <span class="string">&#x27;hello&#x27;</span>; <span class="comment">// len =&gt; 5</span></span><br></pre></td></tr></table></figure><h3 id="数值和布尔值的解构赋值"><a href="#数值和布尔值的解构赋值" class="headerlink" title="数值和布尔值的解构赋值"></a>数值和布尔值的解构赋值</h3><blockquote><p>解构赋值的规则是, <strong>只要等号右边的值不是对象或数组, 就先将其转为对象</strong>. 由于 <code>undefined</code> 和 <code>null</code> <strong>无法转为对象</strong>, 所以对它们进行解构赋值, 都会报错.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数值和布尔值的包装对象都有toString属性</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  toString: s</span><br><span class="line">&#125; = <span class="number">123</span>;</span><br><span class="line">s === <span class="built_in">Number</span>.prototype.toString <span class="comment">// true</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  toString: s</span><br><span class="line">&#125; = <span class="literal">true</span>;</span><br><span class="line">s === <span class="built_in">Boolean</span>.prototype.toString <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  prop: x</span><br><span class="line">&#125; = <span class="literal">undefined</span>; <span class="comment">// TypeError</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  prop: y</span><br><span class="line">&#125; = <span class="literal">null</span>; <span class="comment">// TypeError</span></span><br><span class="line"><span class="comment">// undefined和null无法转换为对象</span></span><br></pre></td></tr></table></figure><h3 id="函数参数的解构赋值"><a href="#函数参数的解构赋值" class="headerlink" title="函数参数的解构赋值"></a>函数参数的解构赋值</h3><ul><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">[a, b]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line">fun([<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><ul><li>默认值函解构情况</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  a = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  b = <span class="number">0</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [a, b];</span><br><span class="line">&#125;</span><br><span class="line">fun(&#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span></span><br><span class="line">&#125;); <span class="comment">// [1, 2]</span></span><br><span class="line">fun(&#123;</span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">&#125;); <span class="comment">// [1, 0]</span></span><br><span class="line">fun(&#123;&#125;); <span class="comment">// [0, 0]</span></span><br><span class="line">fun(); <span class="comment">// [0, 0]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  a,</span></span></span><br><span class="line"><span class="function"><span class="params">  b</span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  a: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  b: <span class="number">0</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [a, b];</span><br><span class="line">&#125;</span><br><span class="line">fun(&#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span></span><br><span class="line">&#125;); <span class="comment">// [1, 2]</span></span><br><span class="line">fun(&#123;</span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">&#125;); <span class="comment">// [1, undefined]</span></span><br><span class="line">fun(&#123;&#125;); <span class="comment">// [undefined, undefined]</span></span><br><span class="line">fun(); <span class="comment">// [0, 0]</span></span><br></pre></td></tr></table></figure><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><ul><li>交换变量的值:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>,</span><br><span class="line">  b = <span class="number">2</span>;</span><br><span class="line">[a, b] = [b, a]; <span class="comment">// a =&gt;2 , b =&gt; 1 </span></span><br></pre></td></tr></table></figure><ul><li>函数返回多个值:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个数组</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> [a, b, c] = f(); <span class="comment">// a=&gt;1, b=&gt;2, c=&gt;3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125; = f(); <span class="comment">// a=&gt;1, b=&gt;2</span></span><br></pre></td></tr></table></figure><ul><li>快速对应参数:<br>快速的将一组参数与变量名对应.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">[a, b, c]</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">f([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  a,</span></span></span><br><span class="line"><span class="function"><span class="params">  b,</span></span></span><br><span class="line"><span class="function"><span class="params">  c</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">f(&#123;</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">  c: <span class="number">3</span>,</span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>提取JSON数据:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> json = &#123;</span><br><span class="line">  name: <span class="string">&#x27;leo&#x27;</span>,</span><br><span class="line">  age: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  name,</span><br><span class="line">  age</span><br><span class="line">&#125; = json;</span><br><span class="line"><span class="built_in">console</span>.log(name, age); <span class="comment">// leo, 18</span></span><br></pre></td></tr></table></figure><ul><li>遍历Map结构:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">m.set(<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">m.set(<span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [k, v] <span class="keyword">of</span> m) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k + <span class="string">&#x27; : &#x27;</span> + v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取键名</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [k] <span class="keyword">of</span> m) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取键值</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [, k] <span class="keyword">of</span> m) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输入模块的指定方法:<br>用于<strong>按需加载</strong>模块中需要用到的方法.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  log,</span><br><span class="line">  sin,</span><br><span class="line">  cos</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;math&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="字符串的拓展-✔"><a href="#字符串的拓展-✔" class="headerlink" title="字符串的拓展 ✔"></a>字符串的拓展 ✔</h2><h3 id="includes-startsWith-endsWith"><a href="#includes-startsWith-endsWith" class="headerlink" title="includes(), startsWith(), endsWith()"></a>includes(), startsWith(), endsWith()</h3><ol><li>在我们判断字符串是否包含另一个字符串时，ES6之前，我们只有<code>typeof</code>方法，ES6之后我们又多了三种方法：</li></ol><ul><li>includes()<strong>: 返回</strong>布尔值**, 表示<strong>是否找到参数字符串</strong>.</li><li>startsWith()<strong>: 返回</strong>布尔值**, 表示参数字符串是否在原字符串的<strong>头部</strong>.</li><li>endsWith()<strong>: 返回</strong>布尔值**, 表示参数字符串是否在原字符串的<strong>尾部</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;hello leo&#x27;</span>;</span><br><span class="line">a.startsWith(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">a.endsWith(<span class="string">&#x27;o&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">a.includes(<span class="string">&#x27;lo&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ol start="2"><li>并且这三个方法都支持第二个参数，表示起始搜索的位置。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;hello leo&#x27;</span>;</span><br><span class="line">a.startsWith(<span class="string">&#x27;leo&#x27;</span>, <span class="number">1</span>); <span class="comment">// false</span></span><br><span class="line">a.endsWith(<span class="string">&#x27;o&#x27;</span>, <span class="number">5</span>); <span class="comment">// true</span></span><br><span class="line">a.includes(<span class="string">&#x27;lo&#x27;</span>, <span class="number">6</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><ol start="3"><li><code>endsWith</code> 是针对前 <code>n</code> 个字符, 而其他两个是针对从第<code>n</code>个位置直到结束.</li></ol><h3 id="repeat"><a href="#repeat" class="headerlink" title="repeat()"></a>repeat()</h3><ol><li><code>repeat</code> 方法返回一个新字符串，表示将原字符串重复 <code>n</code> 次。</li></ol><ul><li>基础用法:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(<span class="number">3</span>); <span class="comment">// &#x27;ababab&#x27;</span></span><br><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(<span class="number">0</span>); <span class="comment">// &#x27;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>特殊用法:</li><li>参数为<code>小数</code>, 则取整向下取整</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(<span class="number">2.3</span>); <span class="comment">// &#x27;abab&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>参数为<code>负数</code>或<code>Infinity</code>, 则报错</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(-<span class="number">1</span>); <span class="comment">// RangeError</span></span><br><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(<span class="literal">Infinity</span>); <span class="comment">// RangeError</span></span><br></pre></td></tr></table></figure><ul><li>参数为<code>0到-1的小数</code>或<code>NaN</code>, 则取0</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(-<span class="number">0.5</span>); <span class="comment">// &#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(<span class="literal">NaN</span>); <span class="comment">// &#x27;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>参数为<code>字符串</code>, 则转成<code>数字</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(<span class="string">&#x27;ab&#x27;</span>); <span class="comment">// &#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;ab&#x27;</span>.repeat(<span class="string">&#x27;3&#x27;</span>); <span class="comment">// &#x27;ababab&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="padStart-padEnd-补全字符串大小-从头尾补充"><a href="#padStart-padEnd-补全字符串大小-从头尾补充" class="headerlink" title="padStart(), padEnd()  补全字符串大小(从头尾补充)"></a>padStart(), padEnd() 补全字符串大小(从头尾补充)</h3><ul><li>用于将字符串<strong>头部</strong>或<strong>尾部</strong>补全长度, <code>padStart()</code>为<strong>头部补全</strong>, <code>padEnd()</code>为<strong>尾部补全</strong>.</li><li>这两个方法接收<strong>2个</strong>参数, 第一个指定<strong>字符串最小长度</strong>, 第二个<strong>用于补全的字符串</strong>.</li><li>基础用法 :</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;x&#x27;</span>.padStart(<span class="number">5</span>, <span class="string">&#x27;ab&#x27;</span>); <span class="comment">// &#x27;ababx&#x27;</span></span><br><span class="line"><span class="string">&#x27;x&#x27;</span>.padEnd(<span class="number">5</span>, <span class="string">&#x27;ab&#x27;</span>); <span class="comment">// &#x27;xabab&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>特殊用法:</li><li>原字符串长度, 大于或等于指定最小长度, 则返回原字符串.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;xyzabc&#x27;</span>.padStart(<span class="number">5</span>, <span class="string">&#x27;ab&#x27;</span>); <span class="comment">// &#x27;xyzabc&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>用来补全的字符串长度和原字符串长度之和, 超过指定最小长度, 则截去超出部分的补全字符串.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;ab&#x27;</span>.padStart(<span class="number">5</span>, <span class="string">&#x27;012345&#x27;</span>); <span class="comment">// &quot;012ab&quot;</span></span><br></pre></td></tr></table></figure><ul><li>省略第二个参数, 则用<code>空格</code>补全.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;x&#x27;</span>.padStart(<span class="number">4</span>); <span class="comment">// &#x27;    x&#x27;</span></span><br><span class="line"><span class="string">&#x27;x&#x27;</span>.padEnd(<span class="number">4</span>); <span class="comment">// &#x27;x    &#x27;</span></span><br></pre></td></tr></table></figure><h3 id="模版字符串"><a href="#模版字符串" class="headerlink" title="模版字符串"></a>模版字符串</h3><ul><li>用于拼接字符串, ES6之前:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;abc&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;def&#x27;</span> +</span><br><span class="line">  <span class="string">&#x27;ghi&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ES6之后:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">`</span></span><br><span class="line"><span class="string">    abc</span></span><br><span class="line"><span class="string">    def</span></span><br><span class="line"><span class="string">    ghi</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><ul><li>拼接变量:</li></ul><ol><li>在**反引号(`)**中使用<code>$&#123;&#125;</code>包裹变量或方法。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6之前</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;abc&#x27;</span> + v1 + <span class="string">&#x27;def&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6之后</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">`abc<span class="subst">$&#123;v1&#125;</span>def`</span></span><br></pre></td></tr></table></figure><h2 id="正则的拓展-✔"><a href="#正则的拓展-✔" class="headerlink" title="正则的拓展 ✔"></a>正则的拓展 ✔</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ol><li>在ES5中有两种情况。</li></ol><ul><li>参数是<strong>字符串</strong>, 则第二个参数为正则表达式的修饰符.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;i&#x27;</span>);</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="regexp">/abx/i</span>;</span><br></pre></td></tr></table></figure><ul><li>参数是<strong>正则表达式</strong>, 返回一个原表达式的拷贝, 且不能有第二个参数, 否则报错.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/abc/i</span>);</span><br><span class="line"><span class="comment">//等价于</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="regexp">/abx/i</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/abc/</span>, <span class="string">&#x27;i&#x27;</span>);</span><br><span class="line"><span class="comment">//  Uncaught TypeError</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ES6中使用：</li></ol><ul><li>第一个参数是正则对象, 第二个是指定修饰符, 如果第一个参数已经有修饰符, 则会被第二个参数覆盖.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/abc/ig</span>, <span class="string">&#x27;i&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="字符串的正则方法"><a href="#字符串的正则方法" class="headerlink" title="字符串的正则方法"></a>字符串的正则方法</h3><ul><li>常用的四种方法:<code>match()</code>、<code>replace()</code>、<code>search()</code>和<code>split()</code>.</li></ul><h3 id="u修饰符"><a href="#u修饰符" class="headerlink" title="u修饰符"></a>u修饰符</h3><ol><li>添加<code>u</code>修饰符，是为了处理大于<code>uFFFF</code>的Unicode字符，即正确处理四个字节的<code>UTF-16</code>编码。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/^\uD83D/u.test(<span class="string">&#x27;\uD83D\uDC2A&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">/^\uD83D/.test(<span class="string">&#x27;\uD83D\uDC2A&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>由于ES5之前不支持四个字节UTF-16编码, 会识别为两个字符, 导致第二行输出<code>true</code>, 加入<code>u</code>修饰符后ES6就会识别为一个字符, 所以输出<code>false</code>.<br><code>注意</code></li></ul><ol start="2"><li>加上<code>u</code>修饰符后，会改变下面正则表达式的行为：</li></ol><ul><li>(1)点字符</li><li>点字符(<code>.</code>)在正则中表示除了<strong>换行符</strong>以外的任意单个字符. 对于码点大于<code>0xFFFF</code>的Unicode字符, 点字符不能识别, 必须加上<code>u</code>修饰符.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;𠮷&quot;</span>;</span><br><span class="line">/^.$/.test(a); <span class="comment">// false</span></span><br><span class="line">/^.$/u.test(a); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>(2)Unicode字符表示法</li><li>使用ES6新增的大括号表示Unicode字符时, 必须在表达式添加<code>u</code>修饰符, 才能识别大括号.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/\u&#123;<span class="number">61</span>&#125;/.test(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">/\u&#123;<span class="number">61</span>&#125;/u.test(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">/\u&#123;20BB7&#125;/u.test(<span class="string">&#x27;𠮷&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>(3)量词</li><li>使用<code>u</code>修饰符后, 所有量词都会正确识别码点大于<code>0xFFFF</code>的 Unicode 字符.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/a&#123;<span class="number">2</span>&#125;/.test(<span class="string">&#x27;aa&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">/a&#123;<span class="number">2</span>&#125;/u.test(<span class="string">&#x27;aa&#x27;</span>); <span class="comment">// true</span></span><br><span class="line">/𠮷&#123;<span class="number">2</span>&#125;/.test(<span class="string">&#x27;𠮷𠮷&#x27;</span>); <span class="comment">// false</span></span><br><span class="line">/𠮷&#123;<span class="number">2</span>&#125;/u.test(<span class="string">&#x27;𠮷𠮷&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>(4)i修饰符<br>不加 <code>u</code> 修饰符, 就无法识别非规范的 <code>K</code> 字符.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/[a-z]/i.test(<span class="string">&#x27;\u212A&#x27;</span>) <span class="comment">// false</span></span><br><span class="line">  /</span><br><span class="line">  [a - z] / iu.test(<span class="string">&#x27;\u212A&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>检查是否设置<code>u</code>修饰符:<br>使用 <code>unicode</code> 属性.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="regexp">/hello/</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="regexp">/hello/u</span>;</span><br><span class="line"></span><br><span class="line">a.unicode <span class="comment">// false</span></span><br><span class="line">b.unicode <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="y修饰符"><a href="#y修饰符" class="headerlink" title="y修饰符"></a>y修饰符</h3><ul><li><code>y</code>修饰符与<code>g</code>修饰符类似, 也是全局匹配, 后一次匹配都是从上一次匹配成功的下一个位置开始. 区别在于, <code>g</code>修饰符<strong>只要</strong>剩余位置中存在匹配即可, 而<code>y</code>修饰符是必须从<strong>剩余第一个</strong>开始.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&#x27;aaa_aa_a&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> r1 = <span class="regexp">/a+/g</span>;</span><br><span class="line"><span class="keyword">var</span> r2 = <span class="regexp">/a+/y</span>;</span><br><span class="line"></span><br><span class="line">r1.exec(s) <span class="comment">// [&quot;aaa&quot;]</span></span><br><span class="line">r2.exec(s) <span class="comment">// [&quot;aaa&quot;]</span></span><br><span class="line"></span><br><span class="line">r1.exec(s) <span class="comment">// [&quot;aa&quot;]  剩余 &#x27;_aa_a&#x27;</span></span><br><span class="line">r2.exec(s) <span class="comment">// null</span></span><br></pre></td></tr></table></figure><ul><li><code>lastIndex</code>属性:<br>指定匹配的开始位置:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="regexp">/a/y</span>;</span><br><span class="line">a.lastIndex = <span class="number">2</span>; <span class="comment">// 从2号位置开始匹配</span></span><br><span class="line">a.exec(<span class="string">&#x27;wahaha&#x27;</span>); <span class="comment">// null</span></span><br><span class="line">a.lastIndex = <span class="number">3</span>; <span class="comment">// 从3号位置开始匹配</span></span><br><span class="line"><span class="keyword">let</span> c = a.exec(<span class="string">&#x27;wahaha&#x27;</span>);</span><br><span class="line">c.index; <span class="comment">// 3</span></span><br><span class="line">a.lastIndex; <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><ul><li>返回多个匹配:</li></ul><ol><li>一个<code>y</code>修饰符对<code>match</code>方法只能返回第一个匹配，与<code>g</code>修饰符搭配能返回所有匹配。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a1a2a3&#x27;</span>.match(<span class="regexp">/a\d/y</span>); <span class="comment">// [&quot;a1&quot;]</span></span><br><span class="line"><span class="string">&#x27;a1a2a3&#x27;</span>.match(<span class="regexp">/a\d/gy</span>); <span class="comment">// [&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;]</span></span><br></pre></td></tr></table></figure><ul><li>检查是否使用<code>y</code>修饰符:</li></ul><ol><li>使用<code>sticky</code>属性检查。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="regexp">/hello\d/y</span>;</span><br><span class="line">a.sticky; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="flags属性"><a href="#flags属性" class="headerlink" title="flags属性"></a>flags属性</h3><ul><li><code>flags</code>属性返回所有正则表达式的修饰符.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/abc/ig.flags; <span class="comment">// &#x27;gi&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="数值的拓展-✔"><a href="#数值的拓展-✔" class="headerlink" title="数值的拓展 ✔"></a>数值的拓展 ✔</h2><h3 id="Number-isFinite-Number-isNaN"><a href="#Number-isFinite-Number-isNaN" class="headerlink" title="Number.isFinite(), Number.isNaN()"></a>Number.isFinite(), Number.isNaN()</h3><ol><li><code>Number.isFinite()</code> 用于检查一个数值是否是有限的, 即不是<code>Infinity</code>, 若参数不是<code>Number</code>类型, 则一律返回<code>false</code> .</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.isFinite(<span class="number">10</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="number">0.5</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="literal">NaN</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="literal">Infinity</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(-<span class="literal">Infinity</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="string">&#x27;15&#x27;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="literal">true</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="built_in">Math</span>.random()); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>Number.isNaN()</code>用于检查是否是<code>NaN</code>，若参数不是<code>NaN</code>，则一律返回<code>false</code>。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.isNaN(<span class="literal">NaN</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="number">10</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="string">&#x27;10&#x27;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="literal">true</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="number">5</span> / <span class="literal">NaN</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="string">&#x27;true&#x27;</span> / <span class="number">0</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="string">&#x27;true&#x27;</span> / <span class="string">&#x27;true&#x27;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>区别:</li></ul><ol><li>与传统全局的<code>isFinite()</code>和<code>isNaN()</code>方法的区别，传统的这两个方法，是先将参数转换成<strong>数值</strong>，再判断。</li><li>而ES6新增的这两个方法则只对<strong>数值</strong>有效，</li><li><code>Number.isFinite()</code>对于<strong>非数值</strong>一律返回<code>false</code>,<code>Number.isNaN()</code>只有对于<code>NaN</code>才返回<code>true</code>，其他一律返回<code>false</code>。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isFinite</span>(<span class="number">25</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isFinite</span>(<span class="string">&quot;25&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="number">25</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="string">&quot;25&quot;</span>); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="literal">NaN</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="string">&quot;NaN&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="literal">NaN</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="string">&quot;NaN&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="Number-parseInt-Number-parseFloat"><a href="#Number-parseInt-Number-parseFloat" class="headerlink" title="Number.parseInt(), Number.parseFloat()"></a>Number.parseInt(), Number.parseFloat()</h3><ol><li>这两个方法与全局方法<code>parseInt()</code>和<code>parseFloat()</code>一致，目的是逐步<strong>减少全局性的方法</strong>，让<strong>语言更模块化</strong>。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="string">&#x27;12.34&#x27;</span>); <span class="comment">// 12</span></span><br><span class="line"><span class="built_in">parseFloat</span>(<span class="string">&#x27;123.45#&#x27;</span>); <span class="comment">// 123.45</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span>.parseInt(<span class="string">&#x27;12.34&#x27;</span>); <span class="comment">// 12</span></span><br><span class="line"><span class="built_in">Number</span>.parseFloat(<span class="string">&#x27;123.45#&#x27;</span>); <span class="comment">// 123.45</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span>.parseInt === <span class="built_in">parseInt</span>; <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.parseFloat === <span class="built_in">parseFloat</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="Number-isInteger"><a href="#Number-isInteger" class="headerlink" title="Number.isInteger()"></a>Number.isInteger()</h3><ul><li>用来判断一个数值是否是整数, 若参数不是数值, 则返回<code>false</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.isInteger(<span class="number">10</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isInteger(<span class="number">10.0</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isInteger(<span class="number">10.1</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h3 id="Math对象的拓展"><a href="#Math对象的拓展" class="headerlink" title="Math对象的拓展"></a>Math对象的拓展</h3><ul><li>ES6新增<code>17</code>个数学相关的<strong>静态方法</strong>, 只能在<strong>Math对象</strong>上调用.</li></ul><h4 id="Math-trunc"><a href="#Math-trunc" class="headerlink" title="Math.trunc():"></a>Math.trunc():</h4><ul><li>用来去除小数的小数部分, <strong>返回整数部分</strong>.</li><li>若参数为<strong>非数值</strong>, 则<strong>先转为数值</strong>.</li><li>若参数为<strong>空值</strong>或<strong>无法截取整数的值</strong>, 则返回<strong>NaN</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常使用</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="number">1.1</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="number">1.9</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(-<span class="number">1.1</span>); <span class="comment">// -1</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(-<span class="number">1.9</span>); <span class="comment">// -1</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(-<span class="number">0.1234</span>); <span class="comment">// -0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数为非数值</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="string">&#x27;11.22&#x27;</span>); <span class="comment">// 11</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="literal">true</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="literal">false</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="literal">null</span>); <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数为空和无法取整</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="literal">NaN</span>); <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(); <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.trunc(<span class="literal">undefined</span>); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><ul><li>ES5实现:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.trunc = <span class="built_in">Math</span>.trunc || <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x &lt; <span class="number">0</span> ? <span class="built_in">Math</span>.ceil(x) : <span class="built_in">Math</span>.floor(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Math-sign"><a href="#Math-sign" class="headerlink" title="Math.sign():"></a>Math.sign():</h4><ul><li>判断一个数是<strong>正数</strong>、<strong>负数</strong>还<strong>是零</strong>, 对于非数值, 会先转成<strong>数值</strong>.</li><li>返回值:</li></ul><ol><li>参数为正数， 返回 +1</li><li>参数为负数， 返回 -1</li><li>参数为0， 返回 0</li><li>参数为-0， 返回 -0</li><li>参数为其他值， 返回 NaN</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.sign(-<span class="number">1</span>); <span class="comment">// -1</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="number">1</span>); <span class="comment">// +1</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="number">0</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.sign(-<span class="number">0</span>); <span class="comment">// -0</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="literal">NaN</span>); <span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="string">&#x27;&#x27;</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="literal">true</span>); <span class="comment">// +1</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="literal">false</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="literal">null</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="string">&#x27;9&#x27;</span>); <span class="comment">// +1</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.sign(); <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.sign(<span class="literal">undefined</span>); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><ul><li>ES5实现</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.sign = <span class="built_in">Math</span>.sign || <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  x = +x;</span><br><span class="line">  <span class="keyword">if</span> (x === <span class="number">0</span> || <span class="built_in">isNaN</span>(x)) &#123;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> x &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Math-cbrt"><a href="#Math-cbrt" class="headerlink" title="Math.cbrt():"></a>Math.cbrt():</h4><ul><li>用来计算一个数的立方根, 若参数为非数值则先转成数值.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.cbrt(-<span class="number">1</span>); <span class="comment">// -1</span></span><br><span class="line"><span class="built_in">Math</span>.cbrt(<span class="number">0</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.cbrt(<span class="number">1</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.cbrt(<span class="number">2</span>); <span class="comment">// 1.2599210498</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.cbrt(<span class="string">&#x27;1&#x27;</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.cbrt(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><ul><li>ES5实现</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.cbrt = <span class="built_in">Math</span>.cbrt || <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">Math</span>.pow(<span class="built_in">Math</span>.abs(x), <span class="number">1</span> / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">return</span> x &lt; <span class="number">0</span> ? -y : y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Math-clz32"><a href="#Math-clz32" class="headerlink" title="Math.clz32():"></a>Math.clz32():</h4><ul><li>用于返回一个数的 32 位无符号整数形式有多少个前导 0.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.clz32(<span class="number">0</span>) <span class="comment">// 32</span></span><br><span class="line"><span class="built_in">Math</span>.clz32(<span class="number">1</span>) <span class="comment">// 31</span></span><br><span class="line"><span class="built_in">Math</span>.clz32(<span class="number">1000</span>) <span class="comment">// 22</span></span><br><span class="line"><span class="built_in">Math</span>.clz32(<span class="number">0b01000000000000000000000000000000</span>) <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.clz32(<span class="number">0b00100000000000000000000000000000</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h4 id="Math-imul"><a href="#Math-imul" class="headerlink" title="Math.imul():"></a>Math.imul():</h4><ul><li>用于返回两个数以 32 位带符号整数形式相乘的结果, 返回的也是一个 32 位的带符号整数.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.imul(<span class="number">2</span>, <span class="number">4</span>) <span class="comment">// 8</span></span><br><span class="line"><span class="built_in">Math</span>.imul(-<span class="number">1</span>, <span class="number">8</span>) <span class="comment">// -8</span></span><br><span class="line"><span class="built_in">Math</span>.imul(-<span class="number">2</span>, -<span class="number">2</span>) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><h4 id="Math-fround"><a href="#Math-fround" class="headerlink" title="Math.fround():"></a>Math.fround():</h4><ul><li>用来返回一个数的<strong>2位单精度浮点数</strong>形式.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.fround(<span class="number">0</span>) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.fround(<span class="number">1</span>) <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.fround(<span class="number">2</span> ** <span class="number">24</span> - <span class="number">1</span>) <span class="comment">// 16777215</span></span><br></pre></td></tr></table></figure><h4 id="Math-hypot"><a href="#Math-hypot" class="headerlink" title="Math.hypot():"></a>Math.hypot():</h4><ul><li>用来返回所有参数的平方和的<strong>平方根</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.hypot(<span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 5</span></span><br><span class="line"><span class="built_in">Math</span>.hypot(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>); <span class="comment">// 7.0710678118654755</span></span><br><span class="line"><span class="built_in">Math</span>.hypot(); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.hypot(<span class="literal">NaN</span>); <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.hypot(<span class="number">3</span>, <span class="number">4</span>, <span class="string">&#x27;foo&#x27;</span>); <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.hypot(<span class="number">3</span>, <span class="number">4</span>, <span class="string">&#x27;5&#x27;</span>); <span class="comment">// 7.0710678118654755</span></span><br><span class="line"><span class="built_in">Math</span>.hypot(-<span class="number">3</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h4 id="Math-expm1"><a href="#Math-expm1" class="headerlink" title="Math.expm1():"></a>Math.expm1():</h4><ul><li>用来返回 <code>e^x - 1</code>, 即<code>Math.exp(x) - 1</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.expm1(-<span class="number">1</span>) <span class="comment">// -0.6321205588285577</span></span><br><span class="line"><span class="built_in">Math</span>.expm1(<span class="number">0</span>) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.expm1(<span class="number">1</span>) <span class="comment">// 1.718281828459045</span></span><br></pre></td></tr></table></figure><ul><li>ES5实现</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.expm1 = <span class="built_in">Math</span>.expm1 || <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.exp(x) - <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Math-log1p"><a href="#Math-log1p" class="headerlink" title="Math.log1p():"></a>Math.log1p():</h4><ul><li>用来返回<code>1 + x</code>的自然对数, 即<code>Math.log(1 + x)</code>. 如果x小于<code>-1</code>, 返回<code>NaN</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.log1p(<span class="number">1</span>) <span class="comment">// 0.6931471805599453</span></span><br><span class="line"><span class="built_in">Math</span>.log1p(<span class="number">0</span>) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.log1p(-<span class="number">1</span>) <span class="comment">// -Infinity</span></span><br><span class="line"><span class="built_in">Math</span>.log1p(-<span class="number">2</span>) <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure><ul><li>ES5实现</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.log1p = <span class="built_in">Math</span>.log1p || <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.log(<span class="number">1</span> + x);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Math-log10"><a href="#Math-log10" class="headerlink" title="Math.log10():"></a>Math.log10():</h4><ul><li>用来返回以 <code>10</code> 为底的<code>x的对数</code>. 如果x小于 0, 则返回 <code>NaN</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.log10(<span class="number">2</span>) <span class="comment">// 0.3010299956639812</span></span><br><span class="line"><span class="built_in">Math</span>.log10(<span class="number">1</span>) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.log10(<span class="number">0</span>) <span class="comment">// -Infinity</span></span><br><span class="line"><span class="built_in">Math</span>.log10(-<span class="number">2</span>) <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.log10(<span class="number">100000</span>) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure><ul><li>ES5实现</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.log10 = <span class="built_in">Math</span>.log10 || <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.log(x) / <span class="built_in">Math</span>.LN10;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Math-log2"><a href="#Math-log2" class="headerlink" title="Math.log2():"></a>Math.log2():</h4><ul><li>用来返回以 <code>2</code> 为底的<code>x的对数</code>. 如果<code>x</code>小于 <code>0</code>, 则返回 <code>NaN</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.log2(<span class="number">3</span>) <span class="comment">// 1.584962500721156</span></span><br><span class="line"><span class="built_in">Math</span>.log2(<span class="number">2</span>) <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Math</span>.log2(<span class="number">1</span>) <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Math</span>.log2(<span class="number">0</span>) <span class="comment">// -Infinity</span></span><br><span class="line"><span class="built_in">Math</span>.log2(-<span class="number">2</span>) <span class="comment">// NaN</span></span><br><span class="line"><span class="built_in">Math</span>.log2(<span class="number">1024</span>) <span class="comment">// 10</span></span><br><span class="line"><span class="built_in">Math</span>.log2(<span class="number">1</span> &lt;&lt; <span class="number">29</span>) <span class="comment">// 29</span></span><br></pre></td></tr></table></figure><ul><li>ES5实现</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.log2 = <span class="built_in">Math</span>.log2 || <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Math</span>.log(x) / <span class="built_in">Math</span>.LN2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="双曲函数方法"><a href="#双曲函数方法" class="headerlink" title="双曲函数方法:"></a>双曲函数方法:</h4><pre><code>- `Math.sinh(x)` 返回x的**双曲正弦**（hyperbolic sine）  
- `Math.cosh(x)` 返回x的**双曲余弦**（hyperbolic cosine）  
- `Math.tanh(x)` 返回x的**双曲正切**（hyperbolic tangent）  
- `Math.asinh(x)` 返回x的**反双曲正弦**（inverse hyperbolic sine）  
- `Math.acosh(x)` 返回x的**反双曲余弦**（inverse hyperbolic cosine）  
- `Math.atanh(x)` 返回x的**反双曲正切**（inverse hyperbolic tangent）  
</code></pre><h3 id="指数运算符"><a href="#指数运算符" class="headerlink" title="指数运算符"></a>指数运算符</h3><ul><li>新增的指数运算符(<code>**</code>):</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> ** <span class="number">2</span>; <span class="comment">// 4</span></span><br><span class="line"><span class="number">2</span> ** <span class="number">3</span>; <span class="comment">// 8 </span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> ** <span class="number">3</span> ** <span class="number">2</span>; <span class="comment">// 相当于 2 ** (3 ** 2); 返回 512</span></span><br></pre></td></tr></table></figure><ul><li>指数运算符(<code>**</code>)与<code>Math.pow</code>的实现不相同, 对于特别大的运算结果, 两者会有细微的差异.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.pow(<span class="number">99</span>, <span class="number">99</span>)</span><br><span class="line"><span class="comment">// 3.697296376497263e+197</span></span><br><span class="line"></span><br><span class="line"><span class="number">99</span> ** <span class="number">99</span></span><br><span class="line"><span class="comment">// 3.697296376497268e+197</span></span><br></pre></td></tr></table></figure><h2 id="函数的拓展-✔"><a href="#函数的拓展-✔" class="headerlink" title="函数的拓展 ✔"></a>函数的拓展 ✔</h2><h3 id="参数默认值"><a href="#参数默认值" class="headerlink" title="参数默认值"></a>参数默认值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6 之前</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  b = b || <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 之后</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b = <span class="string">&#x27;leo&#x27;</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f(<span class="string">&#x27;hi&#x27;</span>); <span class="comment">// hi leo</span></span><br><span class="line">f(<span class="string">&#x27;hi&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>); <span class="comment">// hi jack</span></span><br><span class="line">f(<span class="string">&#x27;hi&#x27;</span>, <span class="string">&#x27;&#x27;</span>); <span class="comment">// hi leo</span></span><br></pre></td></tr></table></figure><p><code>注意</code> :</p><ul><li>参数变量是默认声明的, 不能用<code>let</code>和<code>const</code>再次声明:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">2</span>; <span class="comment">// error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用参数默认值时, 参数名不能相同:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, a, b</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;; <span class="comment">// 不报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, a, b = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;; <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure><ul><li>与解构赋值默认值结合使用:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  a,</span></span></span><br><span class="line"><span class="function"><span class="params">  b = <span class="number">1</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b)</span><br><span class="line">&#125;;</span><br><span class="line">f(&#123;&#125;); <span class="comment">// undefined 1</span></span><br><span class="line">f(&#123;</span><br><span class="line">  a: <span class="number">2</span></span><br><span class="line">&#125;); <span class="comment">// 2 1</span></span><br><span class="line">f(&#123;</span><br><span class="line">  a: <span class="number">2</span>,</span><br><span class="line">  b: <span class="number">3</span></span><br><span class="line">&#125;); <span class="comment">// 2 3</span></span><br><span class="line">f(); <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  a,</span></span></span><br><span class="line"><span class="function"><span class="params">  b = <span class="number">1</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b)</span><br><span class="line">&#125;</span><br><span class="line">f(); <span class="comment">// undefined 1</span></span><br></pre></td></tr></table></figure><ul><li>尾参数定义默认值:<br>通常在尾参数定义默认值, 便于观察参数, 并且非尾参数无法省略.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a = <span class="number">1</span>, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [a, b];</span><br><span class="line">&#125;</span><br><span class="line">f(); <span class="comment">// [1, undefined]</span></span><br><span class="line">f(<span class="number">2</span>); <span class="comment">// [2, undefined]</span></span><br><span class="line">f(, <span class="number">2</span>); <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line">f(<span class="literal">undefined</span>, <span class="number">2</span>); <span class="comment">// [1, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b = <span class="number">1</span>, c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [a, b, c];</span><br><span class="line">&#125;</span><br><span class="line">f(); <span class="comment">// [undefined, 1, undefined]</span></span><br><span class="line">f(<span class="number">1</span>); <span class="comment">// [1,1,undefined]</span></span><br><span class="line">f(<span class="number">1</span>, , <span class="number">2</span>); <span class="comment">// 报错</span></span><br><span class="line">f(<span class="number">1</span>, <span class="literal">undefined</span>, <span class="number">2</span>); <span class="comment">// [1,1,2]</span></span><br></pre></td></tr></table></figure><p>在给参数传递默认值时, 传入 <code>undefined</code> 会触发默认值, 传入 <code>null</code> 不会触发.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a = <span class="number">1</span>, b = <span class="number">2</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="literal">undefined</span>, <span class="literal">null</span>); <span class="comment">// 1 null</span></span><br></pre></td></tr></table></figure><ul><li>函数的length属性:<br><code>length</code> 属性将返回, 没有指定默认值的参数数量, 并且rest参数不计入 <code>length</code> 属性.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params">a = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params">a, b = <span class="number">2</span></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f4</span>(<span class="params">...a</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f5</span>(<span class="params">a, b, ...c</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">f1.length; <span class="comment">// 1</span></span><br><span class="line">f2.length; <span class="comment">// 0</span></span><br><span class="line">f3.length; <span class="comment">// 1</span></span><br><span class="line">f4.length; <span class="comment">// 0</span></span><br><span class="line">f5.length; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h3 id="rest-参数"><a href="#rest-参数" class="headerlink" title="rest 参数"></a>rest 参数</h3><ul><li><code>rest</code>参数形式为(<code>... 变量名</code>), 其值为一个数组, 用于获取函数多余参数.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, ...b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 1 [2, 3, 4]</span></span><br></pre></td></tr></table></figure><p><code>注意</code> :</p><ul><li><code>rest</code>参数只能放在最后一个, 否则报错:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, ...b, c</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;; <span class="comment">// 报错 </span></span><br></pre></td></tr></table></figure><ul><li>函数的<code>length</code>属性不包含<code>rest</code>参数.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params">a, ...b</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line">f1(<span class="number">1</span>); <span class="comment">// 1</span></span><br><span class="line">f2(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h3 id="name-属性"><a href="#name-属性" class="headerlink" title="name 属性"></a>name 属性</h3><p>用于返回该函数的函数名.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line">f.name; <span class="comment">// f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f = <span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line">f.name; <span class="comment">// g</span></span><br></pre></td></tr></table></figure><h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><ul><li>使用”箭头”(<code>=&gt;</code>)定义函数.</li><li>基础使用:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有1个参数</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="params">v</span> =&gt;</span> v;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> v</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有多个参数</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> v + i</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span>(<span class="params">v, i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> v + i</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 没参数</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function">() =&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>箭头函数与变量结构结合使用:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通函数写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">p</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> p.a + <span class="string">&#x27;:&#x27;</span> + p.b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数写法</span></span><br><span class="line"><span class="keyword">let</span> f = (&#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125;) =&gt; a + <span class="string">&#x27;:&#x27;</span> + b;</span><br></pre></td></tr></table></figure><ul><li>简化回调函数:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通函数写法</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数写法</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> x * x);</span><br></pre></td></tr></table></figure><ul><li>箭头函数与rest参数结合:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="function">(<span class="params">...n</span>) =&gt;</span> n;</span><br><span class="line">f(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure><p><code>注意点</code> :</p><ul><li><ol><li>箭头函数内的<code>this</code><strong>总是</strong>指向<strong>定义时所在的对象</strong>, 而不是调用时.</li></ol></li><li><ol start="2"><li>箭头函数不能当做<strong>构造函数</strong>, 即不能用<code>new</code>命令, 否则报错.</li></ol></li><li><ol start="3"><li>箭头函数不存在<code>arguments</code>对象, 即不能使用, 可以使用<code>rest</code>参数代替.</li></ol></li><li><ol start="4"><li>箭头函数不能使用<code>yield</code>命令, 即不能用作<strong>Generator</strong>函数.</li></ol></li><li><p>不适用场景:</p></li><li><ol><li>在定义函数方法, 且该方法内部包含<code>this</code>.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  a: <span class="number">9</span>,</span><br><span class="line">  b: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a--;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述 <code>b</code> 如果是<strong>普通函数</strong>, 函数内部的 <code>this</code> 指向 <code>obj</code> , 但是如果是箭头函数, 则 <code>this</code> 会指向<strong>全局</strong>, 不是预期结果.</p><ul><li><ol start="2"><li>需要动态<code>this</code>时.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myID&#x27;</span>);</span><br><span class="line">b.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.classList.toggle(<span class="string">&#x27;on&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>上述按钮点击会报错, 因为 <code>b</code> 监听的箭头函数中, <code>this</code> 是全局对象, 若改成<strong>普通函数</strong>, <code>this</code> 就会指向被点击的按钮对象.</p><h3 id="双冒号运算符"><a href="#双冒号运算符" class="headerlink" title="双冒号运算符"></a>双冒号运算符</h3><ul><li>双冒号暂时是一个提案, 用于解决一些不适用的场合, 取代<code>call</code>、<code>apply</code>、<code>bind</code>调用.</li><li>双冒号运算符(<code>::</code>)的左边是一个<strong>对象</strong>, 右边是一个<strong>函数</strong>. 该运算符会自动将左边的对象, 作为上下文环境(即<code>this</code>对象), 绑定到右边函数上.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f::b;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">b.bind(f);</span><br><span class="line"></span><br><span class="line">f::b(...arguments);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">b.apply(f, <span class="built_in">arguments</span>);</span><br></pre></td></tr></table></figure><ul><li>若双冒号左边为空, 右边是一个对象的方法, 则等于将该方法绑定到该对象上.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = a::a.b;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> f = ::a.b;</span><br></pre></td></tr></table></figure><h2 id="数组的拓展-✔"><a href="#数组的拓展-✔" class="headerlink" title="数组的拓展 ✔"></a>数组的拓展 ✔</h2><h3 id="拓展运算符"><a href="#拓展运算符" class="headerlink" title="拓展运算符"></a>拓展运算符</h3><ul><li>拓展运算符使用(<code>...</code>), 类似<code>rest</code>参数的逆运算, 将数组转为用(<code>,</code> )分隔的参数序列.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(...[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 1 2 3 </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>, ...[<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>); <span class="comment">// 1 2 3 4</span></span><br></pre></td></tr></table></figure><ul><li>拓展运算符主要使用在函数调用.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b);</span><br><span class="line">&#125;</span><br><span class="line">f(...[<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">// 1 2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params">a, b, c, d, e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, b, c, d, e);</span><br><span class="line">&#125;</span><br><span class="line">g(<span class="number">0</span>, ...[<span class="number">1</span>, <span class="number">2</span>], <span class="number">3</span>, ...[<span class="number">4</span>]); <span class="comment">// 0 1 2 3 4</span></span><br></pre></td></tr></table></figure><ul><li>若拓展运算符后面是个空数组, 则不产生效果.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[...[], <span class="number">1</span>]; <span class="comment">// [1]</span></span><br></pre></td></tr></table></figure><ul><li>替代apply方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6之前</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">f.apply(<span class="literal">null</span>, a);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6之后</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">f(...a);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6之前</span></span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, [<span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6之后</span></span><br><span class="line"><span class="built_in">Math</span>.max(...[<span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>]);</span><br></pre></td></tr></table></figure><ul><li>拓展运算符的运用</li><li>(1)复制数组:</li><li><code>通常</code>我们直接<code>复制</code>数组时, 只是<code>浅拷贝</code>, 如果要实现深拷贝, 可以使用拓展运算符.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通常情况 浅拷贝  浅拷贝 如果后面的赋值发生变化 前面的也会发生变化 浅拷贝只是拷贝了一个地址</span></span><br><span class="line"><span class="keyword">let</span> a1 = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> a2 = a1;</span><br><span class="line">a2[<span class="number">0</span>] = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a1, a2); <span class="comment">// [3,2] [3,2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 拓展运算符 深拷贝</span></span><br><span class="line"><span class="keyword">let</span> a1 = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> a2 = [...a1];</span><br><span class="line"><span class="comment">// let [...a2] = a1; // 作用相同</span></span><br><span class="line">a2[<span class="number">0</span>] = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a1, a2); <span class="comment">// [1,2] [3,2]</span></span><br></pre></td></tr></table></figure><ul><li>(2)合并数组:</li><li>注意, 这里<code>合并</code>数组, 只是<code>浅拷贝</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> a2 = [<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> a3 = [<span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5 </span></span><br><span class="line"><span class="keyword">let</span> a4 = a1.concat(a2, a3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> a5 = [...a1, ...a2, ...a3];</span><br><span class="line"></span><br><span class="line">a4[<span class="number">0</span>] === a1[<span class="number">0</span>]; <span class="comment">// true</span></span><br><span class="line">a5[<span class="number">0</span>] === a1[<span class="number">0</span>]; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>(3)与解构赋值结合:</li><li>与解构赋值结合生成数组, 但是使用拓展运算符需要放到参数最后一个, 否则报错.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, ...b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="comment">// a =&gt; 1  b =&gt; [2,3,4]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, ...b] = [];</span><br><span class="line"><span class="comment">// a =&gt; undefined b =&gt; []</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, ...b] = [<span class="string">&quot;abc&quot;</span>];</span><br><span class="line"><span class="comment">// a =&gt; &quot;abc&quot;  b =&gt; []</span></span><br></pre></td></tr></table></figure><h3 id="Array-from"><a href="#Array-from" class="headerlink" title="Array.from()"></a>Array.from()</h3><ul><li>将 <strong>类(伪)数组对象</strong> 和 <strong>可遍历的对象</strong>, 转换成真正的数组.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类数组对象</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">  length: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr = <span class="built_in">Array</span>.from(a);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可遍历的对象</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="built_in">Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Array</span>.from(&#123;</span><br><span class="line">  length: <span class="number">3</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> c = <span class="built_in">Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).map(<span class="function"><span class="params">x</span> =&gt;</span> x * x);</span><br><span class="line"><span class="keyword">let</span> d = <span class="built_in">Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> x * x));</span><br></pre></td></tr></table></figure><h3 id="Array-of"><a href="#Array-of" class="headerlink" title="Array.of()"></a>Array.of()</h3><ul><li>将一组数值, 转换成<strong>数组</strong>, 弥补<code>Array</code>方法参数不同导致的差异.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [1,2,3]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>).length; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>(); <span class="comment">// []</span></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">2</span>); <span class="comment">// [,] 1个参数时，为指定数组长度</span></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [1,2,3] 多于2个参数，组成新数组</span></span><br></pre></td></tr></table></figure><h3 id="find-和findIndex"><a href="#find-和findIndex" class="headerlink" title="find()和findIndex()"></a>find()和findIndex()</h3><ul><li><code>find()</code>方法用于找出第一个符合条件的数组成员, 参数为一个回调函数, 所有成员依次执行该回调函数, 返回第一个返回值为<code>true</code>的成员, 如果没有一个符合则返回<code>undefined</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].find(<span class="function"><span class="params">a</span> =&gt;</span> a &lt; <span class="number">3</span>); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><ul><li>回调函数接收三个参数, 当前值、当前位置和原数组.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].find(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><code>findIndex()</code>方法与<code>find()</code>类似, 返回第一个符合条件的数组成员的<strong>位置</strong>, 如果都不符合则返回<code>-1</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].findIndex(<span class="function">(<span class="params">v, i, a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> v &gt; <span class="number">2</span>;</span><br><span class="line">&#125;); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h3 id="fill"><a href="#fill" class="headerlink" title="fill()"></a>fill()</h3><ul><li>用于用指定值<strong>填充</strong>一个数组, 通常用来<strong>初始化空数组</strong>, 并抹去数组中已有的元素.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>).fill(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// [&#x27;a&#x27;,&#x27;a&#x27;,&#x27;a&#x27;]</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].fill(<span class="string">&#x27;a&#x27;</span>); <span class="comment">// [&#x27;a&#x27;,&#x27;a&#x27;,&#x27;a&#x27;]</span></span><br></pre></td></tr></table></figure><ul><li>并且<code>fill()</code>的第二个和第三个参数指定填充的<strong>起始位置</strong>和<strong>结束位置</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].fill(<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>); <span class="comment">//  [1, &quot;a&quot;, 3]</span></span><br></pre></td></tr></table></figure><h3 id="entries-keys-values"><a href="#entries-keys-values" class="headerlink" title="entries(), keys(), values()"></a>entries(), keys(), values()</h3><ul><li>主要用于遍历数组, <code>entries()</code>对键值对遍历, <code>keys()</code>对键名遍历, <code>values()</code>对键值遍历.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> e <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].values()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> e <span class="keyword">of</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>].entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">// 1 &#x27;b&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="includes"><a href="#includes" class="headerlink" title="includes()"></a>includes()</h3><ul><li>用于表示数组是否包含给定的值, 与字符串的<code>includes</code>方法类似.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">2</span>); <span class="comment">// true</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">4</span>); <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="literal">NaN</span>].includes(<span class="literal">NaN</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>第二个参数为<strong>起始位置</strong>, 默认为<code>0</code>, 如果负数, 则表示倒数的位置, 如果大于数组长度, 则重置为<code>0</code>开始.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">3</span>, <span class="number">3</span>); <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">3</span>, <span class="number">4</span>); <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">3</span>, -<span class="number">1</span>); <span class="comment">// true</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">3</span>, -<span class="number">4</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="flat-flatMap"><a href="#flat-flatMap" class="headerlink" title="flat(), flatMap()"></a>flat(), flatMap()</h3><ul><li><code>flat()</code>用于将数组一维化, 返回一个新数组, 不影响原数组.</li><li>默认一次只一维化一层数组, 若需多层, 则传入一个整数参数指定层数.</li><li>若要一维化所有层的数组, 则传入<code>Infinity</code>作为参数.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">2</span>, <span class="number">3</span>]].flat(); <span class="comment">// [1,2,2,3]</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]]].flat(<span class="number">3</span>); <span class="comment">// [1,2,3,4,5,6]</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]]].flat(<span class="string">&#x27;Infinity&#x27;</span>); <span class="comment">// [1,2,3,4,5,6]</span></span><br></pre></td></tr></table></figure><ul><li><code>flatMap()</code>是将原数组每个对象先执行一个函数, 在对返回值组成的数组执行<code>flat()</code>方法, 返回一个新数组, 不改变原数组.</li><li><code>flatMap()</code>只能展开一层.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].flatMap(<span class="function">(<span class="params">x</span>) =&gt;</span> [x, x * <span class="number">2</span>]);</span><br><span class="line"><span class="comment">// [2, 4, 3, 6, 4, 8] </span></span><br></pre></td></tr></table></figure><h2 id="对象的拓展-✔"><a href="#对象的拓展-✔" class="headerlink" title="对象的拓展 ✔"></a>对象的拓展 ✔</h2><h3 id="属性的简洁表示"><a href="#属性的简洁表示" class="headerlink" title="属性的简洁表示"></a>属性的简洁表示</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;a1&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  a</span><br><span class="line">&#125;; <span class="comment">// b =&gt; &#123; a : &#x27;a1&#x27; &#125;</span></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  a: a</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    a,</span><br><span class="line">    b</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    a: a,</span><br><span class="line">    b: b</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  fun: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="属性名表达式"><a href="#属性名表达式" class="headerlink" title="属性名表达式"></a>属性名表达式</h3><p><code>JavaScript</code> 提供2种方法<strong>定义对象的属性</strong>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法1 标识符作为属性名</span></span><br><span class="line">a.f = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2 字符串作为属性名</span></span><br><span class="line">a[<span class="string">&#x27;f&#x27;</span> + <span class="string">&#x27;un&#x27;</span>] = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>延伸出来的还有:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;hi leo&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  [a]: <span class="literal">true</span>,</span><br><span class="line">  [<span class="string">&#x27;a&#x27;</span> + <span class="string">&#x27;bc&#x27;</span>]: <span class="number">123</span>,</span><br><span class="line">  [<span class="string">&#x27;my&#x27;</span> + <span class="string">&#x27;fun&#x27;</span>]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// b.a =&gt; undefined ; b.abc =&gt; 123 ; b.myfun() =&gt; &#x27;hi&#x27;</span></span><br><span class="line"><span class="comment">// b[a] =&gt; true ; b[&#x27;abc&#x27;] =&gt; 123 ; b[&#x27;myfun&#x27;] =&gt; ƒ [&#x27;my&#x27; + &#x27;fun&#x27;] ()&#123; return &#x27;hi&#x27;; &#125;</span></span><br></pre></td></tr></table></figure><p><code>注意</code> :<br>属性名表达式不能与简洁表示法同时使用, 否则报错.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">let</span> a1 = <span class="string">&#x27;aa&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> a2 = <span class="string">&#x27;bb&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> b1 = &#123;</span><br><span class="line">  [a1]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">let</span> a1 = <span class="string">&#x27;aa&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> b1 = &#123;</span><br><span class="line">  [a1]: <span class="string">&#x27;bb&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Object-is"><a href="#Object-is" class="headerlink" title="Object.is()"></a>Object.is()</h3><p><code>Object.is()</code> 用于比较两个值是否严格相等, 在ES5时候只要使用<strong>相等运算符</strong>( <code>==</code> )和<strong>严格相等运算符</strong>( <code>===</code> )就可以做比较, 但是它们都有缺点, 前者会<strong>自动转换数据类型</strong>, 后者的 <code>NaN</code> 不等于自身, 以及 <code>+0</code> 等于 <code>-0</code> .</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.is(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.is(&#123;&#125;, &#123;&#125;); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line">+</span><br><span class="line"><span class="number">0</span> === -<span class="number">0</span>; <span class="comment">// true</span></span><br><span class="line"><span class="literal">NaN</span> === <span class="literal">NaN</span>; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="built_in">Object</span>.is(+<span class="number">0</span>, -<span class="number">0</span>); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">Object</span>.is(<span class="literal">NaN</span>, <span class="literal">NaN</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign()"></a>Object.assign()</h3><p><code>Object.assign()</code> 方法用于对象的合并, 将原对象的所有可枚举属性复制到目标对象.</p><ul><li>基础用法:<br>第一个参数是<strong>目标对象</strong>, 后面参数都是<strong>源对象</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  b: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.assign(a, b); <span class="comment">// a=&gt; &#123;a:1,b:2&#125;</span></span><br></pre></td></tr></table></figure><p><code>注意</code> :</p><ul><li>若目标对象与源对象有同名属性, 则后面属性会覆盖前面属性.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  b: <span class="number">3</span>,</span><br><span class="line">  c: <span class="number">4</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.assign(a, b); <span class="comment">// a =&gt; &#123;a:1, b:3, c:4&#125;</span></span><br></pre></td></tr></table></figure><ul><li>若只有<strong>一个</strong>参数, 则返回该参数.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.assign(a) === a; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>若参数<strong>不是对象</strong>, 则先转成对象后返回.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="built_in">Object</span>.assign(<span class="number">2</span>); <span class="comment">// &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>由于<code>undefined</code>或<code>NaN</code>无法转成对象, 所以做为参数会报错.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.assign(<span class="literal">undefined</span>); <span class="comment">// 报错</span></span><br><span class="line"><span class="built_in">Object</span>.assign(<span class="literal">NaN</span>); <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure><ul><li><code>Object.assign()</code>实现的是浅拷贝.</li></ul><p><code>Object.assign()</code> 拷贝得到的是这个对象的引用. 这个对象的任何变化, 都会反映到目标对象上面.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  a: &#123;</span><br><span class="line">    b: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Object</span>.assign(&#123;&#125;, a);</span><br><span class="line">a.a.b = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(b.a.b); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><ul><li>将数组当做对象处理, 键名为数组下标, 键值为数组下标对应的值.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.assign([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// [4, 5, 3]</span></span><br></pre></td></tr></table></figure><h2 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>ES6引入 <code>Symbol</code> 作为一种新的<strong>原始数据类型</strong>, 表示<strong>独一无二</strong>的值, 主要是为了<strong>防止属性名冲突</strong>.<br>ES6之后, JavaScript一共有 7 种数据类型: <code>Symbol</code> 、 <code>undefined</code> 、 <code>null</code> 、 <code>Boolean</code> 、 <code>String</code> 、 <code>Number</code> 、 <code>Object</code> .<br>简单示例:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">typeof</span> a; <span class="comment">// &quot;symbol&quot;</span></span><br></pre></td></tr></table></figure><p> <code>注意</code></p><ul><li><code>Symbol</code>函数不能用<code>new</code>, 会报错. 由于<code>Symbol</code>是一个原始类型, 不是对象, 所以不能添加属性, 它是类似于字符串的数据类型.</li><li><code>Symbol</code>都是不相等的, 即使参数相同.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有参数</span></span><br><span class="line"><span class="keyword">let</span> a1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">let</span> a2 = <span class="built_in">Symbol</span>();</span><br><span class="line">a1 === a2; <span class="comment">// false </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 有参数</span></span><br><span class="line"><span class="keyword">let</span> a1 = <span class="built_in">Symbol</span>(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> a2 = <span class="built_in">Symbol</span>(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">a1 === a2; <span class="comment">// false </span></span><br></pre></td></tr></table></figure><ul><li><code>Symbol</code>不能与其他类型的值计算, 会报错.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Symbol</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">a + <span class="string">&quot; world!&quot;</span>; <span class="comment">// 报错</span></span><br><span class="line"><span class="string">`<span class="subst">$&#123;a&#125;</span> world!`</span>; <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure><p>Symbol可以显式转换为字符串:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = <span class="built_in">Symbol</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>(a1); <span class="comment">// &quot;Symbol(hello)&quot;</span></span><br><span class="line">a1.toString(); <span class="comment">// &quot;Symbol(hello)&quot;</span></span><br></pre></td></tr></table></figure><p>Symbol可以转换为布尔值, 但不能转为数值:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="built_in">Boolean</span>(a1);</span><br><span class="line">!a1; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span>(a1); <span class="comment">// TypeError</span></span><br><span class="line">a1 + <span class="number">1</span>; <span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure><h3 id="Symbol作为属性名"><a href="#Symbol作为属性名" class="headerlink" title="Symbol作为属性名"></a>Symbol作为属性名</h3><p>好处: 防止同名属性, 还有防止键被改写或覆盖.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a1 = <span class="built_in">Symbol</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法1</span></span><br><span class="line"><span class="keyword">let</span> b = &#123;&#125;;</span><br><span class="line">b[a1] = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法2</span></span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  [a1]: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法3</span></span><br><span class="line"><span class="keyword">let</span> b = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(b, a1, &#123;</span><br><span class="line">  value: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3种写法 结果相同</span></span><br><span class="line">b[a1]; <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>需要注意:</strong> Symbol作为对象属性名时, 不能用点运算符, 并且必须放在方括号内.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">let</span> b = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能用点运算</span></span><br><span class="line">b.a = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">b[a]; <span class="comment">// undefined</span></span><br><span class="line">b[<span class="string">&#x27;a&#x27;</span>]; <span class="comment">// &#x27;hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须放在方括号内</span></span><br><span class="line"><span class="keyword">let</span> c = &#123;</span><br><span class="line">  [a]: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(text);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">c[a](<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// &#x27;leo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面等价于 更简洁</span></span><br><span class="line"><span class="keyword">let</span> c = &#123;</span><br><span class="line">  [a](text) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(text);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>常常还用于创建一组常量, 保证所有值不相等:</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line">a.a1 = &#123;</span><br><span class="line">  AAA: <span class="built_in">Symbol</span>(<span class="string">&#x27;aaa&#x27;</span>),</span><br><span class="line">  BBB: <span class="built_in">Symbol</span>(<span class="string">&#x27;bbb&#x27;</span>),</span><br><span class="line">  CCC: <span class="built_in">Symbol</span>(<span class="string">&#x27;ccc&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="应用-消除魔术字符串"><a href="#应用-消除魔术字符串" class="headerlink" title="应用: 消除魔术字符串"></a>应用: 消除魔术字符串</h3><p>魔术字符串: 指代码中多次出现, 强耦合的字符串或数值, 应该避免, 而使用含义清晰的变量代替.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a == <span class="string">&#x27;leo&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// &#x27;hello&#x27; 为魔术字符串</span></span><br></pre></td></tr></table></figure><p>常使用变量, 消除魔术字符串:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  name: <span class="string">&#x27;leo&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a == obj.name) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">f(obj.name); <span class="comment">// &#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure><p>使用Symbol消除强耦合, 使得不需关系具体的值:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  name: <span class="built_in">Symbol</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a == obj.name) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">f(obj.name);</span><br></pre></td></tr></table></figure><h3 id="属性名遍历"><a href="#属性名遍历" class="headerlink" title="属性名遍历"></a>属性名遍历</h3><p>Symbol作为属性名遍历, 不出现在 <code>for...in</code> 、 <code>for...of</code> 循环, 也不被 <code>Object.keys()</code> 、 <code>Object.getOwnPropertyNames()</code> 、 <code>JSON.stringify()</code> 返回.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Symbol</span>(<span class="string">&#x27;aa&#x27;</span>),</span><br><span class="line">  b = <span class="built_in">Symbol</span>(<span class="string">&#x27;bb&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  [a]: <span class="string">&#x27;11&#x27;</span>,</span><br><span class="line">  [b]: <span class="string">&#x27;22&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">Object</span>.values(obj)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 无输出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> aa = <span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, aa, &#123;</span><br><span class="line">  value: <span class="string">&#x27;hi&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k); <span class="comment">// 无输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames(obj); <span class="comment">// []</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(obj); <span class="comment">// [Symbol(leo)]</span></span><br></pre></td></tr></table></figure><p><code>Object.getOwnPropertySymbols</code> 方法返回一个数组, 包含当前对象所有用做属性名的Symbol值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> a1 = <span class="built_in">Symbol</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> a2 = <span class="built_in">Symbol</span>(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">a[a1] = <span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line">a[a2] = <span class="string">&#x27;oi&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="built_in">Object</span>.getOwnPropertySymbols(a);</span><br><span class="line">obj; <span class="comment">//  [Symbol(a), Symbol(b)]</span></span><br></pre></td></tr></table></figure><p>另外可以使用 <code>Reflect.ownKeys</code> 方法可以返回所有类型的键名, 包括常规键名和 Symbol 键名.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>(<span class="string">&#x27;leo&#x27;</span>)]: <span class="number">1</span>,</span><br><span class="line">  aa: <span class="number">2</span>,</span><br><span class="line">  bb: <span class="number">3</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Reflect</span>.ownKeys(a); <span class="comment">// [&#x27;aa&#x27;, &#x27;bb&#x27;,Symbol(&#x27;leo&#x27;)]</span></span><br></pre></td></tr></table></figure><p>由于Symbol值作为名称的属性不被常规方法遍历获取, 因此常用于定义对象的一些非私有, 且内部使用的方法.</p><h3 id="Symbol-for-、Symbol-keyFor"><a href="#Symbol-for-、Symbol-keyFor" class="headerlink" title="Symbol.for()、Symbol.keyFor()"></a>Symbol.for()、Symbol.keyFor()</h3><ul><li>Symbol.for()</li><li>*用于重复使用一个Symbol值**, 接收一个<strong>字符串</strong>作为参数, 若存在用此参数作为名称的Symbol值, 返回这个Symbol, 否则新建并返回以这个参数为名称的Symbol值.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"></span><br><span class="line">a === b; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><code>Symbol()</code> 和 <code>Symbol.for()</code> 区别:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Symbol</span>.for(<span class="string">&#x27;aa&#x27;</span>) === <span class="built_in">Symbol</span>.for(<span class="string">&#x27;aa&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Symbol</span>(<span class="string">&#x27;aa&#x27;</span>) === <span class="built_in">Symbol</span>(<span class="string">&#x27;aa&#x27;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><ul><li>Symbol.keyFor()</li><li>*用于返回一个已使用的Symbol类型的key**:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="built_in">Symbol</span>.for(<span class="string">&#x27;aa&#x27;</span>);</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(a); <span class="comment">//  &#x27;aa&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Symbol</span>(<span class="string">&#x27;aa&#x27;</span>);</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(b); <span class="comment">//  undefined</span></span><br></pre></td></tr></table></figure><h3 id="内置的Symbol值"><a href="#内置的Symbol值" class="headerlink" title="内置的Symbol值"></a>内置的Symbol值</h3><p>ES6提供11个内置的Symbol值, 指向语言内部使用的方法:</p><ul><li><ol><li>Symbol.hasInstance**<br>当其他对象使用 <code>instanceof</code> 运算符, 判断是否为该对象的实例时, 会调用这个方法. 比如, <code>foo instanceof Foo</code> 在语言内部, 实际调用的是 <code>Foo[Symbol.hasInstance](foo)</code> .</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.hasInstance](a) &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="keyword">instanceof</span> <span class="built_in">Array</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">instanceof</span> <span class="keyword">new</span> P(); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>P是一个类, new P()会返回一个实例, 该实例的 <code>Symbol.hasInstance</code> 方法, 会在进行 <code>instanceof</code> 运算时自动调用, 判断左侧的运算子是否为 <code>Array</code> 的实例.</p><ul><li><ol start="2"><li>Symbol.isConcatSpreadable**<br>值为布尔值, 表示该对象用于 <code>Array.prototype.concat()</code> 时, 是否可以展开.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;bb&#x27;</span>];</span><br><span class="line">[<span class="string">&#x27;cc&#x27;</span>, <span class="string">&#x27;dd&#x27;</span>].concat(a, <span class="string">&#x27;ee&#x27;</span>);</span><br><span class="line"><span class="comment">// [&#x27;cc&#x27;, &#x27;dd&#x27;, &#x27;aa&#x27;, &#x27;bb&#x27;, &#x27;ee&#x27;]</span></span><br><span class="line">a[<span class="built_in">Symbol</span>.isConcatSpreadable]; <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = [<span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;bb&#x27;</span>];</span><br><span class="line">b[<span class="built_in">Symbol</span>.isConcatSpreadable] = <span class="literal">false</span>;</span><br><span class="line">[<span class="string">&#x27;cc&#x27;</span>, <span class="string">&#x27;dd&#x27;</span>].concat(b, <span class="string">&#x27;ee&#x27;</span>);</span><br><span class="line"><span class="comment">// [&#x27;cc&#x27;, &#x27;dd&#x27;,[ &#x27;aa&#x27;, &#x27;bb&#x27;], &#x27;ee&#x27;]</span></span><br></pre></td></tr></table></figure><ul><li><ol start="3"><li>Symbol.species**</li></ol></li></ul><p>指向一个构造函数, 在创建衍生对象时会使用, 使用时需要用 <code>get</code> 取值器.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> get[<span class="built_in">Symbol</span>.species]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解决下面问题:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：  b应该是 Array 的实例，实际上是 P 的实例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">let</span> b = a.map(<span class="function"><span class="params">x</span> =&gt;</span> x);</span><br><span class="line"></span><br><span class="line">b <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">// true</span></span><br><span class="line">b <span class="keyword">instanceof</span> P; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决：  通过使用 Symbol.species</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> get[<span class="built_in">Symbol</span>.species]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line"><span class="keyword">let</span> b = a.map(<span class="function"><span class="params">x</span> =&gt;</span> x);</span><br><span class="line">b <span class="keyword">instanceof</span> P; <span class="comment">// false</span></span><br><span class="line">b <span class="keyword">instanceof</span> <span class="built_in">Array</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li><ol start="4"><li>Symbol.match**</li></ol></li></ul><p>当执行 <code>str.match(myObject)</code> , 传入的属性存在时会调用, 并返回该方法的返回值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.match](string) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span>.indexOf(string);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&#x27;h&#x27;</span>.match(<span class="keyword">new</span> P()); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><ul><li><ol start="5"><li>Symbol.replace**</li></ol></li></ul><p>当该对象被 <code>String.prototype.replace</code> 方法调用时, 会返回该方法的返回值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line">a[<span class="built_in">Symbol</span>.replace] = <span class="function">(<span class="params">...s</span>) =&gt;</span> <span class="built_in">console</span>.log(s);</span><br><span class="line"><span class="string">&#x27;Hello&#x27;</span>.replace(a, <span class="string">&#x27;World&#x27;</span>) <span class="comment">// [&quot;Hello&quot;, &quot;World&quot;]</span></span><br></pre></td></tr></table></figure><ul><li><ol start="6"><li>Symbol.search**</li></ol></li></ul><p>当该对象被 <code>String.prototype.search</code> 方法调用时, 会返回该方法的返回值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="built_in">Symbol</span>.search](s) &#123;</span><br><span class="line">      <span class="keyword">return</span> s.indexOf(<span class="built_in">this</span>.val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&#x27;hileo&#x27;</span>.search(<span class="keyword">new</span> P(<span class="string">&#x27;leo&#x27;</span>)); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><ul><li><ol start="7"><li>Symbol.split**<br>当该对象被 <code>String.prototype.split</code> 方法调用时, 会返回该方法的返回值.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重新定义了字符串对象的split方法的行为</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">val</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="built_in">Symbol</span>.split](s) &#123;</span><br><span class="line">      <span class="keyword">let</span> i = s.indexOf(<span class="built_in">this</span>.val);</span><br><span class="line">      <span class="keyword">if</span> (i == -<span class="number">1</span>) <span class="keyword">return</span> s;</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        s.substr(<span class="number">0</span>, i),</span><br><span class="line">        s.substr(i + <span class="built_in">this</span>.val.length)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span>.split(<span class="keyword">new</span> P(<span class="string">&#x27;hello&#x27;</span>)); <span class="comment">// [&quot;hello&quot;, &quot;&quot;]</span></span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span>.split(<span class="keyword">new</span> P(<span class="string">&#x27;world&#x27;</span>)); <span class="comment">// [&quot;&quot;, &quot;world&quot;] </span></span><br><span class="line"><span class="string">&#x27;helloworld&#x27;</span>.split(<span class="keyword">new</span> P(<span class="string">&#x27;leo&#x27;</span>)); <span class="comment">// &quot;helloworld&quot;</span></span><br></pre></td></tr></table></figure><ul><li><ol start="8"><li>Symbol.iterator**<br>对象进行 <code>for...of</code> 循环时, 会调用 <code>Symbol.iterator</code> 方法, 返回该对象的默认遍历器.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  *[<span class="built_in">Symbol</span>.interator]() &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">this</span>[i] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">yield</span> <span class="built_in">this</span>[i];</span><br><span class="line">      ++i;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">a[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><ol start="9"><li>Symbol.toPrimitive**</li></ol></li></ul><p>该对象被转为原始类型的值时, 会调用这个方法, 返回该对象对应的原始类型值. 调用时, 需要接收一个字符串参数, 表示当前运算模式, 运算模式有:<br> - Number : 此时需要转换成数值<br> - String : 此时需要转换成字符串<br> - Default : 此时可以转换成数值或字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.toPrimitive](hint) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (hint) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;number&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;string&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;str&#x27;</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;default&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;default&#x27;</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> * obj <span class="comment">// 246</span></span><br><span class="line"><span class="number">3</span> + obj <span class="comment">// &#x27;3default&#x27;</span></span><br><span class="line">obj == <span class="string">&#x27;default&#x27;</span> <span class="comment">// true</span></span><br><span class="line"><span class="built_in">String</span>(obj) <span class="comment">// &#x27;str&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><ol start="10"><li>Symbol.toStringTag**</li></ol></li></ul><p>在该对象上面调用 <code>Object.prototype.toString</code> 方法时, 如果这个属性存在, 它的返回值会出现在 <code>toString</code> 方法返回的字符串之中, 表示对象的类型. 也就是说, 这个属性可以用来定制 <code>[object Object</code> ]或 <code>[object Array]</code> 中 <code>object</code> 后面的那个字符串.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例一</span></span><br><span class="line">(&#123;</span><br><span class="line">  [<span class="built_in">Symbol</span>.toStringTag]: <span class="string">&#x27;Foo&#x27;</span></span><br><span class="line">&#125;.toString())</span><br><span class="line"><span class="comment">// &quot;[object Foo]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例二</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Collection</span> </span>&#123;</span><br><span class="line">  get[<span class="built_in">Symbol</span>.toStringTag]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> x = <span class="keyword">new</span> Collection();</span><br><span class="line"><span class="built_in">Object</span>.prototype.toString.call(x) <span class="comment">// &quot;[object xxx]&quot;</span></span><br></pre></td></tr></table></figure><p>ES6 新增内置对象的Symbol.toStringTag属性值如下.</p><ul><li><p>JSON[Symbol.toStringTag]:’JSON’</p></li><li><p>Math[Symbol.toStringTag]:’Math’</p></li><li><p>Module 对象M[Symbol.toStringTag]:’Module’</p></li><li><p>ArrayBuffer.prototype[Symbol.toStringTag]:’ArrayBuffer’</p></li><li><p>DataView.prototype[Symbol.toStringTag]:’DataView’</p></li><li><p>Map.prototype[Symbol.toStringTag]:’Map’</p></li><li><p>Promise.prototype[Symbol.toStringTag]:’Promise’</p></li><li><p>Set.prototype[Symbol.toStringTag]:’Set’</p></li><li><p>%TypedArray%.prototype[Symbol.toStringTag]:’Uint8Array’等</p></li><li><p>WeakMap.prototype[Symbol.toStringTag]:’WeakMap’</p></li><li><p>WeakSet.prototype[Symbol.toStringTag]:’WeakSet’</p></li><li><p>%MapIteratorPrototype%[Symbol.toStringTag]:’Map Iterator’</p></li><li><p>%SetIteratorPrototype%[Symbol.toStringTag]:’Set Iterator’</p></li><li><p>%StringIteratorPrototype%[Symbol.toStringTag]:’String Iterator’</p></li><li><p>Symbol.prototype[Symbol.toStringTag]:’Symbol’</p></li><li><p>Generator.prototype[Symbol.toStringTag]:’Generator’</p></li><li><p>GeneratorFunction.prototype[Symbol.toStringTag]:’GeneratorFunction’</p></li><li><ol start="11"><li>Symbol.unscopables**<br>该对象指定了使用with关键字时, 哪些属性会被with环境排除.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有 unscopables 时</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">foo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">with</span>(<span class="params">MyClass.prototype</span>)</span> &#123;</span><br><span class="line">  foo(); <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有 unscopables 时</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">foo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  get[<span class="built_in">Symbol</span>.unscopables]() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      foo: <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">with</span>(<span class="params">MyClass.prototype</span>)</span> &#123;</span><br><span class="line">  foo(); <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面代码通过指定 <code>Symbol.unscopables</code> 属性, 使得 <code>with</code> 语法块不会在当前作用域寻找 <code>foo</code> 属性, 即 <code>foo</code> 将指向外层作用域的变量.</p><p><a href="#%E4%BA%8C%E7%9B%AE%E5%BD%95">⬆ 返回目录</a></p><h2 id="Set和Map数据结构"><a href="#Set和Map数据结构" class="headerlink" title="Set和Map数据结构"></a>Set和Map数据结构</h2><h3 id="10-1-Set"><a href="#10-1-Set" class="headerlink" title="10.1 Set"></a>10.1 Set</h3><p><strong>介绍</strong>:<br><code>Set</code> 数据结构类似数组, 但所有成员的值<strong>唯一</strong>.<br><code>Set</code> 本身为一个构造函数, 用来生成 <code>Set</code> 数据结构, 使用 <code>add</code> 方法来添加新成员.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>].forEach(<span class="function"><span class="params">x</span> =&gt;</span> a.add(x));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 1 2 3 4 5</span></span><br></pre></td></tr></table></figure><p><strong>基础使用</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line">[...a]; <span class="comment">// [1,2,3,4]</span></span><br><span class="line">a.size; <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组去重</span></span><br><span class="line">[...new <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>])]; <span class="comment">// [1,2,3,4]</span></span><br></pre></td></tr></table></figure><p><code>注意</code> :</p><ul><li>向<code>Set</code>中添加值的时候, 不会类型转换, 即<code>5</code>和<code>&#39;5&#39;</code>是不同的.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[...new <span class="built_in">Set</span>([<span class="number">5</span>, <span class="string">&#x27;5&#x27;</span>])]; <span class="comment">// [5, &quot;5&quot;]</span></span><br></pre></td></tr></table></figure><p><strong>属性和方法</strong>:</p><ul><li><p>属性:</p><ul><li><code>Set.prototype.constructor</code>：构造函数，默认就是<code>Set</code>函数。</li><li><code>Set.prototype.size</code>：返回<code>Set</code>实例的成员总数。</li></ul></li><li><p>操作方法:</p><ul><li><code>add(value)</code>：添加某个值，返回 Set 结构本身。</li><li><code>delete(value)</code>：删除某个值，返回一个布尔值，表示删除是否成功。</li><li><code>has(value)</code>：返回一个布尔值，表示该值是否为Set的成员。</li><li><code>clear()</code>：清除所有成员，没有返回值。</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">a.add(<span class="number">1</span>).add(<span class="number">2</span>); <span class="comment">// a =&gt; Set(2) &#123;1, 2&#125;</span></span><br><span class="line">a.has(<span class="number">2</span>); <span class="comment">// true</span></span><br><span class="line">a.has(<span class="number">3</span>); <span class="comment">// false</span></span><br><span class="line">a.delete(<span class="number">2</span>); <span class="comment">// true  a =&gt; Set(1) &#123;1&#125;</span></span><br><span class="line">a.clear(); <span class="comment">// a =&gt; Set(0) &#123;&#125;</span></span><br></pre></td></tr></table></figure><p><strong>数组去重</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure><h3 id="10-2-Set的应用"><a href="#10-2-Set的应用" class="headerlink" title="10.2 Set的应用"></a>10.2 Set的应用</h3><p><strong>数组去重</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法1</span></span><br><span class="line">[...new <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>])]; <span class="comment">// [1,2,3,4]</span></span><br><span class="line"><span class="comment">// 方法2</span></span><br><span class="line"><span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>])); <span class="comment">// [1,2,3,4]</span></span><br></pre></td></tr></table></figure><p><strong>遍历和过滤</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// map 遍历操作</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].map(<span class="function"><span class="params">x</span> =&gt;</span> x * <span class="number">2</span>)); <span class="comment">// b =&gt; Set(4) &#123;2,4,6,8&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// filter 过滤操作</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">x</span> =&gt;</span> (x % <span class="number">2</span>) == <span class="number">0</span>)); <span class="comment">// b =&gt; Set(2) &#123;2,4&#125;</span></span><br></pre></td></tr></table></figure><p><strong>获取并集、交集和差集</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并集</span></span><br><span class="line"><span class="keyword">let</span> c1 = <span class="keyword">new</span> <span class="built_in">Set</span>([...a, ...b]); <span class="comment">// Set &#123;1,2,3,4&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 交集</span></span><br><span class="line"><span class="keyword">let</span> c2 = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">x</span> =&gt;</span> b.has(x))); <span class="comment">// set &#123;2,3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 差集</span></span><br><span class="line"><span class="keyword">let</span> c3 = <span class="keyword">new</span> <span class="built_in">Set</span>([...a].filter(<span class="function"><span class="params">x</span> =&gt;</span> !b.has(x))); <span class="comment">// set &#123;1&#125;</span></span><br></pre></td></tr></table></figure><ul><li>遍历方法:<ul><li><code>keys()</code>：返回<strong>键名</strong>的遍历器。</li><li><code>values()</code>：返回<strong>键值</strong>的遍历器。</li><li><code>entries()</code>：返回<strong>键值对</strong>的遍历器。</li><li><code>forEach()</code>：使用回调函数遍历<strong>每个成员</strong>。</li></ul></li></ul><p><code>Set</code> 遍历顺序是<strong>插入顺序</strong>, 当保存多个回调函数, 只需按照顺序调用. 但由于 <code>Set</code> 结构<strong>没有键名只有键值</strong>, 所以 <code>keys()</code> 和 <code>values()</code> 是返回结果相同.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> a.keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;; <span class="comment">// &#x27;a&#x27; &#x27;b&#x27; &#x27;c&#x27;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> a.values()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;; <span class="comment">// &#x27;a&#x27; &#x27;b&#x27; &#x27;c&#x27;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> a.entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// [&#x27;a&#x27;,&#x27;a&#x27;] [&#x27;b&#x27;,&#x27;b&#x27;] [&#x27;c&#x27;,&#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure><p>并且 还可以使用 <code>for...of</code> 直接遍历 <code>Set</code> .</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;; <span class="comment">// &#x27;a&#x27; &#x27;b&#x27; &#x27;c&#x27;</span></span><br></pre></td></tr></table></figure><p><code>forEach</code> 与数组相同, 对每个成员执行操作, 且无返回值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">a.forEach(<span class="function">(<span class="params">v, k</span>) =&gt;</span> <span class="built_in">console</span>.log(k + <span class="string">&#x27; : &#x27;</span> + v));</span><br></pre></td></tr></table></figure><h3 id="10-3-WeakSet"><a href="#10-3-WeakSet" class="headerlink" title="10.3 WeakSet"></a>10.3 WeakSet</h3><p>与 Set 类似, 都是表示不重复的值的集合, 但是区别如下:</p><ol><li>WeakSet 成员只能为对象，不能为其他类型的值：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> leo = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line">leo.add(<span class="number">1</span>); <span class="comment">// TypeError: Invalid value used in weak set</span></span><br><span class="line">leo.add(<span class="built_in">Symbol</span>()); <span class="comment">// TypeError: Invalid value used in weak set</span></span><br></pre></td></tr></table></figure><ol start="2"><li>WeakSet 成员对象为弱引用</li></ol><p>垃圾回收机制不考虑 WeakSet 对该对象对引用, 即如果其他对象不再引用该对象, 那么就会被垃圾回收机制自动回收.</p><ol start="3"><li>WeakSet 对象没有 <code>size</code> 属性, 是不可枚举的, 无法获取集合的大小.</li></ol><p>WeakSet 是一个构造函数, 可以使用 <code>new</code> 命令, 创建 WeakSet 数据结构.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> leo = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br></pre></td></tr></table></figure><p>WeakSet 可以接受一个<strong>数组</strong>或<strong>类数组对象</strong>作为参数. 该数组的所有成员, 都会自动成为 WeakSet 实例对象的成员.</p><p>实际上, 任何具有 Iterable 接口的对象, 都可以作为 WeakSet 的参数.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> leo = <span class="keyword">new</span> <span class="built_in">WeakSet</span>(arr);</span><br><span class="line"><span class="comment">// WeakSet &#123;[1, 2], [3, 4]&#125;</span></span><br></pre></td></tr></table></figure><p>上面代码中, <code>arr</code> 是一个<strong>数组</strong>, 它有两个成员, 也都是数组. <code>arr</code> 作为 WeakSet 构造函数的参数, <code>arr</code> 的成员会自动成为 WeakSet 的成员.</p><p>注意, 是 <code>arr</code> 数组的成员成为 WeakSet 的成员, 而不是 <code>arr</code> 数组本身. 这意味着, <strong>数组的成员只能是对象</strong>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">const</span> leo = <span class="keyword">new</span> <span class="built_in">WeakSet</span>(arr);</span><br><span class="line"><span class="comment">// Uncaught TypeError: Invalid value used in weak set(…)</span></span><br></pre></td></tr></table></figure><p>上面代码中, 数组 <code>arr</code> 的成员不是对象, 加入 WeakSet 就会<strong>报错</strong>.</p><p>WeakSet 结构有以下三个方法.</p><ul><li><code>WeakSet.prototype.add(value)</code>: 向 WeakSet 实例添加一个新成员.</li><li><code>WeakSet.prototype.delete(value)</code>: 清除 WeakSet 实例的指定成员.</li><li><code>WeakSet.prototype.has(value)</code>: 返回一个布尔值, 表示某个值是否在 WeakSet 实例之中.</li></ul><p>下面是一个例子.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="built_in">WeakSet</span>();</span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> foo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">ws.add(<span class="built_in">window</span>);</span><br><span class="line">ws.add(obj);</span><br><span class="line"></span><br><span class="line">ws.has(<span class="built_in">window</span>); <span class="comment">// true</span></span><br><span class="line">ws.has(foo); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">ws.delete(<span class="built_in">window</span>);</span><br><span class="line">ws.has(<span class="built_in">window</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p><code>注意</code> : WeakSet 没有 <code>size</code> 属性, 没有办法遍历它的成员.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ws.size <span class="comment">// undefined</span></span><br><span class="line">ws.forEach <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line">ws.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;WeakSet has &#x27;</span> + item)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// TypeError: undefined is not a function</span></span><br></pre></td></tr></table></figure><p>上面代码试图获取 <code>size</code> 和 <code>forEach</code> 属性, 结果都不能成功.</p><p>WeakSet 不能遍历, 是因为成员都是弱引用, 随时可能消失, 遍历机制无法保证成员的存在, 很可能刚刚遍历结束, 成员就取不到了. WeakSet 的一个用处, 是储存 DOM 节点, 而不用担心这些节点从文档移除时, 会引发内存泄漏.</p><p>下面是 WeakSet 的另一个例子.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foos = <span class="keyword">new</span> <span class="built_in">WeakSet</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    foos.add(<span class="built_in">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">method</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!foos.has(<span class="built_in">this</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&#x27;Foo.prototype.method 只能在Foo的实例上调用！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面代码保证了 <code>Foo</code> 的实例方法, 只能在 <code>Foo</code> 的实例上调用. 这里使用 WeakSet 的好处是, <code>foos</code> 对实例的引用, 不会被计入内存回收机制, 所以删除实例的时候, 不用考虑 <code>foos</code> , 也不会出现内存泄漏.</p><h3 id="10-4-Map"><a href="#10-4-Map" class="headerlink" title="10.4 Map"></a>10.4 Map</h3><p>由于传统的 <code>JavaScript</code> 对象只能用字符串当做键, 给开发带来很大限制, ES6增加 <code>Map</code> 数据结构, 使得<strong>各种类型的值</strong>(包括对象)都可以作为键.<br><code>Map</code> 结构提供了”<strong>值—值</strong>“的对应, 是一种更完善的 Hash 结构实现.</p><p><strong>基础使用</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="keyword">let</span> b = &#123;</span><br><span class="line">  name: <span class="string">&#x27;leo&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">a.set(b, <span class="string">&#x27;my name&#x27;</span>); <span class="comment">// 添加值</span></span><br><span class="line">a.get(b); <span class="comment">// 获取值</span></span><br><span class="line">a.size; <span class="comment">// 获取总数</span></span><br><span class="line">a.has(b); <span class="comment">// 查询是否存在</span></span><br><span class="line">a.delete(b); <span class="comment">// 删除一个值</span></span><br><span class="line">a.clear(); <span class="comment">// 清空所有成员 无返回</span></span><br></pre></td></tr></table></figure><p><code>注意</code> :</p><ul><li>传入数组作为参数, <strong>指定键值对的数组</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leo&#x27;</span>],</span><br><span class="line">  [<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>]</span><br><span class="line">])</span><br></pre></td></tr></table></figure><ul><li>如果对同一个键<strong>多次赋值</strong>, 后面的值将<strong>覆盖前面的值</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">a.set(<span class="number">1</span>, <span class="string">&#x27;aaa&#x27;</span>).set(<span class="number">1</span>, <span class="string">&#x27;bbb&#x27;</span>);</span><br><span class="line">a.get(<span class="number">1</span>); <span class="comment">// &#x27;bbb&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>如果读取一个未知的键, 则返回<code>undefined</code>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>().get(<span class="string">&#x27;abcdef&#x27;</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><ul><li>同样的值**的两个实例, 在 Map 结构中被视为两个键.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="keyword">let</span> a1 = [<span class="string">&#x27;aaa&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> a2 = [<span class="string">&#x27;aaa&#x27;</span>];</span><br><span class="line">a.set(a1, <span class="number">111</span>).set(a2, <span class="number">222</span>);</span><br><span class="line">a.get(a1); <span class="comment">// 111</span></span><br><span class="line">a.get(a2); <span class="comment">// 222</span></span><br></pre></td></tr></table></figure><p><strong>遍历方法</strong>:<br>Map 的遍历顺序就是插入顺序.</p><ul><li><code>keys()</code>: 返回键名的遍历器.</li><li><code>values()</code>: 返回键值的遍历器.</li><li><code>entries()</code>: 返回所有成员的遍历器.</li><li><code>forEach()</code>: 遍历 Map 的所有成员.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leo&#x27;</span>],</span><br><span class="line">  [<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> a.keys())&#123;...&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> a.values())&#123;...&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> a.entries())&#123;...&#125;;</span><br><span class="line">a.forEach(<span class="function">(<span class="params">v,k,m</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`key:<span class="subst">$&#123;k&#125;</span>,value:<span class="subst">$&#123;v&#125;</span>,map:<span class="subst">$&#123;m&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>将Map结构转成数组结构</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leo&#x27;</span>],</span><br><span class="line">  [<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a1 = [...a.keys()];   <span class="comment">// a1 =&gt; [&quot;name&quot;, &quot;age&quot;]</span></span><br><span class="line"><span class="keyword">let</span> a2 = [...a.values()]; <span class="comment">// a2 =&gt;  [&quot;leo&quot;, 18]</span></span><br><span class="line"><span class="keyword">let</span> a3 = [...a.entries()];<span class="comment">// a3 =&gt; [[&#x27;name&#x27;,&#x27;leo&#x27;], [&#x27;age&#x27;,18]]</span></span><br></pre></td></tr></table></figure><h3 id="10-5-Map与其他数据结构互相转换"><a href="#10-5-Map与其他数据结构互相转换" class="headerlink" title="10.5 Map与其他数据结构互相转换"></a>10.5 Map与其他数据结构互相转换</h3><ul><li>Map 转 数组</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="literal">true</span>, <span class="number">1</span>).set(&#123;</span><br><span class="line">  f: <span class="number">2</span></span><br><span class="line">&#125;, [<span class="string">&#x27;abc&#x27;</span>]);</span><br><span class="line">[...a]; <span class="comment">// [[true:1], [ &#123;f:2&#125;,[&#x27;abc&#x27;] ]]</span></span><br></pre></td></tr></table></figure><ul><li>数组 转 Map</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [</span><br><span class="line">  [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leo&#x27;</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="string">&#x27;hi&#x27;</span>]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Map</span>(a);</span><br></pre></td></tr></table></figure><ul><li>Map 转 对象</li></ul><p>如果所有 Map 的键都是字符串, 它可以无损地转为对象.<br>如果有非字符串的键名, 那么这个键名会被转成字符串, 再作为对象的键名.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> [k, v] <span class="keyword">of</span> s) &#123;</span><br><span class="line">    obj[k] = v;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="string">&#x27;yes&#x27;</span>, <span class="literal">true</span>).set(<span class="string">&#x27;no&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">fun(a)</span><br><span class="line"><span class="comment">// &#123; yes: true, no: false &#125;</span></span><br></pre></td></tr></table></figure><ul><li>对象 转 Map</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">Object</span>.keys(obj)) &#123;</span><br><span class="line">    a.set(k, obj[k]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun(&#123;</span><br><span class="line">  yes: <span class="literal">true</span>,</span><br><span class="line">  no: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// Map &#123;&quot;yes&quot; =&gt; true, &quot;no&quot; =&gt; false&#125;</span></span><br></pre></td></tr></table></figure><ul><li>Map 转 JSON</li></ul><p><strong>(1)Map键名都是字符串, 转为对象JSON:</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> [k, v] <span class="keyword">of</span> s) &#123;</span><br><span class="line">    obj[k] = v;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(obj)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="string">&#x27;yes&#x27;</span>, <span class="literal">true</span>).set(<span class="string">&#x27;no&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">fun(a);</span><br><span class="line"><span class="comment">// &#x27;&#123;&quot;yes&quot;:true,&quot;no&quot;:false&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>(2)Map键名有非字符串, 转为数组JSON:</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">map</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify([...map]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Map</span>().set(<span class="literal">true</span>, <span class="number">7</span>).set(&#123;</span><br><span class="line">  foo: <span class="number">3</span></span><br><span class="line">&#125;, [<span class="string">&#x27;abc&#x27;</span>]);</span><br><span class="line">fun(a)</span><br><span class="line"><span class="comment">// &#x27;[[true,7],[&#123;&quot;foo&quot;:3&#125;,[&quot;abc&quot;]]]&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>JSON 转 Map</li></ul><p><strong>(1)所有键名都是字符串:</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> strMap = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">Object</span>.keys(s)) &#123;</span><br><span class="line">    strMap.set(k, s[k]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> strMap;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(strMap);</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="string">&#x27;&#123;&quot;yes&quot;: true, &quot;no&quot;: false&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">// Map &#123;&#x27;yes&#x27; =&gt; true, &#x27;no&#x27; =&gt; false&#125;</span></span><br></pre></td></tr></table></figure><p><strong>(2)整个 JSON 就是一个数组, 且每个数组成员本身, 又是一个有两个成员的数组</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun2</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Map</span>(<span class="built_in">JSON</span>.parse(s));</span><br><span class="line">&#125;</span><br><span class="line">fun2(<span class="string">&#x27;[[true,7],[&#123;&quot;foo&quot;:3&#125;,[&quot;abc&quot;]]]&#x27;</span>)</span><br><span class="line"><span class="comment">// Map &#123;true =&gt; 7, Object &#123;foo: 3&#125; =&gt; [&#x27;abc&#x27;]&#125;</span></span><br></pre></td></tr></table></figure><h3 id="10-6-WeakMap"><a href="#10-6-WeakMap" class="headerlink" title="10.6 WeakMap"></a>10.6 WeakMap</h3><p>WeakMap 结构与 Map 结构类似, 也是用于<strong>生成键值对的集合</strong>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WeakMap 可以使用 set 方法添加成员</span></span><br><span class="line"><span class="keyword">const</span> wm1 = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> key = &#123;</span><br><span class="line">  foo: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line">wm1.set(key, <span class="number">2</span>);</span><br><span class="line">wm1.get(key) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WeakMap 也可以接受一个数组，</span></span><br><span class="line"><span class="comment">// 作为构造函数的参数</span></span><br><span class="line"><span class="keyword">const</span> k1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> k2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">const</span> wm2 = <span class="keyword">new</span> <span class="built_in">WeakMap</span>([</span><br><span class="line">  [k1, <span class="string">&#x27;foo&#x27;</span>],</span><br><span class="line">  [k2, <span class="string">&#x27;bar&#x27;</span>]</span><br><span class="line">]);</span><br><span class="line">wm2.get(k2) <span class="comment">// &quot;bar&quot;</span></span><br></pre></td></tr></table></figure><p>WeakMap 与 Map 的区别有 4 点:</p><ol><li>WeakMap 只接受对象作为键名（null除外），不接受其他类型的值作为键名。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line">map.set(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: 1 is not an object!</span></span><br><span class="line">map.set(<span class="built_in">Symbol</span>(), <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br><span class="line">map.set(<span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br></pre></td></tr></table></figure><ol start="2"><li>WeakMap 的键名所指向的对象，不计入垃圾回收机制。</li></ol><p>WeakMap 的设计目的在于, 有时我们想在某个对象上面存放一些数据, 但是这会形成对于这个对象的引用. 请看下面的例子.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> e1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> e2 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> arr = [</span><br><span class="line">  [e1, <span class="string">&#x27;foo 元素&#x27;</span>],</span><br><span class="line">  [e2, <span class="string">&#x27;bar 元素&#x27;</span>],</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>上面代码中, e1和e2是两个对象, 我们通过arr数组对这两个对象添加一些文字说明. 这就形成了arr对e1和e2的引用.</p><p>一旦不再需要这两个对象, 我们就必须手动删除这个引用, 否则垃圾回收机制就不会释放e1和e2占用的内存.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不需要 e1 和 e2 的时候</span></span><br><span class="line"><span class="comment">// 必须手动删除引用</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="literal">null</span>;</span><br><span class="line">arr[<span class="number">1</span>] = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>上面这样的写法显然很不方便. 一旦忘了写, 就会造成内存泄露.</p><p>WeakMap 就是为了解决这个问题而诞生的, 它的键名所引用的对象都是弱引用, 即垃圾回收机制不将该引用考虑在内. 因此, 只要所引用的对象的其他引用都被清除, 垃圾回收机制就会释放该对象所占用的内存. 也就是说, 一旦不再需要, WeakMap 里面的键名对象和所对应的键值对会自动消失, 不用手动删除引用.</p><p>基本上, 如果你要往对象上添加数据, 又不想干扰垃圾回收机制, 就可以使用 WeakMap. 一个典型应用场景是, 在网页的 DOM 元素上添加数据, 就可以使用WeakMap结构. 当该 DOM 元素被清除, 其所对应的WeakMap记录就会自动被移除.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> element = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;example&#x27;</span>);</span><br><span class="line"></span><br><span class="line">wm.set(element, <span class="string">&#x27;some information&#x27;</span>);</span><br><span class="line">wm.get(element) <span class="comment">// &quot;some information&quot;</span></span><br></pre></td></tr></table></figure><p>上面代码中, 先新建一个 Weakmap 实例. 然后, 将一个 DOM 节点作为键名存入该实例, 并将一些附加信息作为键值, 一起存放在 WeakMap 里面. 这时, WeakMap 里面对element的引用就是弱引用, 不会被计入垃圾回收机制.</p><p>也就是说, 上面的 DOM 节点对象的引用计数是1, 而不是2. 这时, 一旦消除对该节点的引用, 它占用的内存就会被垃圾回收机制释放. Weakmap 保存的这个键值对, 也会自动消失.</p><p>总之, WeakMap的专用场合就是, 它的键所对应的对象, 可能会在将来消失. WeakMap结构有助于防止内存泄漏.</p><p>注意, WeakMap 弱引用的只是键名, 而不是键值. 键值依然是正常引用.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">let</span> key = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  foo: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">wm.set(key, obj);</span><br><span class="line">obj = <span class="literal">null</span>;</span><br><span class="line">wm.get(key)</span><br><span class="line"><span class="comment">// Object &#123;foo: 1&#125;</span></span><br></pre></td></tr></table></figure><p>上面代码中, 键值obj是正常引用. 所以, 即使在 WeakMap 外部消除了obj的引用, WeakMap 内部的引用依然存在.</p><ol start="3"><li>WeakMap 没有遍历操作对 API。</li></ol><p>WeakMap 是没有遍历操作(即没有 <code>keys()</code> 、 <code>values()</code> 和e <code>ntries()</code> 方法), 也没有 <code>size</code> 属性.<br>因为没有办法列出所有键名, 某个键名是否存在完全不可预测, 跟垃圾回收机制是否运行相关. 这一刻可以取到键名, 下一刻垃圾回收机制突然运行了, 这个键名就没了, 为了防止出现不确定性, 就统一规定不能取到键名.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">wm.size <span class="comment">// undefined</span></span><br><span class="line">wm.forEach <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><ol start="4"><li>WeakMap 无法清空。</li></ol><p>即不支持 <code>clear</code> 方法.<br>因此, WeakMap 只有四个方法可用: <code>get()</code> 、 <code>set()</code> 、 <code>has()</code> 、 <code>delete()</code> .</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">wm.clear <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p><strong>WeakMap 应用</strong>:</p><p><strong>场景1: 当我们想要为DOM添加数据时, 可使用 <code>WeakMap</code> .</strong></p><p>好处在于, 当DOM元素移除时, 对应 WeakMap 记录也会自动移除:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;WeakMap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wm = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">const</span> weakMap = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;WeakMap&#x27;</span>);</span><br><span class="line">wm.set(weakMap, <span class="string">&#x27;some information&#x27;</span>);</span><br><span class="line">wm.get(weakMap) <span class="comment">//&quot;some information&quot;</span></span><br></pre></td></tr></table></figure><p><strong>场景2: 当我们想要为DOM元素添加事件监听时, 可使用 <code>WeakMap</code> .</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;button1&quot;</span>&gt;</span>按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;button2&quot;</span>&gt;</span>按钮2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> button2 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;button2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> handler1 = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;button1 被点击&quot;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> handler2 = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;button2 被点击&quot;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码1</span></span><br><span class="line">button1.addEventListener(<span class="string">&#x27;click&#x27;</span>, handler1, <span class="literal">false</span>);</span><br><span class="line">button2.addEventListener(<span class="string">&#x27;click&#x27;</span>, handler2, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码2</span></span><br><span class="line"><span class="keyword">const</span> listener = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">listener.set(button1, handler1);</span><br><span class="line">listener.set(button2, handler2);</span><br><span class="line"></span><br><span class="line">button1.addEventListener(<span class="string">&#x27;click&#x27;</span>, listener.get(button1), <span class="literal">false</span>);</span><br><span class="line">button2.addEventListener(<span class="string">&#x27;click&#x27;</span>, listener.get(button2), <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>代码2比起代码1的好处是: 由于监听函数是放在 WeakMap 里面,</p><p>则一旦 DOM 对象button1 / button2消失, 与它绑定的监听函数handler1和handler2 也会自动消失.</p><p><a href="#%E4%BA%8C%E7%9B%AE%E5%BD%95">⬆ 返回目录</a></p><h2 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h2><p><code>proxy</code> 用于修改某些操作的<strong>默认行为</strong>, 可以理解为一种拦截外界对目标对象访问的一种机制, 从而对外界的访问进行过滤和修改, 即代理某些操作, 也称”<strong>代理器</strong>“.</p><h3 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h3><p><code>proxy</code> 实例化需要传入两个参数, <code>target</code> 参数表示所要拦截的目标对象, <code>handler</code> 参数也是一个对象, 用来定制拦截行为.</p><p>语法如下:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br></pre></td></tr></table></figure><p>简单示例:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span>(<span class="params">target, handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">a.name; <span class="comment">// leo</span></span><br><span class="line">a.age; <span class="comment">// leo</span></span><br><span class="line">a.abcd; <span class="comment">// leo</span></span><br></pre></td></tr></table></figure><p>上述 <code>a</code> 实例中, 在第二个参数中定义了 <code>get</code> 方法, 来拦截外界访问, 并且 <code>get</code> 方法接收两个参数, 分别是<strong>目标对象</strong>和<strong>所要访问的属性</strong>, 所以不管外部访问对象中任何属性都会执行 <code>get</code> 方法返回 <code>leo</code> .<br><code>注意</code> :</p><ul><li>只能使用<code>Proxy</code>实例的对象才能使用这些操作.</li><li>如果<code>handler</code>没有设置拦截, 则直接返回原对象.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> handler = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line">p.a = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">target.a; <span class="comment">// &#x27;leo&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>同个拦截器函数, 设置多个拦截操作</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;get方法&#x27;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  apply: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;apply方法&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这里还有一个简单的案例:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span>(<span class="params">target, name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> target ? target[name] : <span class="number">16</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, handler);</span><br><span class="line">p.a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(p.a, p.b);</span><br><span class="line"><span class="comment">// 1   16</span></span><br></pre></td></tr></table></figure><p>这里因为 <code>p.a = 1</code> 定义了 <code>p</code> 中的 <code>a</code> 属性, 值为 <code>1</code> , 而没有定义 <code>b</code> 属性, 所以 <code>p.a</code> 会得到 <code>1</code> , 而 <code>p.b</code> 会得到 <code>undefined</code> 从而使用 <code>name in target ? target[name] : 16;</code> 返回的默认值 <code>16</code> ;</p><p>** <code>Proxy</code> 支持的13种拦截操作**:</p><ul><li><p><code>get(target, propKey, receiver)</code>:<br>拦截对象属性的读取, 比如proxy.foo和proxy[‘foo’].</p></li><li><p><code>set(target, propKey, value, receiver)</code>:<br>拦截对象属性的设置, 比如proxy.foo = v或proxy[‘foo’] = v, 返回一个布尔值.</p></li><li><p><code>has(target, propKey)</code>:<br>拦截propKey in proxy的操作, 返回一个布尔值.</p></li><li><p><code>deleteProperty(target, propKey)</code>:<br>拦截delete proxy[propKey]的操作, 返回一个布尔值.</p></li><li><p><code>ownKeys(target)</code>:<br>拦截Object.getOwnPropertyNames(proxy)、Object.getOwnPropertySymbols(proxy)、Object.keys(proxy)、for…in循环, 返回一个数组. 该方法返回目标对象所有自身的属性的属性名, 而Object.keys()的返回结果仅包括目标对象自身的可遍历属性.</p></li><li><p><code>getOwnPropertyDescriptor(target, propKey)</code>:<br>拦截Object.getOwnPropertyDescriptor(proxy, propKey), 返回属性的描述对象.</p></li><li><p><code>defineProperty(target, propKey, propDesc)</code>:<br>拦截Object.defineProperty(proxy, propKey, propDesc)、Object.defineProperties(proxy, propDescs), 返回一个布尔值.</p></li><li><p><code>preventExtensions(target)</code>:<br>拦截Object.preventExtensions(proxy), 返回一个布尔值.</p></li><li><p><code>getPrototypeOf(target)</code>:<br>拦截Object.getPrototypeOf(proxy), 返回一个对象.</p></li><li><p><code>isExtensible(target)</code>:<br>拦截Object.isExtensible(proxy), 返回一个布尔值.</p></li><li><p><code>setPrototypeOf(target, proto)</code>:<br>拦截Object.setPrototypeOf(proxy, proto), 返回一个布尔值. 如果目标对象是函数, 那么还有两种额外操作可以拦截.</p></li><li><p><code>apply(target, object, args)</code>:<br>拦截 Proxy 实例作为函数调用的操作, 比如proxy(…args)、proxy.call(object, …args)、proxy.apply(…).</p></li><li><p><code>construct(target, args)</code>:<br>拦截 Proxy 实例作为构造函数调用的操作, 比如new proxy(…args).</p></li></ul><h3 id="取消Proxy实例"><a href="#取消Proxy实例" class="headerlink" title="取消Proxy实例"></a>取消Proxy实例</h3><p>使用 <code>Proxy.revocale</code> 方法取消 <code>Proxy</code> 实例.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> b = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  proxy,</span><br><span class="line">  revoke</span><br><span class="line">&#125; = <span class="built_in">Proxy</span>.revocale(a, b);</span><br><span class="line"></span><br><span class="line">proxy.name = <span class="string">&#x27;leo&#x27;</span>; <span class="comment">// &#x27;leo&#x27;</span></span><br><span class="line">revoke();</span><br><span class="line">proxy.name; <span class="comment">// TypeError: Revoked</span></span><br></pre></td></tr></table></figure><h3 id="实现-Web服务的客户端"><a href="#实现-Web服务的客户端" class="headerlink" title="实现 Web服务的客户端"></a>实现 Web服务的客户端</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> service = createWebService(<span class="string">&#x27;http://le.com/data&#x27;</span>);</span><br><span class="line">service.employees().than(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> employees = <span class="built_in">JSON</span>.parse(json);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWebService</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">    get(target, propKey, receiver &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> httpGet(url + <span class="string">&#x27;/&#x27;</span> + propKey);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Promise对象"><a href="#Promise对象" class="headerlink" title="Promise对象"></a>Promise对象</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>主要用途:<strong>解决异步编程带来的回调地狱问题</strong>.<br>把 <code>Promise</code> 简单理解一个容器, 存放着某个未来才会结束的事件(通常是一个异步操作)的结果. 通过 <code>Promise</code> 对象来获取异步操作消息, 处理各种异步操作.</p><p>** <code>Promise</code> 对象2特点**:</p><ul><li>对象的状态不受外界影响**.</li></ul><blockquote><p><code>Promise</code> 对象代表一个异步操作, 有三种状态:<strong>pending(进行中)**、</strong>fulfilled(已成功)<strong>和</strong>rejected(已失败)**. 只有异步操作的结果, 可以决定当前是哪一种状态, 任何其他操作都无法改变这个状态. 这也是 <code>Promise</code> 这个名字的由来, 它的英语意思就是”承诺”, 表示其他手段无法改变.</p></blockquote><ul><li>一旦状态改变, 就不会再变, 任何时候都可以得到这个结果**.</li></ul><blockquote><p>Promise对象的状态改变, 只有两种可能: 从<strong>pending</strong>变为<strong>fulfilled</strong>和从<strong>pending</strong>变为<strong>rejected</strong>. 只要这两种情况发生, 状态就凝固了, 不会再变了, 会一直保持这个结果, 这时就称为 <strong>resolved</strong>(已定型). 如果改变已经发生了, 你再对<strong>Promise</strong>对象添加回调函数, 也会立即得到这个结果. 这与事件(Event)完全不同, 事件的特点是, 如果你错过了它, 再去监听, 是得不到结果的.</p></blockquote><p>注意, 为了行文方便, 本章后面的 <code>resolve</code> d统一只指 <code>fulfilled</code> 状态, 不包含 <code>rejected</code> 状态.</p><p>** <code>Promise</code> 缺点**</p><ul><li>无法取消**Promise, 一旦新建它就会立即执行, 无法中途取消.</li><li>如果不设置回调函数, Promise内部抛出的错误, 不会反应到外部.</li><li>当处于pending状态时, 无法得知目前进展到哪一个阶段(刚刚开始还是即将完成).</li></ul><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p><code>Promise</code> 为一个构造函数, 需要用 <code>new</code> 来实例化.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="comment">/*异步操作成功*/</span> ) &#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>Promise</code> 接收一个函数作为参数, 该函数两个参数 <code>resolve</code> 和 <code>reject</code> , 由 JS 引擎提供.</p><ul><li><code>resolve</code>作用是将<code>Promise</code>的状态从pending变成resolved, 在异步操作成功时调用, 返回异步操作的结果, 作为参数传递出去.</li><li><code>reject</code>作用是将<code>Promise</code>的状态从pending变成rejected, 在异步操作失败时报错, 作为参数传递出去.</li></ul><p><code>Promise</code> 实例生成以后, 可以用 <code>then</code> 方法分别指定 <code>resolved</code> 状态和 <code>rejected</code> 状态的回调函数.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p.then(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success...</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// error...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>几个例子来理解</strong> :</p><ul><li>当一段时间过后, <code>Promise</code>状态便成为<code>resolved</code>触发<code>then</code>方法绑定的回调函数.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(result, ms, <span class="string">&#x27;done&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">timeout(<span class="number">100</span>).then(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(val);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><code>Promise</code>新建后立刻执行.<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">console.log(1);</span></span><br><span class="line"><span class="string">resolve();</span></span><br></pre></td></tr></table></figure> })<br>p.then(()=&gt;{</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>})<br>console.log(3);<br>// 1<br>// 3<br>// 2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**异步加载图片**：  </span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">function f(url)&#123;</span><br><span class="line">    return new Promise(function(resolve, reject)&#123;</span><br><span class="line">        const img &#x3D; new Image ();</span><br><span class="line">        img.onload &#x3D; function()&#123;</span><br><span class="line">            resolve(img);</span><br><span class="line">        &#125;</span><br><span class="line">        img.onerror &#x3D; function()&#123;</span><br><span class="line">            reject(new Error(</span><br><span class="line">                &#39;Could not load image at &#39; + url</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        img.src &#x3D; url;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>** <code>resolve</code> 函数和 <code>reject</code> 函数的参数为 <code>resolve</code> 函数或 <code>reject</code> 函数**:<br><code>p1</code> 的状态决定了 <code>p2</code> 的状态, 所以 <code>p2</code> 要等待 <code>p1</code> 的结果再执行回调函数.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;fail&#x27;</span>)), <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> resolve(p1), <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p2</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error))</span><br><span class="line"><span class="comment">// Error: fail</span></span><br></pre></td></tr></table></figure><p>**调用 <code>resolve</code> 或 <code>reject</code> 不会结束 <code>Promise</code> 参数函数的执行, 除了 <code>return</code> **:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) &#123;</span><br><span class="line">  <span class="keyword">return</span> resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h3 id="Promise-prototype-then"><a href="#Promise-prototype-then" class="headerlink" title="Promise.prototype.then()"></a>Promise.prototype.then()</h3><p>作用是为 <code>Promise</code> 添加状态改变时的回调函数, <code>then</code> 方法的第一个参数是 <code>resolved</code> 状态的回调函数, 第二个参数(可选)是 <code>rejected</code> 状态的回调函数.<br><code>then</code> 方法返回一个新 <code>Promise</code> 实例, 与原来 <code>Promise</code> 实例不同, 因此可以使用链式写法, 上一个 <code>then</code> 的结果作为下一个 <code>then</code> 的参数.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">&quot;/posts.json&quot;</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> json.post;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">post</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Promise-prototype-catch"><a href="#Promise-prototype-catch" class="headerlink" title="Promise.prototype.catch()"></a>Promise.prototype.catch()</h3><p><code>Promise.prototype.catch</code> 方法是 <code>.then(null, rejection)</code> 的别名, 用于指定发生错误时的回调函数.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">&#x27;/posts.json&#x27;</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">posts</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 处理 getJSON 和 前一个回调函数运行时发生的错误</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;发生错误！&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>如果 <code>Promise</code> 状态已经变成 <code>resolved</code> , 再抛出错误是无效的.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">p</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error)</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>当 <code>promise</code> 抛出一个错误, 就被 <code>catch</code> 方法指定的回调函数捕获, 下面三种写法相同.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写法一</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">p.catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Error: test</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    reject(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">p.catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法三</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;test&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line">p.catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>一般来说, 不要在 <code>then</code> 方法里面定义 <code>Reject</code> 状态的回调函数(即 <code>then</code> 的第二个参数), 总是使用 <code>catch</code> 方法.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad</span></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// good</span></span><br><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123; <span class="comment">//cb</span></span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h3 id="Promise-prototype-finally"><a href="#Promise-prototype-finally" class="headerlink" title="Promise.prototype.finally()"></a>Promise.prototype.finally()</h3><p><code>finally</code> 方法用于指定不管 <code>Promise</code> 对象最后状态如何, 都会执行的操作. 该方法是 ES2018 引入标准的.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    ···&#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    ···&#125;)</span><br><span class="line">  .finally(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ···&#125;);</span><br></pre></td></tr></table></figure><p><code>finally</code> 不接收任何参数, 与状态无关, 本质上是 <code>then</code> 方法的特例.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">promise</span><br><span class="line">  .finally(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 语句</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">promise</span><br><span class="line">  .then(</span><br><span class="line">    result =&gt; &#123;</span><br><span class="line">      <span class="comment">// 语句</span></span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      <span class="comment">// 语句</span></span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br></pre></td></tr></table></figure><p>上面代码中, 如果不使用 <code>finally</code> 方法, 同样的语句需要为成功和失败两种情况各写一次. 有了 <code>finally</code> 方法, 则只需要写一次.<br><code>finally</code> 方法总是会返回原来的值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resolve 的值是 undefined</span></span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="number">2</span>).then(<span class="function">() =&gt;</span> &#123;&#125;, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// resolve 的值是 2</span></span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="number">2</span>).finally(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// reject 的值是 undefined</span></span><br><span class="line"><span class="built_in">Promise</span>.reject(<span class="number">3</span>).then(<span class="function">() =&gt;</span> &#123;&#125;, <span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// reject 的值是 3</span></span><br><span class="line"><span class="built_in">Promise</span>.reject(<span class="number">3</span>).finally(<span class="function">() =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><h3 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a>Promise.all()</h3><p>用于将多个 <code>Promise</code> 实例, 包装成一个新的 <code>Promise</code> 实例, 参数可以不是数组, 但必须是Iterator接口, 且返回的每个成员都是 <code>Promise</code> 实例.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.all([p1, p2, p3]);</span><br></pre></td></tr></table></figure><p><code>p</code> 的状态由 <code>p1</code> 、 <code>p2</code> 、 <code>p3</code> 决定, 分成<strong>两种</strong>情况.</p><ol><li>只有p1、p2、p3的状态都变成fulfilled，p的状态才会变成fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。</li><li>只要p1、p2、p3之中有一个被rejected，p的状态就变成rejected，此时第一个被reject的实例的返回值，会传递给p的回调函数。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成一个Promise对象的数组</span></span><br><span class="line"><span class="keyword">const</span> promises = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>].map(<span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getJSON(<span class="string">&#x27;/post/&#x27;</span> + id + <span class="string">&quot;.json&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all(promises).then(<span class="function"><span class="keyword">function</span>(<span class="params">posts</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上面代码中, <code>promises</code> 是包含 6 个 Promise 实例的数组, 只有这 6 个实例的状态都变成 <code>fulfilled</code> , 或者其中有一个变为 <code>rejected</code> , 才会调用 <code>Promise.all</code> 方法后面的回调函数.</p><p><code>注意</code> : 如果 <code>Promise</code> 的参数中定义了 <code>catch</code> 方法, 则 <code>rejected</code> 后不会触发 <code>Promise.all()</code> 的 <code>catch</code> 方法, 因为参数中的 <code>catch</code> 方法执行完后也会变成 <code>resolved</code> , 当 <code>Promise.all()</code> 方法参数的实例都是 <code>resolved</code> 时就会调用 <code>Promise.all()</code> 的 <code>then</code> 方法.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> result)</span><br><span class="line">  .catch(<span class="function"><span class="params">e</span> =&gt;</span> e);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;报错了&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> result)</span><br><span class="line">  .catch(<span class="function"><span class="params">e</span> =&gt;</span> e);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2])</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br><span class="line">  .catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e));</span><br><span class="line"><span class="comment">// [&quot;hello&quot;, Error: 报错了]</span></span><br></pre></td></tr></table></figure><p><strong>如果参数里面都没有catch方法, 就会调用Promise.all()的catch方法.</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;报错了&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> result);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2])</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br><span class="line">  .catch(<span class="function"><span class="params">e</span> =&gt;</span> <span class="built_in">console</span>.log(e));</span><br><span class="line"><span class="comment">// Error: 报错了</span></span><br></pre></td></tr></table></figure><h3 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race()"></a>Promise.race()</h3><p>与 <code>Promise.all</code> 方法类似, 也是将多个 <code>Promise</code> 实例包装成一个新的 <code>Promise</code> 实例.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.race([p1, p2, p3]);</span><br></pre></td></tr></table></figure><p>与 <code>Promise.all</code> 方法区别在于, <code>Promise.race</code> 方法是 <code>p1</code> , <code>p2</code> , <code>p3</code> 中只要一个参数先改变状态, 就会把这个参数的返回值传给 <code>p</code> 的回调函数.</p><h3 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve()"></a>Promise.resolve()</h3><p>将现有对象转换成 <code>Promise</code> 对象.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.resolve($.ajax(<span class="string">&#x27;/whatever.json&#x27;</span>));</span><br></pre></td></tr></table></figure><h3 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject()"></a>Promise.reject()</h3><p>返回一个 <code>rejected</code> 状态的 <code>Promise</code> 实例.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.reject(<span class="string">&#x27;出错了&#x27;</span>);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> reject(<span class="string">&#x27;出错了&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.then(<span class="literal">null</span>, <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(s)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 出错了</span></span><br></pre></td></tr></table></figure><p>注意, <code>Promise.reject()</code> 方法的参数, 会原封不动地作为 <code>reject</code> 的理由, 变成后续方法的参数. 这一点与 <code>Promise.resolve</code> 方法不一致.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> thenable = &#123;</span><br><span class="line">  <span class="function"><span class="title">then</span>(<span class="params">resolve, reject</span>)</span> &#123;</span><br><span class="line">    reject(<span class="string">&#x27;出错了&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.reject(thenable)</span><br><span class="line">  .catch(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e === thenable)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><a href="#%E4%BA%8C%E7%9B%AE%E5%BD%95">⬆ 返回目录</a></p><h2 id="Iterator和-for…of循环"><a href="#Iterator和-for…of循环" class="headerlink" title="Iterator和 for…of循环"></a>Iterator和 for…of循环</h2><h3 id="Iterator遍历器概念"><a href="#Iterator遍历器概念" class="headerlink" title="Iterator遍历器概念"></a>Iterator遍历器概念</h3><blockquote><p><strong>Iterator</strong>是一种接口, 为各种不同的数据结构提供统一的访问机制. 任何数据结构只要部署 <strong>Iterator</strong> 接口, 就可以完成遍历操作(即依次处理该数据结构的所有成员).</p></blockquote><p><strong>Iterator三个作用</strong>:</p><ul><li>为各种数据结构, 提供一个<strong>统一</strong>的、<strong>简便</strong>的访问接口;</li><li>使得数据结构的成员能够按某种次序排列;</li><li>Iterator** 接口主要供ES6新增的<code>for...of</code>消费;</li></ul><h3 id="Iterator遍历过程"><a href="#Iterator遍历过程" class="headerlink" title="Iterator遍历过程"></a>Iterator遍历过程</h3><ol><li>创建一个指针对象，指向当前数据结构的起始位置。也就是说，遍历器对象本质上，就是一个指针对象。</li><li>第一次调用指针对象的<code>next</code>方法，可以将指针指向数据结构的第一个成员。</li><li>第二次调用指针对象的<code>next</code>方法，指针就指向数据结构的第二个成员。</li><li>不断调用指针对象的<code>next</code>方法，直到它指向数据结构的结束位置。</li></ol><p>每一次调用 <code>next</code> 方法, 都会返回数据结构的当前成员的信息. 具体来说, 就是返回一个包含 <code>value</code> 和 <code>done</code> 两个属性的对象.</p><ul><li><code>value</code>属性是当前成员的值;</li><li><code>done</code>属性是一个布尔值, 表示遍历是否结束;</li></ul><p>模拟 <code>next</code> 方法返回值:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nextIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> nextIndex &lt; arr.length ? &#123;</span><br><span class="line">        value: arr[nextIndex++],</span><br><span class="line">        done: <span class="literal">false</span></span><br><span class="line">      &#125; : &#123;</span><br><span class="line">        value: <span class="literal">undefined</span>,</span><br><span class="line">        done: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = f([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line">a.next(); <span class="comment">// &#123; value: &quot;a&quot;, done: false &#125;</span></span><br><span class="line">a.next(); <span class="comment">// &#123; value: &quot;b&quot;, done: false &#125;</span></span><br><span class="line">a.next(); <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure><h3 id="默认Iterator接口"><a href="#默认Iterator接口" class="headerlink" title="默认Iterator接口"></a>默认Iterator接口</h3><p>若数据<strong>可遍历</strong>, 即一种数据部署了Iterator接口.<br>ES6中默认的Iterator接口部署在数据结构的 <code>Symbol.iterator</code> 属性, 即如果一个数据结构具有 <code>Symbol.iterator</code> 属性, 就可以认为是<strong>可遍历</strong>.<br><code>Symbol.iterator</code> 属性本身是函数, 是当前数据结构默认的遍历器生成函数. 执行这个函数, 就会返回一个遍历器. 至于属性名 <code>Symbol.iterator</code> , 它是一个表达式, 返回 <code>Symbol</code> 对象的 <code>iterator</code> 属性, 这是一个预定义好的、类型为 Symbol 的特殊值, 所以要放在方括号内(参见《Symbol》一章).</p><p><strong>原生具有Iterator接口的数据结构有</strong>:</p><ul><li>Array</li><li>Map</li><li>Set</li><li>String</li><li>TypedArray</li><li>函数的 arguments 对象</li><li>NodeList 对象</li></ul><h3 id="Iterator使用场景"><a href="#Iterator使用场景" class="headerlink" title="Iterator使用场景"></a>Iterator使用场景</h3><ul><li>(1)解构赋值**</li></ul><p>对数组和 <code>Set</code> 结构进行解构赋值时, 会默认调用 <code>Symbol.iterator</code> 方法.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>().add(<span class="string">&#x27;a&#x27;</span>).add(<span class="string">&#x27;b&#x27;</span>).add(<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> [x, y] = a; <span class="comment">// x = &#x27;a&#x27;  y = &#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">let</span> [a1, ...a2] = a; <span class="comment">// a1 = &#x27;a&#x27; a2 = [&#x27;b&#x27;,&#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure><ul><li>(2)扩展运算符**</li></ul><p>扩展运算符( <code>...</code> )也会调用默认的 Iterator 接口.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">[...a]; <span class="comment">//  [&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, ...a, <span class="string">&#x27;d&#x27;</span>]; <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]</span></span><br></pre></td></tr></table></figure><ul><li>(3)yield***<br><code>yield*</code> 后面跟的是一个可遍历的结构, 它会调用该结构的遍历器接口.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span>*[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = a();</span><br><span class="line">b.next() <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line">b.next() <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line">b.next() <span class="comment">// &#123; value: 3, done: false &#125;</span></span><br><span class="line">b.next() <span class="comment">// &#123; value: 4, done: false &#125;</span></span><br><span class="line">b.next() <span class="comment">// &#123; value: 5, done: false &#125;</span></span><br><span class="line">b.next() <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure><ul><li>(4)其他场合**</li></ul><p>由于数组的遍历会调用遍历器接口, 所以任何接受数组作为参数的场合, 其实都调用了遍历器接口. 下面是一些例子.</p><ul><li>for…of</li><li>Array.from()</li><li>Map(), Set(), WeakMap(), WeakSet()(比如<code>new Map([[&#39;a&#39;, 1], [&#39;b&#39;, 2]])</code>)</li><li>Promise.all()</li><li>Promise.race()</li></ul><h3 id="for…of循环"><a href="#for…of循环" class="headerlink" title="for…of循环"></a>for…of循环</h3><p>只要数据结构部署了 <code>Symbol.iterator</code> 属性, 即具有 iterator 接口, 可以用 <code>for...of</code> 循环遍历它的成员. 也就是说, <code>for...of</code> 循环内部调用的是数据结构的 <code>Symbol.iterato</code> 方法.<br><strong>使用场景</strong>:<br><code>for...of</code> 可以使用在<strong>数组</strong>, ** <code>Set</code> 和 <code>Map</code> 结构**, <strong>类数组对象</strong>, <strong>Genetator对象</strong>和<strong>字符串</strong>.</p><ul><li>数组**<br><code>for...of</code> 循环可以代替数组实例的 <code>forEach</code> 方法.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;; <span class="comment">// a b c</span></span><br><span class="line"></span><br><span class="line">a.forEach(<span class="function">(<span class="params">ele, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ele); <span class="comment">// a b c</span></span><br><span class="line">  <span class="built_in">console</span>.log(index); <span class="comment">// 0 1 2 </span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>与 <code>for...in</code> 对比, <code>for...in</code> 只能获取对象键名, 不能直接获取键值, 而 <code>for...of</code> 允许直接获取键值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;; <span class="comment">// a b c</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;; <span class="comment">// 0 1 2</span></span><br></pre></td></tr></table></figure><ul><li>Set和Map**</li></ul><p>可以使用数组作为变量, 如 <code>for (let [k, v] of b)&#123;...&#125;</code> .</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;; <span class="comment">// a b c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">b.set(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;leo&#x27;</span>);</span><br><span class="line">b.set(<span class="string">&#x27;age&#x27;</span>, <span class="number">18</span>);</span><br><span class="line">b.set(<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [k, v] <span class="keyword">of</span> b) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k + <span class="string">&quot;:&quot;</span> + v)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// name:leo</span></span><br><span class="line"><span class="comment">// age:18</span></span><br><span class="line"><span class="comment">// aaa:bbb</span></span><br></pre></td></tr></table></figure><ul><li>类数组对象**</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;; <span class="comment">// h e l l o</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// DOM NodeList对象</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> b) &#123;</span><br><span class="line">  k.classList.add(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// arguments对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> <span class="built_in">arguments</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(k);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>); <span class="comment">// a b</span></span><br></pre></td></tr></table></figure><ul><li>对象**<br>普通对象不能直接使用 <code>for...of</code> 会报错, 要部署Iterator才能使用.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  a: <span class="string">&#x27;aa&#x27;</span>,</span><br><span class="line">  b: <span class="string">&#x27;bb&#x27;</span>,</span><br><span class="line">  c: <span class="string">&#x27;cc&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;; <span class="comment">// a b c</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="built_in">console</span> &gt; log(k)</span><br><span class="line">&#125;; <span class="comment">// TypeError</span></span><br></pre></td></tr></table></figure><h3 id="跳出for…of"><a href="#跳出for…of" class="headerlink" title="跳出for…of"></a>跳出for…of</h3><p>使用 <code>break</code> 来实现.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> a) &#123;</span><br><span class="line">  <span class="keyword">if</span> (k &gt; <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Generator函数和应用"><a href="#Generator函数和应用" class="headerlink" title="Generator函数和应用"></a>Generator函数和应用</h2><h3 id="14-1-基本概念"><a href="#14-1-基本概念" class="headerlink" title="14.1 基本概念"></a>14.1 基本概念</h3><p><code>Generator</code> 函数是一种异步编程解决方案.<br><strong>原理</strong>:<br>执行 <code>Genenrator</code> 函数会返回一个遍历器对象, 依次遍历 <code>Generator</code> 函数内部的每一个状态.<br><code>Generator</code> 函数是一个普通函数, 有以下两个特征:</p><ul><li><code>function</code>关键字与函数名之间有个星号;</li><li>函数体内使用<code>yield</code>表达式, 定义不同状态;</li></ul><p>通过调用 <code>next</code> 方法, 将指针移向下一个状态, 直到遇到下一个 <code>yield</code> 表达式(或 <code>return</code> 语句)为止. 简单理解, <code>Generator</code> 函数分段执行, <code>yield</code> 表达式是暂停执行的标记, 而 <code>next</code> 恢复执行.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;ending&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = f();</span><br><span class="line">a.next(); <span class="comment">// &#123;value: &#x27;hi&#x27;, done : false&#125;</span></span><br><span class="line">a.next(); <span class="comment">// &#123;value: &#x27;leo&#x27;, done : false&#125;</span></span><br><span class="line">a.next(); <span class="comment">// &#123;value: &#x27;ending&#x27;, done : true&#125;</span></span><br><span class="line">a.next(); <span class="comment">// &#123;value: undefined, done : false&#125;</span></span><br></pre></td></tr></table></figure><h3 id="14-2-yield表达式"><a href="#14-2-yield表达式" class="headerlink" title="14.2 yield表达式"></a>14.2 yield表达式</h3><p><code>yield</code> 表达式是暂停标志, 遍历器对象的 <code>next</code> 方法的运行逻辑如下:</p><ol><li><p>遇到<code>yield</code>就暂停执行，将这个<code>yield</code>后的表达式的值，作为返回对象的<code>value</code>属性值。</p></li><li><p>下次调用<code>next</code>往下执行，直到遇到下一个<code>yield</code>。</p></li><li><p>直到函数结束或者<code>return</code>为止，并返回<code>return</code>语句后面表达式的值，作为返回对象的<code>value</code>属性值。</p></li><li><p>如果该函数没有<code>return</code>语句，则返回对象的<code>value</code>为<code>undefined</code> 。</p><p><code>注意</code></p></li></ol><ul><li><code>yield</code>只能用在<code>Generator</code>函数里使用, 其他地方使用会报错.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误1</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  yiled <span class="number">1</span>; <span class="comment">// SyntaxError: Unexpected number</span></span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误2  forEach参数是个普通函数</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, [</span><br><span class="line">    [<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span></span><br><span class="line">  ],</span><br><span class="line">  [<span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span>*(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  i.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">m</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> m !== <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">yield</span>* f(m);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">yield</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> f(a)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>yield</code>表达式如果用于另一个表达式之中, 必须放在<strong>圆括号</strong>内.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;a&#x27;</span> + <span class="keyword">yield</span>); <span class="comment">//  SyntaxErro</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;a&#x27;</span> + <span class="keyword">yield</span> <span class="number">123</span>); <span class="comment">//  SyntaxErro</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;a&#x27;</span> + (<span class="keyword">yield</span>)); <span class="comment">//  ok</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;a&#x27;</span> + (<span class="keyword">yield</span> <span class="number">123</span>)); <span class="comment">//  ok</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>yield</code>表达式用做函数参数或放在表达式右边, 可以<strong>不加括号</strong>.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  f(<span class="keyword">yield</span> <span class="string">&#x27;a&#x27;</span>, <span class="keyword">yield</span> <span class="string">&#x27;b&#x27;</span>); <span class="comment">//  ok</span></span><br><span class="line">  lei i = <span class="keyword">yield</span>; <span class="comment">//  ok</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-3-next方法"><a href="#14-3-next方法" class="headerlink" title="14.3 next方法"></a>14.3 next方法</h3><p><code>yield</code> 本身没有返回值, 或者是总返回 <code>undefined</code> , <code>next</code> 方法可带一个参数, 作为上一个 <code>yield</code> 表达式的返回值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; <span class="literal">true</span>; k++) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="keyword">yield</span> k;</span><br><span class="line">    <span class="keyword">if</span> (a) &#123;</span><br><span class="line">      k = -<span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> g = f();</span><br><span class="line">g.next(); <span class="comment">// &#123;value: 0, done: false&#125;</span></span><br><span class="line">g.next(); <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">g.next(<span class="literal">true</span>); <span class="comment">// &#123;value: 0, done: false&#125;</span></span><br></pre></td></tr></table></figure><p>这一特点, 可以让 <code>Generator</code> 函数开始执行之后, 可以从外部向内部注入不同值, 从而调整函数行为.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">2</span> * (<span class="keyword">yield</span>(x + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">let</span> z = <span class="keyword">yield</span>(y / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">return</span> (x + y + z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = f(<span class="number">5</span>);</span><br><span class="line">a.next(); <span class="comment">// &#123;value : 6 ,done : false&#125;</span></span><br><span class="line">a.next(); <span class="comment">// &#123;value : NaN ,done : false&#125;  </span></span><br><span class="line">a.next(); <span class="comment">// &#123;value : NaN ,done : true&#125;</span></span><br><span class="line"><span class="comment">// NaN因为yeild返回的是对象 和数字计算会NaN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = f(<span class="number">5</span>);</span><br><span class="line">b.next(); <span class="comment">// &#123;value : 6 ,done : false&#125;</span></span><br><span class="line">b.next(<span class="number">12</span>); <span class="comment">// &#123;value : 8 ,done : false&#125;</span></span><br><span class="line">b.next(<span class="number">13</span>); <span class="comment">// &#123;value : 42 ,done : false&#125;</span></span><br><span class="line"><span class="comment">// x 5 y 24 z 13</span></span><br></pre></td></tr></table></figure><h3 id="14-4-for…of循环"><a href="#14-4-for…of循环" class="headerlink" title="14.4 for…of循环"></a>14.4 for…of循环</h3><p><code>for...of</code> 循环会自动遍历, 不用调用 <code>next</code> 方法, 需要注意的是, <code>for...of</code> 遇到 <code>next</code> 返回值的 <code>done</code> 属性为 <code>true</code> 就会终止, <code>return</code> 返回的不包括在 <code>for...of</code> 循环中.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> f()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1 2 3 4  没有 5 </span></span><br></pre></td></tr></table></figure><h3 id="14-5-Generator-prototype-throw"><a href="#14-5-Generator-prototype-throw" class="headerlink" title="14.5 Generator.prototype.throw()"></a>14.5 Generator.prototype.throw()</h3><p><code>throw</code> 方法用来向函数外抛出错误, 并且在Generator函数体内捕获.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;内部捕获&#x27;</span>, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = f();</span><br><span class="line">a.next();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  a.throw(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">  a.throw(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;外部捕获&#x27;</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 内部捕获 a</span></span><br><span class="line"><span class="comment">// 外部捕获 b</span></span><br></pre></td></tr></table></figure><h3 id="14-6-Generator-prototype-return"><a href="#14-6-Generator-prototype-return" class="headerlink" title="14.6 Generator.prototype.return()"></a>14.6 Generator.prototype.return()</h3><p><code>return</code> 方法用来返回给定的值, 并结束遍历Generator函数, 如果 <code>return</code> 方法没有参数, 则返回值的 <code>value</code> 属性为 <code>undefined</code> .</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> g = f();</span><br><span class="line">g.next(); <span class="comment">// &#123;value : 1, done : false&#125;</span></span><br><span class="line">g.return(<span class="string">&#x27;leo&#x27;</span>); <span class="comment">// &#123;value : &#x27;leo&#x27;, done &quot; true&#125;</span></span><br><span class="line">g.next(); <span class="comment">// &#123;value : undefined, done : true&#125;</span></span><br></pre></td></tr></table></figure><h3 id="14-7-next-throw-return-共同点"><a href="#14-7-next-throw-return-共同点" class="headerlink" title="14.7 next()/throw()/return()共同点"></a>14.7 next()/throw()/return()共同点</h3><p>相同点就是都是用来恢复Generator函数的执行, 并且使用不同语句替换 <code>yield</code> 表达式.</p><ul><li><code>next()</code>将<code>yield</code>表达式替换成一个值.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span>*(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> r = <span class="keyword">yield</span> x + y;</span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> g = f(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">g.next(); <span class="comment">// &#123;value : 3, done : false&#125;</span></span><br><span class="line">g.next(<span class="number">1</span>); <span class="comment">// &#123;value : 1, done : true&#125;</span></span><br><span class="line"><span class="comment">// 相当于把 let r = yield x + y;</span></span><br><span class="line"><span class="comment">// 替换成 let r = 1;</span></span><br></pre></td></tr></table></figure><ul><li><code>throw()</code>将<code>yield</code>表达式替换成一个<code>throw</code>语句.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g.throw(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;报错&#x27;</span>)); <span class="comment">// Uncaught Error:报错</span></span><br><span class="line"><span class="comment">// 相当于将 let r = yield x + y</span></span><br><span class="line"><span class="comment">// 替换成 let r = throw(new Error(&#x27;报错&#x27;));</span></span><br></pre></td></tr></table></figure><ul><li><code>next()</code>将<code>yield</code>表达式替换成一个<code>return</code>语句.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g.return(<span class="number">2</span>); <span class="comment">// &#123;value: 2, done: true&#125;</span></span><br><span class="line"><span class="comment">// 相当于将 let r = yield x + y</span></span><br><span class="line"><span class="comment">// 替换成 let r = return 2;</span></span><br></pre></td></tr></table></figure><h3 id="14-8-yield-表达式"><a href="#14-8-yield-表达式" class="headerlink" title="14.8 yield* 表达式"></a>14.8 yield* 表达式</h3><p>用于在一个Generator中执行另一个Generator函数, 如果没有使用 <code>yield*</code> 会没有效果.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">yield</span>* a();</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> b()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 4</span></span><br></pre></td></tr></table></figure><h3 id="14-9-应用场景"><a href="#14-9-应用场景" class="headerlink" title="14.9 应用场景"></a>14.9 应用场景</h3><ol><li><strong>控制流管理</strong></li></ol><p>解决回调地狱:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用前</span></span><br><span class="line">f1(<span class="function"><span class="keyword">function</span>(<span class="params">v1</span>) </span>&#123;</span><br><span class="line">  f2(<span class="function"><span class="keyword">function</span>(<span class="params">v2</span>) </span>&#123;</span><br><span class="line">    f3(<span class="function"><span class="keyword">function</span>(<span class="params">v3</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ... more and more</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Promise </span></span><br><span class="line"><span class="built_in">Promise</span>.resolve(f1)</span><br><span class="line">  .then(f2)</span><br><span class="line">  .then(f3)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">v4</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;).done();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Generator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params">v1</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> v2 = <span class="keyword">yield</span> f1(v1);</span><br><span class="line">    <span class="keyword">let</span> v3 = <span class="keyword">yield</span> f1(v2);</span><br><span class="line">    <span class="keyword">let</span> v4 = <span class="keyword">yield</span> f1(v3);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="comment">// console.log(err)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params">task</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = task.next(task.value);</span><br><span class="line">  <span class="comment">// 如果Generator函数未结束，就继续调用</span></span><br><span class="line">  <span class="keyword">if</span> (!obj.done) &#123;</span><br><span class="line">    task.value = obj.value;</span><br><span class="line">    g(task);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">g(f(initValue));</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>异步编程的使用</strong></li></ol><p>在真实的异步任务封装的情况:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;node-fetch&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> url = <span class="string">&#x27;http://www.baidu.com&#x27;</span>;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">yield</span> fetch(url);</span><br><span class="line">  <span class="built_in">console</span>.log(res.bio);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行该函数</span></span><br><span class="line"><span class="keyword">let</span> g = f();</span><br><span class="line"><span class="keyword">let</span> result = g.next();</span><br><span class="line"><span class="comment">// 由于fetch返回的是Promise对象，所以用then</span></span><br><span class="line">result.value.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> data.json();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  g.next(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Class语法和继承"><a href="#Class语法和继承" class="headerlink" title="Class语法和继承"></a>Class语法和继承</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>ES6中的 <code>class</code> 可以看作只是一个语法糖, 绝大部分功能都可以用ES5实现, 并且, <strong>类和模块的内部, 默认就是严格模式, 所以不需要使用use strict指定运行模式</strong>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">P</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.x = x;</span><br><span class="line">  <span class="built_in">this</span>.y = y;</span><br><span class="line">&#125;</span><br><span class="line">P.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;(&#x27;</span> + <span class="built_in">this</span>.x + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">this</span>.y + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> P(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.x = x;</span><br><span class="line">    <span class="built_in">this</span>.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;(&#x27;</span> + <span class="built_in">this</span>.x + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">this</span>.y + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><p><strong>值得注意</strong>:</p><p>ES6的<strong>类</strong>的所有方法都是定义在 <code>prototype</code> 属性上, 调用类的实例的方法, 其实就是调用原型上的方法.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">toNumber</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">P.prototyoe = &#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">toNumber</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line">a.constructor === P.prototype.constructor; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>类的属性名可以使用<strong>表达式</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    [name]() &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Class不存在变量提升</strong>:</p><p>ES6中的类不存在变量提升, 与ES5完全不同:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> P(); <span class="comment">// ReferenceError</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>Class的name属性</strong>:</p><p><code>name</code> 属性总是返回紧跟在 <code>class</code> 后的类名.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;&#125;</span><br><span class="line">P.name; <span class="comment">// &#x27;P&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="constructor-方法"><a href="#constructor-方法" class="headerlink" title="constructor()方法"></a>constructor()方法</h3><p><code>constructor()</code> 是类的默认方法, 通过 <code>new</code> 实例化时自动调用执行, 一个类必须有 <code>constructor()</code> 方法, 否则一个空的 <code>constructor()</code> 会默认添加.<br><code>constructor()</code> 方法默认返回实例对象(即 <code>this</code> ).</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="类的实例对象"><a href="#类的实例对象" class="headerlink" title="类的实例对象"></a>类的实例对象</h3><p>与ES5一样, ES6的类必须使用 <code>new</code> 命令实例化, 否则报错.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = P(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> P(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure><p>与 ES5 一样, 实例的属性除非显式定义在其本身(即定义在 <code>this</code> 对象上), 否则都是定义在原型上(即定义在 <code>class</code> 上).</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.x = x;</span><br><span class="line">    <span class="built_in">this</span>.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">toString</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;(&#x27;</span> + <span class="built_in">this</span>.x + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">this</span>.y + <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> Point(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">point.toString() <span class="comment">// (2, 3)</span></span><br><span class="line"></span><br><span class="line">point.hasOwnProperty(<span class="string">&#x27;x&#x27;</span>) <span class="comment">// true</span></span><br><span class="line">point.hasOwnProperty(<span class="string">&#x27;y&#x27;</span>) <span class="comment">// true</span></span><br><span class="line">point.hasOwnProperty(<span class="string">&#x27;toString&#x27;</span>) <span class="comment">// false </span></span><br><span class="line">point.__proto__.hasOwnProperty(<span class="string">&#x27;toString&#x27;</span>) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// toString是原型对象的属性（因为定义在Point类上）</span></span><br></pre></td></tr></table></figure><h3 id="Class表达式"><a href="#Class表达式" class="headerlink" title="Class表达式"></a>Class表达式</h3><p>与函数一样, 类也可以使用表达式来定义, 使用表达式来作为类的名字, 而 <code>class</code> 后跟的名字, 用来指代当前类, 只能再Class内部使用.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> P.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> a();</span><br><span class="line">b.get(); <span class="comment">// P</span></span><br><span class="line">P.name; <span class="comment">// ReferenceError: P is not defined</span></span><br></pre></td></tr></table></figure><p>如果类的内部没用到的话, 可以省略 <code>P</code> , 也就是可以写成下面的形式.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="私有方法和私有属性"><a href="#私有方法和私有属性" class="headerlink" title="私有方法和私有属性"></a>私有方法和私有属性</h3><p>由于ES6不提供, 只能变通来实现:</p><ul><li><ol><li>使用命名加以区别, 如变量名前添加<code>_</code>, 但是不保险, 外面也可以调用到.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 公有方法</span></span><br><span class="line">  <span class="function"><span class="title">f1</span>(<span class="params">x</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._x(x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 私有方法</span></span><br><span class="line">  <span class="function"><span class="title">_x</span>(<span class="params">x</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.y = x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><ol start="2"><li>将私有方法移除模块, 再在类内部调用<code>call</code>方法.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">f1</span>(<span class="params">x</span>)</span> &#123;</span><br><span class="line">    f2.call(<span class="built_in">this</span>, x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.y = x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><ol start="3"><li>使用<code>Symbol</code>为私有方法命名.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a1 = <span class="built_in">Symbol</span>(<span class="string">&#x27;a1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> a2 = <span class="built_in">Symbol</span>(<span class="string">&#x27;a2&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 公有方法</span></span><br><span class="line">  <span class="function"><span class="title">f1</span>(<span class="params">x</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>[a1](x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 私有方法</span></span><br><span class="line">  [a1](x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>[a2] = x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="this指向问题"><a href="#this指向问题" class="headerlink" title="this指向问题"></a>this指向问题</h3><p>类内部方法的 <code>this</code> 默认指向类的实例, 但单独使用该方法可能报错, 因为 <code>this</code> 指向的问题.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">leoDo</span>(<span class="params">thing = <span class="string">&#x27;any&#x27;</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.print(<span class="string">`Leo do <span class="subst">$&#123;thing&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params">text</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(text);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  leoDo</span><br><span class="line">&#125; = a;</span><br><span class="line">leoDo(); <span class="comment">// TypeError: Cannot read property &#x27;print&#x27; of undefined</span></span><br><span class="line"><span class="comment">// 问题出在 单独使用leoDo时，this指向调用的环境，</span></span><br><span class="line"><span class="comment">// 但是leoDo中的this是指向P类的实例，所以报错</span></span><br></pre></td></tr></table></figure><p><strong>解决方法</strong>:</p><ul><li><ol><li>在类里面绑定<code>this</code></li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="built_in">this</span>.name.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><ol start="2"><li>使用箭头函数</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="function">(<span class="params">name = <span class="string">&#x27;leo&#x27;</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.print(<span class="string">`my name is <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Class的getter和setter"><a href="#Class的getter和setter" class="headerlink" title="Class的getter和setter"></a>Class的getter和setter</h3><p>使用 <code>get</code> 和 <code>set</code> 关键词对属性设置取值函数和存值函数, 拦截属性的存取行为.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">f</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;getter&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">f</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;setter: &#x27;</span> + val);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line">a.f = <span class="number">100</span>; <span class="comment">// setter : 100</span></span><br><span class="line">a.f; <span class="comment">// getter</span></span><br></pre></td></tr></table></figure><h3 id="Class的generator方法"><a href="#Class的generator方法" class="headerlink" title="Class的generator方法"></a>Class的generator方法</h3><p>只要在方法之前加个( <code>*</code> )即可.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">...args</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.args = args;</span><br><span class="line">    &#125;</span><br><span class="line">    *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> arg <span class="keyword">of</span> <span class="built_in">this</span>.args) &#123;</span><br><span class="line">        <span class="keyword">yield</span> arg;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">of</span> <span class="keyword">new</span> P(<span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;bb&#x27;</span>)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// &#x27;aa&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;bb&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Class的静态方法"><a href="#Class的静态方法" class="headerlink" title="Class的静态方法"></a>Class的静态方法</h3><p>由于类相当于实例的原型, 所有类中定义的方法都会被实例继承, 若不想被继承, 只要加上 <code>static</code> 关键字, 只能通过类来调用, 即”<strong>静态方法</strong>“.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span>() </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">f1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">P.f1(); <span class="comment">// &#x27;aa&#x27;</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> P();</span><br><span class="line">a.f1(); <span class="comment">// TypeError: a.f1 is not a function</span></span><br></pre></td></tr></table></figure><p>如果静态方法包含 <code>this</code> 关键字, 则 <code>this</code> 指向类, 而不是实例.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">f1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.f2();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">f2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">f2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;bbb&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">P.f2(); <span class="comment">// &#x27;aaa&#x27;</span></span><br></pre></td></tr></table></figure><p>并且静态方法可以被子类继承, 或者 <code>super</code> 对象中调用.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">f1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;leo&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line">Q.f1(); <span class="comment">// &#x27;leo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">R</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">f2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.f1() + <span class="string">&#x27;,too&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">R.f2(); <span class="comment">// &#x27;leo , too&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Class的静态属性和实例属性"><a href="#Class的静态属性和实例属性" class="headerlink" title="Class的静态属性和实例属性"></a>Class的静态属性和实例属性</h3><p>ES6中明确规定, Class内部只有静态方法没有静态属性, 所以只能通过下面实现.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确写法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;&#125;</span><br><span class="line">P.a1 = <span class="number">1</span>;</span><br><span class="line">P.a1; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无效写法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  a1: <span class="number">2</span>, <span class="comment">// 无效</span></span><br><span class="line">    <span class="keyword">static</span> a1: <span class="number">2</span>, <span class="comment">// 无效</span></span><br><span class="line">&#125;</span><br><span class="line">P.a1; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p><strong>新提案来规定实例属性和静态属性的新写法</strong></p><ul><li><ol><li>类的实例属性<br>类的实例属性可以用等式, 写入类的定义中.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  prop = <span class="number">100</span>; <span class="comment">// prop为P的实例属性 可直接读取</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.prop); <span class="comment">// 100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有了新写法后, 就可以不再 <code>contructor</code> 方法里定义.</p><p>为了可读性的目的, 对于那些在 <code>constructor</code> 里面已经定义的实例属性, 新写法允许<strong>直接列出</strong>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 之前写法：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouctCounter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">prop</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(prop);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新写法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouctCounter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">prop</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(prop);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><ol start="2"><li>类的静态属性<br>只要在实例属性前面加上 <code>static</code> 关键字就可以.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> prop = <span class="number">100</span>;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.prop)</span><br><span class="line">  &#125;; <span class="comment">// 100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新写法方便静态属性的表达.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// old </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line">P.a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Class的继承"><a href="#Class的继承" class="headerlink" title="Class的继承"></a>Class的继承</h3><p>主要通过 <code>extends</code> 关键字实现, 继承父类的所有属性和方法, 通过 <code>super</code> 关键字来新建父类构造函数的 <code>this</code> 对象.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">f1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">a, b, c</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(x, y); <span class="comment">// 调用父类 constructor(x, y)</span></span><br><span class="line">    <span class="built_in">this</span>.color = color;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">f2</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.color + <span class="string">&#x27; &#x27;</span> + <span class="built_in">super</span>.f1();</span><br><span class="line">    <span class="comment">// 调用父类的f1()方法</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>子类必须在 <code>constructor()</code> 调用 <code>super()</code> 否则报错</strong>, 并且只有 <code>super</code> 方法才能调用父类实例, 还有就是, <strong>父类的静态方法, 子类也可以继承到</strong>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.x = x;</span><br><span class="line">    <span class="built_in">this</span>.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">fun</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello leo&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 关键点1 调用super</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Q(); <span class="comment">// ReferenceError 因为Q没有调用super</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键点2 调用super</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">R</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">x, y.z</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.z = z; <span class="comment">// ReferenceError 没调用super不能使用</span></span><br><span class="line">    <span class="built_in">super</span>(x, y);</span><br><span class="line">    <span class="built_in">this</span>.z = z; <span class="comment">// 正确</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键点3 子类继承父类静态方法</span></span><br><span class="line">R.hello(); <span class="comment">// &#x27;hello leo&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>super关键字</strong>:<br>既可以当函数使用, 还可以当对象使用.</p><ul><li><ol><li>当函数调用, 代表父类的构造函数, 但必须执行一次.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">R</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><ol start="2"><li>当对象调用, 指向原型对象, 在静态方法中指向父类.</li></ol></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">f</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">R</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">super</span>.f()); <span class="comment">// 2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> R()</span><br></pre></td></tr></table></figure><p><code>注意</code> : <code>super</code> 指向父类原型对象, 所以定义在父类实例的方法和属性, 是无法通过 <code>super</code> 调用的, 但是通过调用 <code>super</code> 方法可以把内部 <code>this</code> 指向当前实例, 就可以访问到.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.a);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">R</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">f</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.a;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> R();</span><br><span class="line">b.a; <span class="comment">// undefined 因为a是父类P实例的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 先调用super就可以访问</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(); <span class="comment">// 将内部this指向当前实例</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.a;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> Q();</span><br><span class="line">c.a; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 情况3</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">J</span> <span class="keyword">extends</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">g</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.print();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> J();</span><br><span class="line">c.g(); <span class="comment">// 3  由于执行了super()后 this指向当前实例</span></span><br></pre></td></tr></table></figure><h2 id="Module语法和加载实现"><a href="#Module语法和加载实现" class="headerlink" title="Module语法和加载实现"></a>Module语法和加载实现</h2><h3 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h3><p>ES6之前用于JavaScript的模块加载方案, 是一些社区提供的, 主要有 <code>CommonJS</code> 和 <code>AMD</code> 两种, 前者用于<strong>服务器</strong>, 后者用于<strong>浏览器</strong>.<br>ES6提供了模块的实现, 使用 <code>export</code> 命令对外暴露接口, 使用 <code>import</code> 命令输入其他模块暴露的接口.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CommonJS模块</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  stat,</span><br><span class="line">  exists,</span><br><span class="line">  readFire</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6模块</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  stat,</span><br><span class="line">  exists,</span><br><span class="line">  readFire</span><br><span class="line">&#125; = <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h3><p>ES6模块自动采用严格模式, 无论模块头部是否有 <code>&quot;use strict&quot;</code> .<br><strong>严格模式有以下限制</strong>:</p><ul><li>变量必须<strong>声明后再使用</strong></li><li>函数的参数<strong>不能有同名属性</strong>, 否则报错</li><li>不能使用<code>with</code>语句</li><li>不能对只读属性赋值, 否则报错</li><li>不能使用前缀 0 表示八进制数, 否则报错</li><li>不能删除不可删除的属性, 否则报错</li><li>不能删除变量<code>delete prop</code>, 会报错, 只能删除属性<code>delete * global[prop]</code></li><li><code>eval</code>不会在它的外层作用域引入变量</li><li><code>eval</code>和<code>arguments</code>不能被重新赋值</li><li><code>arguments</code>不会自动反映函数参数的变化</li><li>不能使用<code>arguments.callee</code></li><li>不能使用<code>arguments.caller</code></li><li>禁止<code>this</code>指向全局对象</li><li>不能使用<code>fn.caller</code>和<code>fn.arguments</code>获取函数调用的堆栈</li><li>增加了保留字(比如<code>protected</code>、<code>static</code>和<code>interface</code>)</li></ul><p>特别是, ES6中顶层 <code>this</code> 指向 <code>undefined</code> , 即不应该在顶层代码使用 <code>this</code> .</p><h3 id="export命令"><a href="#export命令" class="headerlink" title="export命令"></a>export命令</h3><p>使用 <code>export</code> 向模块外暴露接口, 可以是方法, 也可以是变量.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 变量</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> b = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还可以</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还可以</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  a1 <span class="keyword">as</span> f1,</span><br><span class="line">  a2 <span class="keyword">as</span> f2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以使用 <code>as</code> 重命名函数的对外接口.<br><strong>特别注意</strong>:<br><code>export</code> 暴露的必须是接口, 不能是值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="keyword">export</span> <span class="number">1</span>; <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> a; <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">1</span>; <span class="comment">// 正确</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  a</span><br><span class="line">&#125;; <span class="comment">// 正确</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  a <span class="keyword">as</span> b</span><br><span class="line">&#125;; <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure><p>暴露方法也是一样:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> f;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  f</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="import命令"><a href="#import命令" class="headerlink" title="import命令"></a>import命令</h3><p>加载 <code>export</code> 暴露的接口, 输出为变量.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;/a.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>import</code> 后大括号指定变量名, 需要与 <code>export</code> 的模块暴露的名称一致.<br>也可以使用 <code>as</code> 为输入的变量重命名.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  a <span class="keyword">as</span> leo</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./a.js&#x27;</span>;</span><br></pre></td></tr></table></figure><p><code>import</code> 不能直接修改输入变量的值, 因为输入变量只读只是个接口, 但是如果是个对象, 可以修改它的属性.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  a</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./f.js&#x27;</span>;</span><br><span class="line">a = &#123;&#125;; <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line">a.foo = <span class="string">&#x27;leo&#x27;</span>; <span class="comment">// 不报错</span></span><br></pre></td></tr></table></figure><p><code>import</code> 命令具有提升效果, 会提升到整个模块头部最先执行, 且多次执行相同 <code>import</code> 只会执行一次.</p><h3 id="模块的整体加载"><a href="#模块的整体加载" class="headerlink" title="模块的整体加载"></a>模块的整体加载</h3><p>当一个模块暴露多个方法和变量, 引用时可以用 <code>*</code> 整体加载.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> obj <span class="keyword">from</span> <span class="string">&#x27;/a.js&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj.f());</span><br><span class="line"><span class="built_in">console</span>.log(obj.g());</span><br></pre></td></tr></table></figure><p>但是, 不允许运行时改变:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> obj <span class="keyword">from</span> <span class="string">&#x27;/a.js&#x27;</span>;</span><br><span class="line"><span class="comment">// 不允许</span></span><br><span class="line">obj.a = <span class="string">&#x27;leo&#x27;</span>;</span><br><span class="line">obj.b = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="export-default-命令"><a href="#export-default-命令" class="headerlink" title="export default 命令"></a>export default 命令</h3><p>使用 <code>export default</code> 命令, 为模块指定默认输出, 引用的时候直接指定任意名称即可.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;leo&#x27;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> leo <span class="keyword">from</span> <span class="string">&#x27;./a.js&#x27;</span>;</span><br><span class="line">leo(); <span class="comment">// &#x27;leo&#x27;</span></span><br></pre></td></tr></table></figure><p><code>export default</code> 暴露有函数名的函数时, 在调用时相当于匿名函数.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;leo&#x27;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;leo&#x27;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> f;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> leo <span class="keyword">from</span> <span class="string">&#x27;./a.js&#x27;</span>;</span><br></pre></td></tr></table></figure><p><code>export default</code> 其实是输出一个名字叫 <code>default</code> 的变量, 所以后面不能跟变量赋值语句.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><code>export default</code> 命令的本质是将后面的值, 赋给 <code>default</code> 变量, 所以可以直接将一个值写在 <code>export default</code> 之后.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">export</span> detault <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="keyword">export</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h3 id="export-和-import-复合写法"><a href="#export-和-import-复合写法" class="headerlink" title="export 和 import 复合写法"></a>export 和 import 复合写法</h3><p>常常在先输入后输出同一个模块使用, 即转发接口, 将两者写在一起.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">from</span> <span class="string">&#x27;./leo.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 理解为</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./leo.js&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  a,</span><br><span class="line">  b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>常见的写法还有:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口改名</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  a <span class="keyword">as</span> b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">from</span> <span class="string">&#x27;./leo.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 整体输出</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;./leo.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认接口改名</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">from</span> <span class="string">&#x27;./leo.js&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>常常用在模块继承</strong>.</p><h3 id="浏览器中的加载规则"><a href="#浏览器中的加载规则" class="headerlink" title="浏览器中的加载规则"></a>浏览器中的加载规则</h3><p>ES6中, 可以在浏览器使用 <code>&lt;script&gt;</code> 标签, 需要加入 <code>type=&quot;module&quot;</code> 属性, 并且这些都是异步加载, 避免浏览器阻塞, 即等到整个页面渲染完, 再执行模块脚本, 等同于打开了 <code>&lt;script&gt;</code> 标签的 <code>defer</code> 属性.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./a.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>另外, ES6模块也可以内嵌到网页, 语法与外部加载脚本一致:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> a <span class="keyword">from</span> <span class="string">&#x27;./a.js&#x27;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>注意点</code> :</p><ul><li>代码是在模块作用域之中运行, 而不是在全局作用域运行. 模块内部的顶层变量, 外部不可见.</li><li>模块脚本自动采用严格模式, 不管有没有声明<code>use strict</code>.</li><li>模块之中, 可以使用<code>import</code>命令加载其他模块(<code>.js</code>后缀不可省略, 需要提供<code>绝对 UR</code>L 或<code>相对 UR</code>L), 也可以使用<code>export</code>命令输出对外接口.</li><li>模块之中, 顶层的<code>this</code>关键字返回<code>undefined</code>, 而不是指向<code>window</code>. 也就是说, 在模块顶层使用<code>this</code>关键字, 是无意义的.</li><li>同一个模块如果加载多次, 将只执行一次.</li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">Harry</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://u.mr90.top/posts/12627/">https://u.mr90.top/posts/12627/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://u.mr90.top" target="_blank">Harry の 心 阁</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/api/dawddsa1231123w.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/49925/"><img class="prev-cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/api/img_08907203746551198_858062.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">正则表达式（js）</div></div></a></div><div class="next-post pull-right"><a href="/posts/12626/"><img class="next-cover" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/Rr210/image@master/hexo/api/img_025366963312045765_4.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Java知识整理-方法重载,递归</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#let-%E5%92%8C-const%E5%91%BD%E4%BB%A4-%E2%9C%94"><span class="toc-number">1.</span> <span class="toc-text">let 和 const命令 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#let-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.</span> <span class="toc-text">let 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">const 命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC-%E2%9C%94"><span class="toc-number">2.</span> <span class="toc-text">变量的解构赋值 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">2.1.</span> <span class="toc-text">数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.2.</span> <span class="toc-text">对象的解构赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.3.</span> <span class="toc-text">字符串的解构赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%92%8C%E5%B8%83%E5%B0%94%E5%80%BC%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.4.</span> <span class="toc-text">数值和布尔值的解构赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.5.</span> <span class="toc-text">函数参数的解构赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">2.6.</span> <span class="toc-text">应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8B%93%E5%B1%95-%E2%9C%94"><span class="toc-number">3.</span> <span class="toc-text">字符串的拓展 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#includes-startsWith-endsWith"><span class="toc-number">3.1.</span> <span class="toc-text">includes(), startsWith(), endsWith()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#repeat"><span class="toc-number">3.2.</span> <span class="toc-text">repeat()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#padStart-padEnd-%E8%A1%A5%E5%85%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%A7%E5%B0%8F-%E4%BB%8E%E5%A4%B4%E5%B0%BE%E8%A1%A5%E5%85%85"><span class="toc-number">3.3.</span> <span class="toc-text">padStart(), padEnd() 补全字符串大小(从头尾补充)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%89%88%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.4.</span> <span class="toc-text">模版字符串</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E7%9A%84%E6%8B%93%E5%B1%95-%E2%9C%94"><span class="toc-number">4.</span> <span class="toc-text">正则的拓展 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%AD%A3%E5%88%99%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">字符串的正则方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">4.3.</span> <span class="toc-text">u修饰符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#y%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">4.4.</span> <span class="toc-text">y修饰符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flags%E5%B1%9E%E6%80%A7"><span class="toc-number">4.5.</span> <span class="toc-text">flags属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E7%9A%84%E6%8B%93%E5%B1%95-%E2%9C%94"><span class="toc-number">5.</span> <span class="toc-text">数值的拓展 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Number-isFinite-Number-isNaN"><span class="toc-number">5.1.</span> <span class="toc-text">Number.isFinite(), Number.isNaN()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Number-parseInt-Number-parseFloat"><span class="toc-number">5.2.</span> <span class="toc-text">Number.parseInt(), Number.parseFloat()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Number-isInteger"><span class="toc-number">5.3.</span> <span class="toc-text">Number.isInteger()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Math%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8B%93%E5%B1%95"><span class="toc-number">5.4.</span> <span class="toc-text">Math对象的拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-trunc"><span class="toc-number">5.4.1.</span> <span class="toc-text">Math.trunc():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-sign"><span class="toc-number">5.4.2.</span> <span class="toc-text">Math.sign():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-cbrt"><span class="toc-number">5.4.3.</span> <span class="toc-text">Math.cbrt():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-clz32"><span class="toc-number">5.4.4.</span> <span class="toc-text">Math.clz32():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-imul"><span class="toc-number">5.4.5.</span> <span class="toc-text">Math.imul():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-fround"><span class="toc-number">5.4.6.</span> <span class="toc-text">Math.fround():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-hypot"><span class="toc-number">5.4.7.</span> <span class="toc-text">Math.hypot():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-expm1"><span class="toc-number">5.4.8.</span> <span class="toc-text">Math.expm1():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-log1p"><span class="toc-number">5.4.9.</span> <span class="toc-text">Math.log1p():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-log10"><span class="toc-number">5.4.10.</span> <span class="toc-text">Math.log10():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Math-log2"><span class="toc-number">5.4.11.</span> <span class="toc-text">Math.log2():</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E6%9B%B2%E5%87%BD%E6%95%B0%E6%96%B9%E6%B3%95"><span class="toc-number">5.4.12.</span> <span class="toc-text">双曲函数方法:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E6%95%B0%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">5.5.</span> <span class="toc-text">指数运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E6%8B%93%E5%B1%95-%E2%9C%94"><span class="toc-number">6.</span> <span class="toc-text">函数的拓展 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">6.1.</span> <span class="toc-text">参数默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rest-%E5%8F%82%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">rest 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#name-%E5%B1%9E%E6%80%A7"><span class="toc-number">6.3.</span> <span class="toc-text">name 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="toc-number">6.4.</span> <span class="toc-text">箭头函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E5%86%92%E5%8F%B7%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">6.5.</span> <span class="toc-text">双冒号运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E7%9A%84%E6%8B%93%E5%B1%95-%E2%9C%94"><span class="toc-number">7.</span> <span class="toc-text">数组的拓展 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">7.1.</span> <span class="toc-text">拓展运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Array-from"><span class="toc-number">7.2.</span> <span class="toc-text">Array.from()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Array-of"><span class="toc-number">7.3.</span> <span class="toc-text">Array.of()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#find-%E5%92%8CfindIndex"><span class="toc-number">7.4.</span> <span class="toc-text">find()和findIndex()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fill"><span class="toc-number">7.5.</span> <span class="toc-text">fill()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#entries-keys-values"><span class="toc-number">7.6.</span> <span class="toc-text">entries(), keys(), values()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#includes"><span class="toc-number">7.7.</span> <span class="toc-text">includes()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flat-flatMap"><span class="toc-number">7.8.</span> <span class="toc-text">flat(), flatMap()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8B%93%E5%B1%95-%E2%9C%94"><span class="toc-number">8.</span> <span class="toc-text">对象的拓展 ✔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E7%9A%84%E7%AE%80%E6%B4%81%E8%A1%A8%E7%A4%BA"><span class="toc-number">8.1.</span> <span class="toc-text">属性的简洁表示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%90%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">8.2.</span> <span class="toc-text">属性名表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Object-is"><span class="toc-number">8.3.</span> <span class="toc-text">Object.is()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Object-assign"><span class="toc-number">8.4.</span> <span class="toc-text">Object.assign()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Symbol"><span class="toc-number">9.</span> <span class="toc-text">Symbol</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">9.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Symbol%E4%BD%9C%E4%B8%BA%E5%B1%9E%E6%80%A7%E5%90%8D"><span class="toc-number">9.2.</span> <span class="toc-text">Symbol作为属性名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8-%E6%B6%88%E9%99%A4%E9%AD%94%E6%9C%AF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">9.3.</span> <span class="toc-text">应用: 消除魔术字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%90%8D%E9%81%8D%E5%8E%86"><span class="toc-number">9.4.</span> <span class="toc-text">属性名遍历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Symbol-for-%E3%80%81Symbol-keyFor"><span class="toc-number">9.5.</span> <span class="toc-text">Symbol.for()、Symbol.keyFor()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%9A%84Symbol%E5%80%BC"><span class="toc-number">9.6.</span> <span class="toc-text">内置的Symbol值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set%E5%92%8CMap%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">10.</span> <span class="toc-text">Set和Map数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-Set"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 Set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-Set%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 Set的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-WeakSet"><span class="toc-number">10.3.</span> <span class="toc-text">10.3 WeakSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-Map"><span class="toc-number">10.4.</span> <span class="toc-text">10.4 Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-Map%E4%B8%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E6%8D%A2"><span class="toc-number">10.5.</span> <span class="toc-text">10.5 Map与其他数据结构互相转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-WeakMap"><span class="toc-number">10.6.</span> <span class="toc-text">10.6 WeakMap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy"><span class="toc-number">11.</span> <span class="toc-text">Proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">11.1.</span> <span class="toc-text">基础使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88Proxy%E5%AE%9E%E4%BE%8B"><span class="toc-number">11.2.</span> <span class="toc-text">取消Proxy实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-Web%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">11.3.</span> <span class="toc-text">实现 Web服务的客户端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise%E5%AF%B9%E8%B1%A1"><span class="toc-number">12.</span> <span class="toc-text">Promise对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">12.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">12.2.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-prototype-then"><span class="toc-number">12.3.</span> <span class="toc-text">Promise.prototype.then()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-prototype-catch"><span class="toc-number">12.4.</span> <span class="toc-text">Promise.prototype.catch()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-prototype-finally"><span class="toc-number">12.5.</span> <span class="toc-text">Promise.prototype.finally()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-all"><span class="toc-number">12.6.</span> <span class="toc-text">Promise.all()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-race"><span class="toc-number">12.7.</span> <span class="toc-text">Promise.race()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-resolve"><span class="toc-number">12.8.</span> <span class="toc-text">Promise.resolve()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise-reject"><span class="toc-number">12.9.</span> <span class="toc-text">Promise.reject()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Iterator%E5%92%8C-for%E2%80%A6of%E5%BE%AA%E7%8E%AF"><span class="toc-number">13.</span> <span class="toc-text">Iterator和 for…of循环</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Iterator%E9%81%8D%E5%8E%86%E5%99%A8%E6%A6%82%E5%BF%B5"><span class="toc-number">13.1.</span> <span class="toc-text">Iterator遍历器概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Iterator%E9%81%8D%E5%8E%86%E8%BF%87%E7%A8%8B"><span class="toc-number">13.2.</span> <span class="toc-text">Iterator遍历过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4Iterator%E6%8E%A5%E5%8F%A3"><span class="toc-number">13.3.</span> <span class="toc-text">默认Iterator接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Iterator%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">13.4.</span> <span class="toc-text">Iterator使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for%E2%80%A6of%E5%BE%AA%E7%8E%AF"><span class="toc-number">13.5.</span> <span class="toc-text">for…of循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%B3%E5%87%BAfor%E2%80%A6of"><span class="toc-number">13.6.</span> <span class="toc-text">跳出for…of</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generator%E5%87%BD%E6%95%B0%E5%92%8C%E5%BA%94%E7%94%A8"><span class="toc-number">14.</span> <span class="toc-text">Generator函数和应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">14.1.</span> <span class="toc-text">14.1 基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-yield%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">14.2.</span> <span class="toc-text">14.2 yield表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3-next%E6%96%B9%E6%B3%95"><span class="toc-number">14.3.</span> <span class="toc-text">14.3 next方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-4-for%E2%80%A6of%E5%BE%AA%E7%8E%AF"><span class="toc-number">14.4.</span> <span class="toc-text">14.4 for…of循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-5-Generator-prototype-throw"><span class="toc-number">14.5.</span> <span class="toc-text">14.5 Generator.prototype.throw()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-6-Generator-prototype-return"><span class="toc-number">14.6.</span> <span class="toc-text">14.6 Generator.prototype.return()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-7-next-throw-return-%E5%85%B1%E5%90%8C%E7%82%B9"><span class="toc-number">14.7.</span> <span class="toc-text">14.7 next()&#x2F;throw()&#x2F;return()共同点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-8-yield-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">14.8.</span> <span class="toc-text">14.8 yield* 表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-9-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">14.9.</span> <span class="toc-text">14.9 应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Class%E8%AF%AD%E6%B3%95%E5%92%8C%E7%BB%A7%E6%89%BF"><span class="toc-number">15.</span> <span class="toc-text">Class语法和继承</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">15.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#constructor-%E6%96%B9%E6%B3%95"><span class="toc-number">15.2.</span> <span class="toc-text">constructor()方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%AF%B9%E8%B1%A1"><span class="toc-number">15.3.</span> <span class="toc-text">类的实例对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">15.4.</span> <span class="toc-text">Class表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E6%96%B9%E6%B3%95%E5%92%8C%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="toc-number">15.5.</span> <span class="toc-text">私有方法和私有属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#this%E6%8C%87%E5%90%91%E9%97%AE%E9%A2%98"><span class="toc-number">15.6.</span> <span class="toc-text">this指向问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%9A%84getter%E5%92%8Csetter"><span class="toc-number">15.7.</span> <span class="toc-text">Class的getter和setter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%9A%84generator%E6%96%B9%E6%B3%95"><span class="toc-number">15.8.</span> <span class="toc-text">Class的generator方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">15.9.</span> <span class="toc-text">Class的静态方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%9A%84%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">15.10.</span> <span class="toc-text">Class的静态属性和实例属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-number">15.11.</span> <span class="toc-text">Class的继承</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Module%E8%AF%AD%E6%B3%95%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">16.</span> <span class="toc-text">Module语法和加载实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">16.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F"><span class="toc-number">16.2.</span> <span class="toc-text">严格模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#export%E5%91%BD%E4%BB%A4"><span class="toc-number">16.3.</span> <span class="toc-text">export命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#import%E5%91%BD%E4%BB%A4"><span class="toc-number">16.4.</span> <span class="toc-text">import命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E6%95%B4%E4%BD%93%E5%8A%A0%E8%BD%BD"><span class="toc-number">16.5.</span> <span class="toc-text">模块的整体加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#export-default-%E5%91%BD%E4%BB%A4"><span class="toc-number">16.6.</span> <span class="toc-text">export default 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#export-%E5%92%8C-import-%E5%A4%8D%E5%90%88%E5%86%99%E6%B3%95"><span class="toc-number">16.7.</span> <span class="toc-text">export 和 import 复合写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99"><span class="toc-number">16.8.</span> <span class="toc-text">浏览器中的加载规则</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Harry</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><div class="github-badge"><a style="color:#fff" rel="external nofollow noopener noreferrer" href="https://hexo.io/" target="_blank" title="由 Hexo 强力驱动" data-pjax-state=""><span class="badge-subject"><i class="fab fa-hire-a-helper" style="color:#2680dc"></i>&nbspFrame</span><span class="badge-value bg-blue">Hexo</span></a></div><div class="github-badge"><a style="color:#fff" rel="external nofollow noopener noreferrer" href="https://cn.aliyun.com/" target="_blank" title="阿里云提供域名相关服务" data-pjax-state=""><span class="badge-subject"><i class="fab fa-mixcloud" style="color:orange"></i>&nbspDNS</span><span class="badge-value bg-DNS">Aliyun cloud</span></a></div><div class="github-badge"><a style="color:#fff" rel="external nofollow noopener noreferrer" href="https://www.jsdelivr.com/" target="_blank" title="本站使用JsDelivr为静态资源提供CDN加速" data-pjax-state=""><span class="badge-subject imgfooter">CDN</span><span class="badge-value bg-blueviolet">jsDelivr</span></a></div><div class="github-badge"><a style="color:#fff" rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" data-pjax-state=""><span class="badge-subject"><i class="fab fa-creative-commons"></i>&nbspCopyright</span><span class="badge-value bg-orange">BY-NC-SA 4.0</span></a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'twikoo-6gul6t4a61223d84',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'twikoo-6gul6t4a61223d84',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.jsdelivr.net/gh/Rr210/hexofixed@v0.47/js/jquery-3.5.1.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener toc scroll 
  window.removeEventListener('scroll', window.tocScrollFn)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div></body></html>